<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/css/index.css">
    <script src="/eSheet.umd.js"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<style>
    html,body{
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
    }
    body{
        padding-top: 20px;padding-left: 20px
    }
    #file-xlsx{
        margin-top: 30px;
    }
</style>
<body>
    <div id="elt"></div>
    <input type="file" id="file-xlsx" >上传excel
    <input type="text" id="user-name">
    <button id="syncBtn">同步数据</button>
</body>
<script>

    console.log('window',eSheet)
    // console.log('eSheet',eSheet)
    // console.log('CreateExcel',CreateExcel)
    const excel = (new eSheet('#elt')).init({
        width:1200,
        height:800
    })

    // excel.connectWebSocket('ws://192.168.31.208:8091')

    document.querySelector('#syncBtn').onclick = e=>{
        excel.syncData()
    }

    // const ws = new WebSocket('ws://localhost:8091')
    //
    // const userId = (new Date()).valueOf()
    //
    // const userName = document.querySelector('#user-name').value

    // ws.onopen = function (evt) {
    //     console.log('evt---onopen',evt)
    //
    //     /**
    //      * 1.选中改变
    //      * 2.单元格内容改变
    //      * 3.横向距离改变
    //      * 4.纵向距离改变
    //      */
    //
    //     // ws.send(JSON.stringify({
    //     //     type:1,
    //     //     command:'ceshi1',
    //     //     userId,
    //     //     userName
    //     // }))
    // }

    // ws.onmessage = function (evt) {
    //     console.log('evt---onmessage',evt)
    //     console.log(JSON.parse(JSON.parse(evt.data)))
    // }

    // ws.onerror = function (evt) {
    //     console.log('evt---error',evt)
    // }

    // ws.onclose = function (evt) {
    //     console.log('evt---onclose',evt)
    // }

    // console.log(excel)

    // excel.installXlsxData(JSON.parse(localStorage.getItem('sheet')))

    document.querySelector('#file-xlsx').onchange = function (e) {
        const file = e.target.files[0]
        console.log('file',file)
        console.log('XLSX',XLSX)
// 用FileReader来完成数据流的转换
        let reader = new FileReader();
        reader.onload = function (e) {
            let data = e.target.result;;
//通过XLSX来解析出workbook（工作簿）也就导入的excel文件
            let wb = XLSX.read(data, { type: "binary" });
            console.log(wb);
            excel.installXlsxData(wb['Sheets'])
            // localStorage.setItem('sheet',JSON.stringify(wb['Sheets']))

        };
        //readAsBinaryString需要File 或 Blob 对象的参数
        reader.readAsBinaryString(file);
// console.log(XLSX.read(file, { type: "array" }));
    }
</script>
</html>