!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).eSheet=t()}(this,(function(){"use strict";function e(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function t(t){for(var o=1;o<arguments.length;o++){var i=null!=arguments[o]?arguments[o]:{};o%2?e(Object(i),!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,f(i.key),i)}}function l(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,t,o){return(t=f(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function h(e,t,o){return h=c()?Reflect.construct.bind():function(e,t,o){var i=[null];i.push.apply(i,t);var l=new(Function.bind.apply(e,i));return o&&a(l,o.prototype),l},h.apply(null,arguments)}function d(e){var t="function"==typeof Map?new Map:void 0;return d=function(e){if(null===e||(o=e,-1===Function.toString.call(o).indexOf("[native code]")))return e;var o;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return h(e,arguments,s(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),a(i,e)},d(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){var t=c();return function(){var o,i=s(e);if(t){var l=s(this).constructor;o=Reflect.construct(i,arguments,l)}else o=i.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}(this,o)}}function p(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return m(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}function f(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var v={cell:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTkgMTd2LTVoLTJ2NWgtNXYyaDV2NWgydi01aDV2LTJoLTV6IiBmaWxsPSIjZmZmIiBmaWxsLW9wYWNpdHk9Ii44OCIvPjxwYXRoIGQ9Ik0xMiAxOS41aDQuNXY1aDN2LTVoNXYtM2gtNXYtNWgtM3Y1aC01djNoLjV6IiBzdHJva2U9IiMxNzFBMUQiLz48L2c+PGRlZnM+PGZpbHRlciBpZD0iZmlsdGVyMF9kIiB4PSI4IiB5PSI5IiB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPjxmZU9mZnNldCBkeT0iMSIvPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEuNSIvPjxmZUNvbG9yTWF0cml4IHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4yNSAwIi8+PGZlQmxlbmQgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93Ii8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+PC9maWx0ZXI+PC9kZWZzPjwvc3ZnPg==","col-resize":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxtYXNrIGlkPSJhIiBtYXNrVW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4PSI3IiB5PSI5IiB3aWR0aD0iMjIiIGhlaWdodD0iMTgiIGZpbGw9IiMwMDAiPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik03IDloMjJ2MThIN3oiLz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE5IDEwaC0ydjdoLTR2Mmg0djdoMnYtN2g0di0yaC00di03ek05IDE4bDQtM3Y2bC00LTN6bTE4IDBsLTQgM3YtNmw0IDN6Ii8+PC9tYXNrPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTkgMTBoLTJ2N2gtNHYyaDR2N2gydi03aDR2LTJoLTR2LTd6TTkgMThsNC0zdjZsLTQtM3ptMTggMGwtNCAzdi02bDQgM3oiIGZpbGw9IiMxNzFBMUQiLz48cGF0aCBkPSJNMTkgMTBoMVY5aC0xdjF6bS0yIDBWOWgtMXYxaDF6bTAgN3YxaDF2LTFoLTF6bS00IDB2LTFoLTF2MWgxem0wIDJoLTF2MWgxdi0xem00IDBoMXYtMWgtMXYxem0wIDdoLTF2MWgxdi0xem0yIDB2MWgxdi0xaC0xem0wLTd2LTFoLTF2MWgxem00IDB2MWgxdi0xaC0xem0wLTJoMXYtMWgtMXYxem0tNCAwaC0xdjFoMXYtMXpNOSAxOGwtLjYtLjgtMS4wNjcuOCAxLjA2Ny44LjYtLjh6bTQtM2gxdi0ybC0xLjYgMS4yLjYuOHptMCA2bC0uNi44TDE0IDIzdi0yaC0xem0xNC0zbC42LjggMS4wNjctLjgtMS4wNjctLjgtLjYuOHptLTQgM2gtMXYybDEuNi0xLjItLjYtLjh6bTAtNmwuNi0uOEwyMiAxM3YyaDF6bS00LTZoLTJ2MmgyVjl6bS0zIDF2N2gydi03aC0yem0xIDZoLTR2Mmg0di0yem0tNSAxdjJoMnYtMmgtMnptMSAzaDR2LTJoLTR2MnptMy0xdjdoMnYtN2gtMnptMSA4aDJ2LTJoLTJ2MnptMy0xdi03aC0ydjdoMnptLTEtNmg0di0yaC00djJ6bTUtMXYtMmgtMnYyaDJ6bS0xLTNoLTR2Mmg0di0yem0tMyAxdi03aC0ydjdoMnpNOS42IDE4LjhsNC0zLTEuMi0xLjYtNCAzIDEuMiAxLjZ6TTEyIDE1djZoMnYtNmgtMnptMS42IDUuMmwtNC0zLTEuMiAxLjYgNCAzIDEuMi0xLjZ6bTEyLjgtM2wtNCAzIDEuMiAxLjYgNC0zLTEuMi0xLjZ6TTI0IDIxdi02aC0ydjZoMnptLTEuNi01LjJsNCAzIDEuMi0xLjYtNC0zLTEuMiAxLjZ6IiBmaWxsPSIjZmZmIiBtYXNrPSJ1cmwoI2EpIi8+PC9nPjxkZWZzPjxmaWx0ZXIgaWQ9ImZpbHRlcjBfZCIgeD0iNC4zMzMiIHk9IjciIHdpZHRoPSIyNy4zMzMiIGhlaWdodD0iMjQiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPjxmZU9mZnNldCBkeT0iMSIvPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEuNSIvPjxmZUNvbG9yTWF0cml4IHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4yNSAwIi8+PGZlQmxlbmQgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93Ii8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+PC9maWx0ZXI+PC9kZWZzPjwvc3ZnPg==","row-resize":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxtYXNrIGlkPSJhIiBtYXNrVW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4PSI5IiB5PSI3IiB3aWR0aD0iMTgiIGhlaWdodD0iMjIiIGZpbGw9IiMwMDAiPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik05IDdoMTh2MjJIOXoiLz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTI2IDE5di0yaC03di00aC0ydjRoLTd2Mmg3djRoMnYtNGg3ek0xOCA5bDMgNGgtNmwzLTR6bTAgMThsLTMtNGg2bC0zIDR6Ii8+PC9tYXNrPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjYgMTl2LTJoLTd2LTRoLTJ2NGgtN3YyaDd2NGgydi00aDd6TTE4IDlsMyA0aC02bDMtNHptMCAxOGwtMy00aDZsLTMgNHoiIGZpbGw9IiMxNzFBMUQiLz48cGF0aCBkPSJNMjYgMTl2MWgxdi0xaC0xem0wLTJoMXYtMWgtMXYxem0tNyAwaC0xdjFoMXYtMXptMC00aDF2LTFoLTF2MXptLTIgMHYtMWgtMXYxaDF6bTAgNHYxaDF2LTFoLTF6bS03IDB2LTFIOXYxaDF6bTAgMkg5djFoMXYtMXptNyAwaDF2LTFoLTF2MXptMCA0aC0xdjFoMXYtMXptMiAwdjFoMXYtMWgtMXptMC00di0xaC0xdjFoMXpNMTggOWwuOC0uNi0uOC0xLjA2Ny0uOCAxLjA2Ny44LjZ6bTMgNHYxaDJsLTEuMi0xLjYtLjguNnptLTYgMGwtLjgtLjZMMTMgMTRoMnYtMXptMyAxNGwtLjguNi44IDEuMDY3LjgtMS4wNjctLjgtLjZ6bS0zLTR2LTFoLTJsMS4yIDEuNi44LS42em02IDBsLjguNkwyMyAyMmgtMnYxem02LTR2LTJoLTJ2Mmgyem0tMS0zaC03djJoN3YtMnptLTYgMXYtNGgtMnY0aDJ6bS0xLTVoLTJ2Mmgydi0yem0tMyAxdjRoMnYtNGgtMnptMSAzaC03djJoN3YtMnptLTggMXYyaDJ2LTJIOXptMSAzaDd2LTJoLTd2MnptNi0xdjRoMnYtNGgtMnptMSA1aDJ2LTJoLTJ2MnptMy0xdi00aC0ydjRoMnptLTEtM2g3di0yaC03djJ6TTE3LjIgOS42bDMgNCAxLjYtMS4yLTMtNC0xLjYgMS4yek0yMSAxMmgtNnYyaDZ2LTJ6bS01LjIgMS42bDMtNC0xLjYtMS4yLTMgNCAxLjYgMS4yem0zIDEyLjhsLTMtNC0xLjYgMS4yIDMgNCAxLjYtMS4yek0xNSAyNGg2di0yaC02djJ6bTUuMi0xLjZsLTMgNCAxLjYgMS4yIDMtNC0xLjYtMS4yeiIgZmlsbD0iI2ZmZiIgbWFzaz0idXJsKCNhKSIvPjwvZz48ZGVmcz48ZmlsdGVyIGlkPSJmaWx0ZXIwX2QiIHg9IjYiIHk9IjUuMzMzIiB3aWR0aD0iMjQiIGhlaWdodD0iMjcuMzMzIiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+PGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz48ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMTI3IDAiLz48ZmVPZmZzZXQgZHk9IjEiLz48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIxLjUiLz48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMjUgMCIvPjxmZUJsZW5kIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9ImVmZmVjdDFfZHJvcFNoYWRvdyIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImVmZmVjdDFfZHJvcFNoYWRvdyIgcmVzdWx0PSJzaGFwZSIvPjwvZmlsdGVyPjwvZGVmcz48L3N2Zz4=","s-resize":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTcgMTl2LThoM3Y4aDNsLTQuNSA1LjVMMTQgMTloM3oiIGZpbGw9IiMxNzFBMUQiLz48cGF0aCBkPSJNMjMgMTguNWgtMi41di04aC00djhoLTMuNTU1bC42NjguODE3IDQuNSA1LjUuMzg3LjQ3My4zODctLjQ3MyA0LjUtNS41LjY2OC0uODE3SDIzeiIgc3Ryb2tlPSIjZmZmIi8+PC9nPjxkZWZzPjxmaWx0ZXIgaWQ9ImZpbHRlcjBfZCIgeD0iOC44OSIgeT0iOCIgd2lkdGg9IjE5LjIyMSIgaGVpZ2h0PSIyMi4wNzkiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPjxmZU9mZnNldCBkeT0iMSIvPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEuNSIvPjxmZUNvbG9yTWF0cml4IHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4yNSAwIi8+PGZlQmxlbmQgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93Ii8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+PC9maWx0ZXI+PC9kZWZzPjwvc3ZnPg==","e-resize":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAgMTloLTh2LTNoOHYtM2w1IDQuNS01IDQuNXYtM3oiIGZpbGw9IiMxNzFBMUQiLz48cGF0aCBkPSJNMTkuNSAxM3YyLjVoLTh2NGg4djMuNjIzbC44MzQtLjc1MSA1LTQuNS40MTMtLjM3Mi0uNDEzLS4zNzItNS00LjUtLjgzNC0uNzVWMTN6IiBzdHJva2U9IiNmZmYiLz48L2c+PGRlZnM+PGZpbHRlciBpZD0iZmlsdGVyMF9kIiB4PSI4IiB5PSI4Ljc1NSIgd2lkdGg9IjIxLjQ5NSIgaGVpZ2h0PSIxOS40OTEiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPjxmZU9mZnNldCBkeT0iMSIvPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEuNSIvPjxmZUNvbG9yTWF0cml4IHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4yNSAwIi8+PGZlQmxlbmQgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93Ii8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+PC9maWx0ZXI+PC9kZWZzPjwvc3ZnPg==",crosshair:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTggMTh2LTZoLTF2NmgtNnYxaDZ2Nmgxdi02aDZ2LTFoLTZ6IiBmaWxsPSIjMTcxQTFEIi8+PHBhdGggZD0iTTE4LjUgMTJ2LS41aC0ydjZoLTZ2Mmg2djZoMnYtNmg2di0yaC02VjEyeiIgc3Ryb2tlPSIjZmZmIi8+PC9nPjxkZWZzPjxmaWx0ZXIgaWQ9ImZpbHRlcjBfZCIgeD0iNyIgeT0iOSIgd2lkdGg9IjIxIiBoZWlnaHQ9IjIxIiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+PGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz48ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMTI3IDAiLz48ZmVPZmZzZXQgZHk9IjEiLz48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIxLjUiLz48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMjUgMCIvPjxmZUJsZW5kIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9ImVmZmVjdDFfZHJvcFNoYWRvdyIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImVmZmVjdDFfZHJvcFNoYWRvdyIgcmVzdWx0PSJzaGFwZSIvPjwvZmlsdGVyPjwvZGVmcz48L3N2Zz4="},C=function(){function e(t){var i=this,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e),n(this,"canvasDom",null),n(this,"ctx",null),n(this,"cellWidth",0),n(this,"cellHeight",0),this.ctx=t.getContext("2d"),this.cellWidth=l.cellWidth,this.cellHeight=l.cellHeight,this.canvasDom=t,t.addEventListener("mousemove",(function(e){i.setCursor("cell")}))}return l(e,[{key:"setCursor",value:function(e){this.canvasDom.style.cursor="url(".concat(v[e],") 18 18, ").concat(e)}},{key:"setCursorDefault",value:function(){this.canvasDom.style.cursor="default"}},{key:"drawLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"source-over",o=arguments.length>2?arguments[2]:void 0;if(this.ctx.strokeStyle=null!=o?o:"black",this.ctx.lineWidth=1,this.ctx.globalCompositeOperation=t,this.ctx.beginPath(),e.length%2!=0)throw new Error("points is error");var i=e.length/2;this.ctx.moveTo(e[0],e[1]);for(var l=2;l<i+1;l+=2)this.ctx.lineTo(e[l],e[l+1]);this.ctx.closePath(),this.ctx.stroke()}},{key:"drawText",value:function(e,t,o,i,l,n,r){var s,a,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"center",h=arguments.length>8?arguments[8]:void 0,d=arguments.length>9?arguments[9]:void 0,u=this.ctx,g=this.cellWidth,p=this.cellHeight;u.globalCompositeOperation=null!=n?n:"source-over",i=null!==(s=i)&&void 0!==s?s:g,l=null!==(a=l)&&void 0!==a?a:p,u.font=h?"".concat(h.fontWeight+" ").concat(h.fontItalic+" ").concat(h.fontSize,"px ").concat(h.fontFamily):"12px Calibre",u.fillStyle=r||"black";var m=e+i/2,f=t+l/2;u.textBaseline=d||"middle",u.textAlign=c||"center";var v="";if(u.measureText(o).width>i){var C=(i/h.fontSize).toFixed(0)-1;v=o.slice(0,C-1)+"..."}else v=o;var y=0,b=0;y="left"===c?e:"right"===c?e+i:m,b="top"===d?t+2:"bottom"===d?t+l:f,u.fillText(v,y,b,i)}},{key:"clearRect",value:function(e,t,o,i){this.ctx.clearRect(e,t,o,i)}},{key:"drawStrokeRect",value:function(e,t,o,i,l,n){var r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;this.ctx.lineWidth=r,this.ctx.globalCompositeOperation=null!=n?n:"source-over",this.ctx.strokeStyle=null!=l?l:"black",this.ctx.strokeRect(e,t,o,i)}},{key:"drawFillRect",value:function(e,t,o,i,l,n){this.ctx.fillStyle=null!=l?l:"black",this.ctx.globalCompositeOperation=null!=n?n:"source-over",this.ctx.fillRect(e,t,o,i)}},{key:"drawDashStrokeRect",value:function(e,t,o,i,l,n){var r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;this.ctx.lineWidth=r,this.ctx.globalCompositeOperation=null!=n?n:"source-over",this.ctx.strokeStyle=null!=l?l:"black",this.ctx.setLineDash([5,5]),this.ctx.strokeRect(e,t,o,i),this.ctx.setLineDash([])}},{key:"drawTriangleRect",value:function(e,t,o,i){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.lineTo(o.x,o.y),this.ctx.closePath(),this.ctx.fillStyle=null!=i?i:"black",this.ctx.fill()}}]),e}();function y(e){return e>26?e%26==0?String.fromCharCode(64+parseInt((Math.floor(e/26)-1).toFixed(0)))+String.fromCharCode(90):String.fromCharCode(64+parseInt(Math.floor(e/26).toFixed(0)))+String.fromCharCode(64+e%26):String.fromCharCode(64+e)}var b=function(){function e(t){var i=this,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};o(this,e),n(this,"scale",1),n(this,"mulPersonSelected",[]),n(this,"ws",void 0),n(this,"userId",(new Date).valueOf()),n(this,"userName",(new Date).valueOf()),n(this,"userColor",this.getRandomColor()),n(this,"fontSize",12),n(this,"workBook",{}),n(this,"eSheetWorkBook",[]),n(this,"row",60),n(this,"col",26),n(this,"cellWidth",120),n(this,"cellHeight",40),n(this,"width",600),n(this,"height",600),n(this,"sheetWidth",0),n(this,"sheetHeight",0),n(this,"selectorDom",null),n(this,"canvasDom",null),n(this,"canvasWrapperDom",null),n(this,"layer",null),n(this,"components",{}),n(this,"plugins",{}),n(this,"copyKey",!1),n(this,"copyCellDash",[]),n(this,"shiftKey",!1),n(this,"ctrlKey",!1),n(this,"dragSign",!1),n(this,"lockDrag",!1),n(this,"dragSignDirectionIsHor",!1),n(this,"offsetYLock",!1),n(this,"offsetXLock",!1),n(this,"isScrollBottomBound",!1),n(this,"isScrollRightBound",!1),n(this,"nonSelectBgColor","#FFFFFF"),n(this,"selectedBorderBgColor","#0089FF"),n(this,"selectedBgColor","#EBF4FF"),n(this,"borderColor","#ECEDEE"),n(this,"borderCellBgColor","#F9FBFD"),n(this,"currentSheetIndex",0),n(this,"getType",(function(e){return Object.prototype.toString.call(e)})),n(this,"h",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.attr,l=t.style,n=t.attribute,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=document.createElement(e);for(var a in o)s[a]=o[a];for(var c in n)s.setAttribute(c,n[c]);for(var h in l)s.style[h]=l[h];r&&("[object Array]"===i.getType(r)?r.forEach((function(e){s.appendChild(e)})):s.appendChild(r));return s})),n(this,"fps",0),n(this,"lastTime",0),n(this,"draw",(function(){var e=performance.now(),t=e-i.lastTime;i.lastTime=e,i.fps=Math.round(1e3/t),requestAnimationFrame(i.draw)})),l.width=l.width&&!isNaN(l.width)&&l.width>0?l.width:this.width,l.height=l.height&&!isNaN(l.height)&&l.height>0?l.height:this.width,l.row=l.row&&l.row>this.row?l.row:this.row,l.col=l.col&&l.col>this.col?l.col:this.col,l.cellWidth=this.cellWidth,l.cellHeight=this.cellHeight,this.selectorDom=t;var a=document.createElement("canvas");a.width=l.width,a.height=l.height;var c=this.h("div",{attr:{className:"e-sheet-canvas-wrapper"}});c.appendChild(a),this.canvasWrapperDom=c,this.selectorDom.style.width=l.width+"px",this.canvasWrapperDom.style.width=l.width+"px",this.canvasWrapperDom.style.height=l.height+"px",this.selectorDom.appendChild(c),this.canvasDom=a,this.layer=new C(a,l,this),this.options=l,this.createNewSheet(),this.installComponents(r),this.installPlugins(s),this.plugins.SettingPlugin.changeFirstSelectedCell("A1")}return l(e,[{key:"exportXlsxData",value:function(){var e=[];return this.eSheetWorkBook.forEach((function(t){var o=t.sheet.filter((function(e){return e.isMerge})),i=o.filter((function(e){return e.mergeStartLabel===e.label})).map((function(e){var t=o.findIndex((function(t){return t.label===e.mergeEndLabel})),i=o[t];return{s:{c:e.col-1,r:e.row-1},e:{c:i.col-1,r:i.row-1}}})),l=t.sheet.filter((function(e){return!!e.text})).filter((function(e){return e.isMerge&&e.label===e.mergeStartLabel||!e.isMerge})),n={};l.forEach((function(e){n[e.label]={t:"s",v:e.text}})),l.length>1?n["!ref"]=l[0].label+":"+l[l.length-1].label:1===l.length&&(n["!ref"]=l[0].label);var r={label:t.label,sheet:n};i.length>0&&(n["!merges"]=i),e.push(r)})),e}},{key:"connectWebSocket",value:function(e){this.ws=new WebSocket(e),this.wsOpenCallback(),this.wsCloseCallback(),this.wsMsgCallback()}},{key:"wsMsgCallback",value:function(){var e=this;this.ws.onmessage=function(t){var o=e.plugins.DragPlugin,i=e.components.ContentComponent,l=JSON.parse(t.data);if(0===l.type)i.contentGroup=l.command,e.mulPersonSelected.forEach((function(e){e.command=i.searchRectByLabel(e.command.label)}));else if(1===l.type){var n=e.mulPersonSelected.findIndex((function(e){return e.userId===l.userId}));l.command=i.searchRectByLabel(l.command.label),-1===n?e.mulPersonSelected.push(l):e.mulPersonSelected[n]=l}else if(2===l.type)e.components.ContentComponent.changeRectTextByLabel(l.command);else if(3===l.type){var r=i.searchRectByLabel(l.command.label);o.expandWidthNoDrag(l.command.col,l.command.width-r.width)}e.fresh()}}},{key:"wsOpenCallback",value:function(){this.ws.onopen=function(e){}}},{key:"wsCloseCallback",value:function(){var e=this;this.ws.onclose=function(t){e.ws=null}}},{key:"setUserName",value:function(e){this.userName=e}},{key:"wsSend",value:function(e,t){this.ws&&this.ws.send(JSON.stringify({type:e,command:t,userId:this.userId,userName:this.userName,userColor:this.userColor}))}},{key:"syncData",value:function(){this.wsSend(0,this.components.ContentComponent.contentGroup)}},{key:"getRandomColor",value:function(){var e=Math.floor(16777215*Math.random()).toString(16);return 6===e.length?"#"+e:this.getRandomColor()}},{key:"switchSheet",value:function(e){this.saveHandle();var t=this.eSheetWorkBook[e];this.currentSheetIndex=e,this.components.ContentComponent.installContentDataByData(t.sheet),t.clickCell&&(this.components.ContentComponent.showClickRect(t.clickCell),this.plugins.SettingPlugin.setLabelCon(t.clickCell.label),this.plugins.SettingPlugin.setCellCon(t.clickCell.text)),this.fresh()}},{key:"saveHandle",value:function(){(this.copyKey=!1,this.copyCellDash=[],this.components.ContentComponent&&this.components.ContentComponent.clickCell)&&(this.eSheetWorkBook[this.currentSheetIndex].clickCell=this.components.ContentComponent.clickCell,this.components.ContentComponent.hideClickRect())}},{key:"getCurrentSheet",value:function(){return this.eSheetWorkBook[this.currentSheetIndex]}},{key:"createNewSheet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Sheet";this.saveHandle();var t=this.options,o=t.row,i=t.col,l=t.cellWidth,n=t.cellHeight,r=0,s=0,a=0,c=n;this.sheetWidth=0,this.sheetHeight=0;for(var h=1,d=e+h,u=this.eSheetWorkBook.findIndex((function(e){return e.label===d}));-1!==u;)h++,d=e+h,u=this.eSheetWorkBook.findIndex((function(e){return e.label===d}));this.eSheetWorkBook.push({id:(new Date).valueOf(),label:d,sheet:[],clickCell:null,step:[],stepNum:-1}),this.currentSheetIndex=this.eSheetWorkBook.length-1;for(var g=this.eSheetWorkBook[this.eSheetWorkBook.length-1].sheet,p=0;p<o;p++){r=0,s=n,this.sheetHeight+=n;for(var m=0;m<i;m++){0===p&&(this.sheetWidth+=l);var f=y(m+1)+(p+1);g.push({row:p+1,col:m+1,text:"",textAsNumber:NaN,width:l,height:n,x:r,y:a,ltX:s,ltY:c,mergeWidth:0,mergeHeight:0,mergeRow:1,mergeCol:1,mergeStartLabel:"",mergeEndLabel:"",mergeLabelGroup:[],isMerge:!1,bgColor:"#ffffff",fontColor:"#000000",font:null,fontSize:12,fontWeight:"",fontItalic:"",fontFamily:"Calibre",textAlign:"center",textBaseline:"middle",label:f}),r+=l,s+=l}a+=n,c+=n}}},{key:"initExcelData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Sheet1",t=this.options,o=t.row,i=t.col,l=t.cellWidth,n=t.cellHeight,r=0,s=0,a=0,c=n;this.sheetWidth=0,this.sheetHeight=0;var h=this.eSheetWorkBook.findIndex((function(t){return t.label===e})),d=0;-1===h?(this.eSheetWorkBook.push({label:e,sheet:[]}),d=this.eSheetWorkBook.length-1):d=h,this.eSheetWorkBook[d].sheet=[];for(var u=0;u<o;u++){r=0,s=n,this.sheetHeight+=n;for(var g=0;g<i;g++){var p,m;0===u&&(this.sheetWidth+=l);var f=y(g+1)+(u+1);this.eSheetWorkBook[d].sheet.push({row:u+1,col:g+1,text:this.workBook[e]&&null!==(p=null===(m=this.workBook[e][String.fromCharCode(65+g)+(u+1)])||void 0===m?void 0:m.v)&&void 0!==p?p:"",textAsNumber:NaN,width:l,height:n,x:r,y:a,ltX:s,ltY:c,mergeWidth:0,mergeHeight:0,mergeRow:1,mergeCol:1,mergeStartLabel:"",mergeEndLabel:"",mergeLabelGroup:[],isMerge:!1,bgColor:"#ffffff",fontColor:"#000000",font:null,fontSize:12,fontWeight:"",fontItalic:"",fontFamily:"Calibre",textAlign:"center",textBaseline:"middle",label:f}),r+=l,s+=l}a+=n,c+=n}}},{key:"installXlsxData",value:function(e){if(this.workBook=e,0===Object.keys(e).length)throw new Error("data is error");this.initExcelData(Object.keys(e)[0]),this.components.ContentComponent.installContentDataByName(Object.keys(e)[0]),this.components.ContentComponent.hideClickRect(),this.fresh()}},{key:"installComponents",value:function(e){for(var t in e)this.components[t]=new e[t](this.layer,this.options,this)}},{key:"installPlugins",value:function(e){for(var t in e)this.plugins[t]=new e[t](this.selectorDom,this.layer,this.options,this.components,this)}},{key:"fresh",value:function(){var e=this.plugins.ScrollPlugin,t=e.offsetX,o=e.offsetY,i=this.components,l=i.ContentComponent,n=i.HeaderComponent,r=i.SideComponent,s=i.WholeComponent;l.trendsDraw(t,o),n.trendsDraw(t),r.trendsDraw(o),s.draw()}},{key:"freshContent",value:function(){var e=this.plugins.ScrollPlugin,t=e.offsetX,o=e.offsetY;this.components.ContentComponent.trendsDraw(t,o)}},{key:"freshScrollBar",value:function(){this.plugins.ScrollPlugin.changeHorBarWidth(),this.plugins.ScrollPlugin.changeVerBarHeight()}}]),e}(),w=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;o(this,e),n(this,"options",{}),n(this,"layer",null),n(this,"core",null),this.layer=t,this.options=i,this.core=l,this.draw()}return l(e,[{key:"draw",value:function(){var e=this.core,t=e.borderCellBgColor,o=e.borderColor,i=this.options.cellHeight;this.layer.clearRect(0,0,i,i),this.layer.drawTriangleRect({x:i-6,y:6},{x:i-6,y:i-6},{x:6,y:i-6},"#DCDCDC"),this.layer.drawLine([0,0,i,0],null,o),this.layer.drawLine([0,0,0,i],null,o),this.layer.drawFillRect(0,0,i,i,t,"destination-over")}},{key:"addEvent",value:function(){}}]),e}(),x=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;o(this,e),n(this,"options",{}),n(this,"layer",null),n(this,"headerRectGroup",[]),this.options=i,this.layer=t,this.core=l,this.trendsDraw(0)}return l(e,[{key:"initDraw",value:function(){for(var e=this.options.col,t=this.options.cellWidth,o=this.options.cellHeight,i=0;i<e;i++){var l=String.fromCharCode(65+i),n=new Konva.Rect({x:i*t+40,y:0,width:t,height:o,fill:"#c0c4cc",stroke:"#606266",strokeWidth:1,attrs:{headerLabel:l,col:i,row:0}}),r=new Konva.Text({x:i*t+40,y:0,width:t,height:o,align:"center",verticalAlign:"middle",text:l,fontSize:20,fontFamily:"Calibri",fill:"black",attrs:{headerLabel:l,col:i,row:0}});n.hide(),r.hide(),this.headerBackGroup.add(n),this.headerTextGroup.add(r)}var s=new Konva.Line({points:[0,0,0,0],stroke:"blue",strokeWidth:1,lineCap:"round",lineJoin:"round"});this.headerBorderGroup.add(s)}},{key:"trendsDraw",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=this.options,i=o.width,l=o.cellHeight,n=this.core,r=n.borderCellBgColor,s=n.nonSelectBgColor,a=n.borderColor,c=n.selectedBgColor,h=this.core.components.ContentComponent,d=h.contentGroup,u=h.clickCell,g=h.clickRectShow,p=h.isRowSelect,m=h.secondClickCell,f=h.attrSecond,v=h.attrFirst,C=h.startAndEndRect,y=this.searchScreenAddr(t,0),b=this.searchScreenAddr(t+i-l,l),w=d.filter((function(e){return e.col>=y.col&&1===e.row&&e.col<=b.col}));this.headerRectGroup=w,this.layer.clearRect(l,0,i,l),this.layer.drawLine([l,0,i,0],null,a),this.layer.drawLine([l,l,i,l],null,a);for(var x=function(){var o=w[k];if(e.layer.drawText(o.x+l-t,0,o.label.slice(0,o.label.length-1),o.width,l,"destination-over",null,null,{fontSize:12,fontFamily:"",fontWeight:"",fontItalic:""}),e.layer.drawLine([o.x+l-t,0,o.x+l-t,l],"destination-over",a),g&&!p){var i=C?v.col:(null==m?void 0:m.col)>u.col?u.col:null==m?void 0:m.col,n=C?f.col:(null==m?void 0:m.col)>u.col?null==m?void 0:m.col:u.col;if(m&&o.col>=i&&o.col<=n)e.layer.drawFillRect(o.x+l-t,0,o.width,l,c,"destination-over");else if(o.col!==u.col||u.isMerge)if(u.isMerge){-1!==e.findClickCellRowArr(u).findIndex((function(e){return e===o.col}))&&e.layer.drawFillRect(o.x+l-t,0,o.width,l,c,"destination-over")}else e.layer.drawFillRect(o.x+l-t,0,o.width,l,r,"destination-over");else e.layer.drawFillRect(o.x+l-t,0,o.width,l,c,"destination-over")}else e.layer.drawFillRect(o.x+l-t,0,o.width,l,r,"destination-over");e.layer.drawFillRect(o.x+l-t,0,o.width,l,s,"destination-over")},k=0;k<w.length;k++)x()}},{key:"findClickCellRowArr",value:function(e){for(var t=[],o=e.col+e.mergeCol-1,i=e.col;i<=o;i++)t.push(i);return t}},{key:"searchScreenAddr",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=this.core.components.ContentComponent.contentGroup,i=0,l=0,n=0,r=0,s=0;s<o.length;s++){var a=o[s];if(l=(i=a.x)+a.width,r=(n=a.y)+a.height,i<=e&&e<=l&&n<=t&&t<=r&&1===a.row)return a}}}]),e}(),k=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;o(this,e),n(this,"options",{}),n(this,"layer",null),n(this,"sideRectGroup",[]),this.options=i,this.layer=t,this.core=l,this.trendsDraw(0)}return l(e,[{key:"initDraw",value:function(){for(var e=this.options,t=e.row,o=e.cellHeight,i=0;i<t;i++){var l=new Konva.Rect({x:0,y:i*o+40,width:o,height:o,fill:"#fff",stroke:"#606266",strokeWidth:1,attrs:{uniPos:"header"+i,exHeaderCell:!0,col:0,row:i,zIndex:99}}),n=new Konva.Text({x:0,y:i*o+40,width:o,height:o,text:i+1,fontSize:20,align:"center",verticalAlign:"middle",fontFamily:"Calibri",fill:"black",attrs:{col:0,row:i,label:i}});l.hide(),n.hide(),this.sideBackGroup.add(l),this.sideTextGroup.add(n)}var r=new Konva.Line({points:[0,0,0,0],stroke:"blue",strokeWidth:1,lineCap:"round",lineJoin:"round"});this.sideBorderGroup.add(r)}},{key:"trendsDraw",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=this.options,i=o.height,l=o.cellHeight,n=this.core.components.ContentComponent,r=n.contentGroup,s=n.clickCell,a=n.clickRectShow,c=n.isColSelect,h=n.secondClickCell,d=n.attrSecond,u=n.attrFirst,g=n.startAndEndRect,p=this.core,m=p.borderCellBgColor;p.selectedBorderBgColor;var f=p.borderColor,v=p.selectedBgColor,C=p.nonSelectBgColor,y=this.searchScreenAddr(0,t),b=this.searchScreenAddr(l,i-l+t),w=r.filter((function(e){return e.row>=y.row&&1===e.col&&e.row<=b.row}));this.sideRectGroup=w,this.layer.clearRect(0,l,l,i),this.layer.drawLine([0,l,0,i],null,f),this.layer.drawLine([l,l,l,i],null,f);for(var x=function(){var o=w[k];if(e.layer.drawText(0,o.y+l-t,o.row,l,o.height,"destination-over"),e.layer.drawLine([0,o.y+l-t,l,o.y+l-t],"destination-over",f),a&&!c){var i=g?u.row:(null==h?void 0:h.row)>s.row?s.row:null==h?void 0:h.row,n=g?d.row:(null==h?void 0:h.row)>s.row?null==h?void 0:h.row:s.row;if(h&&o.row>=i&&o.row<=n)e.layer.drawFillRect(0,o.y+l-t,l,o.height,v,"destination-over");else if(s.row!==o.row||s.isMerge)if(s.isMerge){-1!==e.findClickCellRowArr(s).findIndex((function(e){return e===o.row}))&&e.layer.drawFillRect(0,o.y+l-t,l,o.height,v,"destination-over")}else e.layer.drawFillRect(0,o.y+l-t,l,o.height,m,"destination-over");else e.layer.drawFillRect(0,o.y+l-t,l,o.height,v,"destination-over")}else e.layer.drawFillRect(0,o.y+l-t,l,o.height,m,"destination-over");e.layer.drawFillRect(0,o.y+l-t,l,o.height,C,"destination-over")},k=0;k<w.length;k++)x()}},{key:"findClickCellRowArr",value:function(e){for(var t=[],o=e.row+e.mergeRow-1,i=e.row;i<=o;i++)t.push(i);return t}},{key:"searchScreenAddr",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=this.core.components.ContentComponent.contentGroup,i=0,l=0,n=0,r=0,s=0;s<o.length;s++){var a=o[s];if(l=(i=a.x)+a.width,r=(n=a.y)+a.height,i<=e&&e<=l&&n<=t&&t<=r&&1===a.col)return a}}}]),e}(),S=function(){function e(t){var i=this,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;o(this,e),n(this,"selectedCellTopBorderDom",null),n(this,"selectedCellBottomBorderDom",null),n(this,"selectedCellLeftBorderDom",null),n(this,"selectedCellRightBorderDom",null),n(this,"selectedCellWidth",0),n(this,"selectedCellHeight",0),n(this,"canvasDom",null),n(this,"options",{}),n(this,"offsetX",0),n(this,"offsetY",0),n(this,"clickRectShow",!1),n(this,"moveClickCell",null),n(this,"clickCell",null),n(this,"secondClickCell",null),n(this,"isColSelect",!1),n(this,"isRowSelect",!1),n(this,"moreSelectedCell",[]),n(this,"mergeSelectedCell",[]),n(this,"startAndEndRect",null),n(this,"attrFirst",null),n(this,"attrSecond",null),n(this,"layer",null),n(this,"contentGroup",[]),n(this,"moveCell",(function(e){var t=i.options.cellHeight,o=i.core.plugins.ScrollPlugin,l=o.offsetX,n=o.offsetY,r=i.core.plugins.SelectPlugin.searchRectAddr(e.offsetX+l-t,e.offsetY+n-t);i.moveClickCell=r,i.showSelectedCellDom(r.x+t-l,r.y-n+t,r.isMerge?r.mergeWidth:r.width,r.isMerge?r.mergeHeight:r.height)})),n(this,"cellPainterDom",null),n(this,"cellPainterTopBorderDom",null),n(this,"cellPainterBottomBorderDom",null),n(this,"cellPainterLeftBorderDom",null),n(this,"cellPainterRightBorderDom",null),this.options=l,this.layer=t,this.core=r,this.canvasDom=r.canvasDom,this.selectorDom=r.selectorDom,this.canvasWrapperDom=r.canvasWrapperDom;var s=this.core.eSheetWorkBook[this.core.currentSheetIndex];this.registrySelectedCellDom(),this.registryCellPainterDom(),this.installContentDataByData(s.sheet),s.clickCell&&this.showClickRect(s.clickCell),this.trendsDraw(0,0)}return l(e,[{key:"installContentDataByName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Sheet1",t=this.core.eSheetWorkBook.findIndex((function(t){return t.label===e}));this.contentGroup=this.core.eSheetWorkBook[t].sheet}},{key:"installContentDataByData",value:function(e){this.contentGroup=e}},{key:"changeContentGroupByRectArr",value:function(e){e[0]}},{key:"showClickRect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.clickCell=e,this.clickRectShow=!0,this.isColSelect=t,this.isRowSelect=o}},{key:"setSecondClickCell",value:function(e){this.secondClickCell=e}},{key:"hideClickRect",value:function(){this.clickRectShow=!1,this.isColSelect=!1,this.isRowSelect=!1,this.secondClickCell=null,this.clickCell=null,this.moreSelectedCell=[],this.hideSelectedCellDom()}},{key:"drawMulPersonSelected",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.options.cellHeight;this.core.mulPersonSelected.forEach((function(l){if(1===l.type){var n=l.command;if(n.isMerge){var r=n.mergeWidth,s=n.mergeHeight;e.layer.drawStrokeRect(n.x+i-t,n.y-o+i,r,s,l.userColor,"destination-over",2)}else e.layer.drawStrokeRect(n.x+i-t,n.y-o+i,n.width,n.height,l.userColor,"destination-over",2);e.layer.drawText(n.x+i-t+6,n.y-o+i-16,l.userName,n.width,20,"destination-over","#ffffff","left",{fontSize:n.fontSize,fontFamily:n.fontFamily,fontWeight:n.fontWeight,fontItalic:n.fontItalic},"top"),e.layer.drawFillRect(n.x+i-t,n.y-o+i-20,n.width,20,l.userColor,"destination-over")}}))}},{key:"initDraw",value:function(){for(var e=this.options.col,t=this.options.row,o=this.options.cellWidth,i=this.options.cellHeight,l=0;l<t;l++)for(var n=0;n<e;n++){var r=String.fromCharCode(65+n),s=new Konva.Rect({x:n*o+40,y:l*i+40,width:o,height:i,stroke:"#dcdfe6",strokeWidth:1,listening:!1,attrs:{row:l,col:n,name:r+(l+1)}}),a=new Konva.Text({x:n*o+40,y:l*i+40,width:o,height:i,align:"center",verticalAlign:"middle",padding:6,ellipsis:!0,fontSize:12,fontFamily:"Calibri",fill:"black",attrs:{row:l,col:n,name:r+(l+1)}});s.hide(),a.hide(),this.contentBackGroup.add(s),this.contentTextGroup.add(a)}var c=new Konva.Rect({x:0,y:0,width:0,height:0});this.contentBorderGroup.add(c)}},{key:"showSelectedCellDom",value:function(e,t,o,i){var l,n;o=null!==(l=o)&&void 0!==l?l:this.selectedCellWidth,i=null!==(n=i)&&void 0!==n?n:this.selectedCellHeight,this.selectedCellWidth=o,this.selectedCellHeight=i,t<this.core.cellHeight||e<this.core.cellHeight?this.hideSelectedCellDom():(this.selectedCellTopBorderDom.style.display="block",this.selectedCellTopBorderDom.style.left=e+"px",this.selectedCellTopBorderDom.style.top=t+"px",this.selectedCellTopBorderDom.style.width=o+"px",this.selectedCellBottomBorderDom.style.display="block",this.selectedCellBottomBorderDom.style.left=e+"px",this.selectedCellBottomBorderDom.style.top=t+i-4+"px",this.selectedCellBottomBorderDom.style.width=o+"px",this.selectedCellLeftBorderDom.style.display="block",this.selectedCellLeftBorderDom.style.left=e+"px",this.selectedCellLeftBorderDom.style.top=t+"px",this.selectedCellLeftBorderDom.style.height=i+"px",this.selectedCellRightBorderDom.style.display="block",this.selectedCellRightBorderDom.style.left=e+o-4+"px",this.selectedCellRightBorderDom.style.top=t+"px",this.selectedCellRightBorderDom.style.height=i+"px"),this.showSelectedCellPainterDom(e+o,t+i)}},{key:"setSelectedCellBorderDomBgColor",value:function(e){var t=this.core.selectedBorderBgColor,o=null!=e?e:t;this.selectedCellTopBorderDom.style.backgroundColor=o,this.selectedCellBottomBorderDom.style.backgroundColor=o,this.selectedCellLeftBorderDom.style.backgroundColor=o,this.selectedCellRightBorderDom.style.backgroundColor=o}},{key:"hideSelectedCellDom",value:function(){this.selectedCellTopBorderDom.style.display="none",this.selectedCellBottomBorderDom.style.display="none",this.selectedCellLeftBorderDom.style.display="none",this.selectedCellRightBorderDom.style.display="none",this.cellPainterDom.style.display="none"}},{key:"initMoreSelectedCell",value:function(){var e=this.moreSelectedCell,t=this.clickCell;if(e.length>0)e.forEach((function(e){e.text="",e.fontColor="",e.bgColor="",e.font="",e.textAlign="",e.mergeWidth=0,e.mergeHeight=0,e.mergeRow=1,e.mergeCol=1,e.isMerge=!1,e.fontSize=12,e.fontFamily=""}));else if(t.isMerge)for(var o=t.row+t.mergeRow,i=t.col+t.mergeCol,l=t.row;l<o;l++)for(var n=t.col;n<i;n++){var r=this.searchRectByColAndRow(n,l);r.text="",r.fontSize=12,r.fontFamily="",r.fontColor="",r.bgColor="",r.font="",r.textAlign="",r.mergeWidth=0,r.mergeHeight=0,r.mergeRow=1,r.mergeCol=1,r.isMerge=!1}else t.text="",t.fontColor="",t.bgColor="",t.font="",t.textAlign="",t.mergeWidth=0,t.mergeHeight=0,t.mergeRow=1,t.mergeCol=1,t.isMerge=!1,t.fontSize=12,t.fontFamily=""}},{key:"moveSelectedCellDom",value:function(){var e=this;this.setSelectedCellBorderDomBgColor(),this.canvasDom.onmousemove=function(t){e.moveCell(t)},this.canvasWrapperDom.onmouseup=function(t){if(e.setSelectedCellBorderDomBgColor("transparent"),e.moveClickCell&&!e.moveClickCell.isMerge){var o=e.core.plugins.SelectPlugin,i=o.transformCanvasCellToTableDomStr();e.initMoreSelectedCell(),o.transformTableDomStrToCanvasCell(i,e.moveClickCell),e.moveClickCell=null,e.canvasDom.onmousemove=null,e.canvasWrapperDom.onmouseup=null}}}},{key:"registrySelectedCellDom",value:function(){var e=this,o=this.core,i=o.h,l=o.canvasWrapperDom,n={onmousedown:function(t){e.moveSelectedCellDom()},oncontextmenu:function(e){e.preventDefault()}},r={left:0,top:0,display:"none"},s=i("div",{attr:t({className:"e-sheet-hor-cell-border"},n),style:t(t({},r),{},{width:0})}),a=i("div",{attr:t({className:"e-sheet-hor-cell-border"},n),style:t(t({},r),{},{width:0})}),c=i("div",{attr:t({className:"e-sheet-ver-cell-border"},n),style:t(t({},r),{},{height:0})}),h=i("div",{attr:t({className:"e-sheet-ver-cell-border"},n),style:t(t({},r),{},{height:0})});this.selectedCellTopBorderDom=s,this.selectedCellBottomBorderDom=a,this.selectedCellLeftBorderDom=c,this.selectedCellRightBorderDom=h,l.appendChild(s),l.appendChild(a),l.appendChild(c),l.appendChild(h)}},{key:"registryCellPainterDom",value:function(){var e=this,t=this.core,o=t.h,i=t.canvasWrapperDom;this.cellPainterDom=o("div",{attr:{className:"e-sheet-cell-painter",onmouseup:function(t){e.canvasDom.onmousemove=null}}}),this.cellPainterTopBorderDom=o("div",{attr:{className:"e-sheet-cell-painter-border",onmouseup:function(t){e.canvasDom.onmousemove=null}},style:{height:"4px",display:"none"}}),this.cellPainterBottomBorderDom=o("div",{attr:{className:"e-sheet-cell-painter-border",onmouseup:function(t){e.canvasDom.onmousemove=null}},style:{height:"4px",display:"none"}}),this.cellPainterLeftBorderDom=o("div",{attr:{className:"e-sheet-cell-painter-border",onmouseup:function(t){e.canvasDom.onmousemove=null}},style:{width:"4px",display:"none"}}),this.cellPainterRightBorderDom=o("div",{attr:{className:"e-sheet-cell-painter-border",onmouseup:function(t){e.canvasDom.onmousemove=null}},style:{width:"4px",display:"none"}}),i.appendChild(this.cellPainterTopBorderDom),i.appendChild(this.cellPainterBottomBorderDom),i.appendChild(this.cellPainterLeftBorderDom),i.appendChild(this.cellPainterRightBorderDom),this.cellPainterDom.oncontextmenu=function(e){e.preventDefault()},this.cellPainterDom.onmousedown=function(t){t.stopImmediatePropagation();var o=parseInt(e.cellPainterDom.style.left),i=parseInt(e.cellPainterDom.style.top),l=0,n=0,r=0,s=0,a=0,c=0,h=null,d=null,u="";e.canvasDom.onmousemove=function(t){var g=e.options.cellHeight,p=e.clickCell,m=e.moreSelectedCell,f=e.core.plugins.ScrollPlugin,v=f.offsetX,C=f.offsetY,y=e.core.plugins.SelectPlugin.searchRectAddr(t.offsetX+v-g,t.offsetY+C-g),b=Math.abs(t.offsetX-o),w=Math.abs(t.offsetY-i);if(m.length>0){var x=m.filter((function(e){return e.row===p.row}));d=x[x.length-1],l=d.col-p.col+1,r=d.x-p.x+d.width;var k=m.filter((function(e){return e.col===p.col}));h=k[k.length-1],n=h.row-p.row+1,s=h.y-p.y+h.height,m[m.length-1]}else p.isMerge?(d=e.searchRectByColAndRow(p.col+p.mergeCol-1,p.row),h=e.searchRectByColAndRow(p.col,p.row+p.mergeRow-1),e.searchRectByLabel(p.mergeEndLabel),r=p.mergeWidth,s=p.mergeHeight):(d=h=p,r=p.width,s=p.height),l=p.mergeCol,n=p.mergeRow;if(t.offsetX>=p.ltX-v&&t.offsetX<=p.ltX-v+r&&t.offsetY>=p.ltY-C&&t.offsetY<=p.ltY-C+s)return e.hidePainterBorderDom(),u=null,e.canvasWrapperDom.onmouseup=null,void(e.canvasDom.onmouseup=null);if(b>w){var S=e.searchRectByColAndRow(y.col,p.row);t.offsetX>o?(u="right",a=Math.ceil(Math.abs(S.col-d.col)/l),e.showPainterBorderDom(p.ltX+r-v,p.ltY-C,r*a,s)):t.offsetX<o&&(u="left",a=Math.ceil(Math.abs(S.col-p.col)/l),e.showPainterBorderDom(p.ltX-r*a-v,p.ltY-C,r*a,s))}else{var D=e.searchRectByColAndRow(p.col,y.row);t.offsetY>i?(u="bottom",c=Math.ceil(Math.abs(D.row-h.row)/n),e.showPainterBorderDom(p.ltX,p.ltY+s-C,r,s*c)):t.offsetY<i&&(u="top",c=Math.ceil(Math.abs(D.row-p.row)/n),e.showPainterBorderDom(p.ltX,p.ltY-s*c-C,r,s*c))}e.canvasWrapperDom.onmouseup=function(t){if(t.stopImmediatePropagation(),null!==u){var o=e.core.plugins.SelectPlugin,i=o.transformCanvasCellToTableDomStr(),r=[];if("right"===u)for(var s=1;s<=a;s++)r.push(e.searchRectByColAndRow(p.col+s*l,p.row));else if("left"===u)for(var h=1;h<=a;h++)r.push(e.searchRectByColAndRow(p.col-h*l,p.row));else if("bottom"===u)for(var d=1;d<=c;d++)r.push(e.searchRectByColAndRow(p.col,p.row+d*n));else if("top"===u)for(var g=1;g<=c;g++)r.push(e.searchRectByColAndRow(p.col,p.row-g*n));r.forEach((function(e){o.transformTableDomStrToCanvasCell(i,e)})),e.canvasDom.onmousemove=null,e.canvasWrapperDom.onmouseup=null,e.hidePainterBorderDom()}}}},i.appendChild(this.cellPainterDom)}},{key:"hidePainterBorderDom",value:function(){this.cellPainterTopBorderDom.style.display="none",this.cellPainterBottomBorderDom.style.display="none",this.cellPainterLeftBorderDom.style.display="none",this.cellPainterRightBorderDom.style.display="none"}},{key:"showPainterBorderDom",value:function(e,t,o,i){this.cellPainterTopBorderDom.style.left=e+"px",this.cellPainterTopBorderDom.style.top=t+"px",this.cellPainterTopBorderDom.style.width=o+"px",this.cellPainterTopBorderDom.style.display="block",this.cellPainterBottomBorderDom.style.left=e+"px",this.cellPainterBottomBorderDom.style.top=t+i-4+"px",this.cellPainterBottomBorderDom.style.width=o+"px",this.cellPainterBottomBorderDom.style.display="block",this.cellPainterLeftBorderDom.style.left=e+"px",this.cellPainterLeftBorderDom.style.top=t+"px",this.cellPainterLeftBorderDom.style.height=i+"px",this.cellPainterLeftBorderDom.style.display="block",this.cellPainterRightBorderDom.style.left=e+o-4+"px",this.cellPainterRightBorderDom.style.top=t+"px",this.cellPainterRightBorderDom.style.height=i+"px",this.cellPainterRightBorderDom.style.display="block"}},{key:"showSelectedCellPainterDom",value:function(e,t){t<this.core.cellHeight||e<this.core.cellHeight?this.cellPainterDom.style.display="none":this.cellPainterDom.style.display="block",this.cellPainterDom.style.left=e-3+"px",this.cellPainterDom.style.top=t-3+"px",this.cellPainterDom.style.cursor="url(".concat(v.crosshair,") 18 18, crosshair")}},{key:"trendsDraw",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.options,l=i.width,n=i.height,r=i.cellHeight;i.cellWidth;var s=this.core,a=s.nonSelectBgColor,c=s.selectedBorderBgColor,h=s.borderColor,d=s.selectedBgColor,u=s.copyKey,g=this.searchScreenAddr(t,o),p=this.searchScreenAddr(t+l-r,o+n-r);this.layer.clearRect(r,r,l,n);var m=this.core.copyCellDash;if(u)if(m.length>1){var f=m[0],v=m[m.length-1];this.layer.drawDashStrokeRect(f.ltX-t+2,f.ltY-o+2,v.ltX-f.ltX+v.width-4,v.ltY-f.ltY+v.height-4,c,"destination-over")}else if(1===m.length){var C=m[0];C.isMerge?this.layer.drawDashStrokeRect(C.ltX-t+2,C.ltY-o+2,C.mergeWidth-4,C.mergeHeight-4,c,"destination-over"):this.layer.drawDashStrokeRect(C.ltX-t+2,C.ltY-o+2,C.width-4,C.height-4,c,"destination-over")}var y=null,b=null,w=null;if(this.secondClickCell){y=this.clickCell;var x=(b=this.secondClickCell).x>y.x,k=b.y>y.y;if(w=x&&!k?this.searchRectIsMerge(y.x,b.y,b.x,y.y,y,b):x&&k?this.searchRectIsMerge(y.x,y.y,b.x,b.y,y,b):!x&&k?this.searchRectIsMerge(b.x,y.y,y.x,b.y,y,b):this.searchRectIsMerge(b.x,b.y,y.x,y.y,y,b),this.startAndEndRect=w,w){var S=[],D=[];w.forEach((function(t){S.push(e.searchRectByLabel(t.mergeStartLabel)),D.push(e.searchRectByLabel(t.mergeEndLabel))}));var M=S.concat([y,b]),I=D.concat([y,b]),L=M.sort((function(e,t){return e.x-t.x}))[0].col,A=M.sort((function(e,t){return e.y-t.y}))[0].row,B=I.sort((function(e,t){return e.x-t.x}))[I.length-1].col,Z=I.sort((function(e,t){return e.y-t.y}))[I.length-1].row;y=this.searchRectByColAndRow(L,A),b=this.searchRectByColAndRow(B,Z),this.attrFirst=y,this.attrSecond=b}}var R=g.col,N=p.col,P=g.row,T=p.row,W=this.contentGroup;if(this.clickRectShow)if(this.isColSelect&&!this.isRowSelect)this.layer.drawStrokeRect(this.clickCell.x+r-t,r,this.clickCell.width,this.core.isScrollBottomBound?n-r:n,c,"destination-over",2);else if(this.isRowSelect&&!this.isColSelect)this.layer.drawStrokeRect(r,this.clickCell.y-o+r,this.core.isScrollRightBound?l-r:l,r,c,"destination-over",2);else if(this.isRowSelect&&this.isColSelect)this.layer.drawStrokeRect(r,r,this.core.isScrollRightBound?l-r:l,this.core.isScrollBottomBound?n-r:n,c,"destination-over",2);else if(this.secondClickCell)if(w)w&&(this.layer.drawStrokeRect(y.x+r-t,y.y-o+r,b.x-y.x+b.width,b.y-y.y+b.height,c,"destination-over",2),this.showSelectedCellDom(y.x+r-t,y.y-o+r,b.x-y.x+b.width,b.y-y.y+b.height));else if(this.secondClickCell.x>=this.clickCell.x){var H=this.secondClickCell.y>this.clickCell.y;this.layer.drawStrokeRect(this.clickCell.x+r-t,(H?this.clickCell.y:this.secondClickCell.y)-o+r,this.secondClickCell.x-this.clickCell.x+this.secondClickCell.width,Math.abs(this.secondClickCell.y-this.clickCell.y)+this.secondClickCell.height,c,"destination-over",2),this.showSelectedCellDom(this.clickCell.x+r-t,(H?this.clickCell.y:this.secondClickCell.y)-o+r,this.secondClickCell.x-this.clickCell.x+this.secondClickCell.width,Math.abs(this.secondClickCell.y-this.clickCell.y)+this.secondClickCell.height)}else{var j=this.secondClickCell.y>this.clickCell.y;this.layer.drawStrokeRect(this.secondClickCell.x+r-t,(j?this.clickCell.y:this.secondClickCell.y)-o+r,this.clickCell.x-this.secondClickCell.x+this.clickCell.width,Math.abs(this.secondClickCell.y-this.clickCell.y)+this.secondClickCell.height,c,"destination-over",2),this.showSelectedCellDom(this.secondClickCell.x+r-t,(j?this.clickCell.y:this.secondClickCell.y)-o+r,this.clickCell.x-this.secondClickCell.x+this.clickCell.width,Math.abs(this.secondClickCell.y-this.clickCell.y)+this.secondClickCell.height)}else if(this.clickCell.isMerge){var G=this.clickCell,Y=G.mergeWidth,X=G.mergeHeight;this.layer.drawStrokeRect(this.clickCell.x+r-t,this.clickCell.y-o+r,Y,X,c,"destination-over",2),this.showSelectedCellDom(this.clickCell.x+r-t,this.clickCell.y-o+r,Y,X)}else this.layer.drawStrokeRect(this.clickCell.x+r-t,this.clickCell.y-o+r,this.clickCell.width,this.clickCell.height,c,"destination-over",2),this.showSelectedCellDom(this.clickCell.x+r-t,this.clickCell.y-o+r,this.clickCell.width,this.clickCell.height);this.drawMulPersonSelected(t,o),this.moreSelectedCell=[],this.mergeSelectedCell=[];for(var E=0;E<W.length;E++){var z=W[E],F=z.row,V=z.col,J=z.text,_=z.x,O=z.y,U=z.width,Q=z.height;if(V>=R&&V<=N&&F>=P&&F<=T)if(z.isMerge)if(z.label===z.mergeStartLabel){var K=z.mergeWidth,q=z.mergeHeight;this.layer.drawStrokeRect(_-t+r,O-o+r,K,q,h,"destination-over",1),this.layer.drawText(_-t+r,O-o+r,J,K,q,"destination-over",z.fontColor,z.textAlign,{fontSize:z.fontsize,fontFamily:z.fontFamily,fontWeight:z.fontWeight,fontItalic:z.fontItalic},z.textBaseline),this.layer.drawFillRect(_-t+r,O-o+r,K,q,z.bgColor?z.bgColor:a,"destination-over",1)}else{var $=this.searchRectByLabel(z.mergeStartLabel);$.col>=R&&$.col<=N&&$.row>=P&&$.row<=T||(this.layer.drawStrokeRect($.x-t+r,$.y-o+r,$.mergeWidth,$.mergeHeight,h,"destination-over",1),this.layer.drawText($.x-t+r,$.y-o+r,$.text,$.mergeWidth,$.mergeHeight,"destination-over",$.fontColor,$.textAlign,{fontsize:$.fontSize,fontFamily:$.fontFamily,fontWeight:$.fontWeight,fontItalic:$.fontItalic},$.textBaseline),this.layer.drawFillRect($.x-t+r,$.y-o+r,$.mergeWidth,$.mergeHeight,$.bgColor?$.bgColor:a,"destination-over",1))}else z.isMerge||(this.layer.drawStrokeRect(_-t+r,O-o+r,U,Q,h,"destination-over",1),this.layer.drawText(_-t+r,O-o+r,J,U,Q,"destination-over",z.fontColor,z.textAlign,{fontSize:z.fontSize,fontFamily:z.fontFamily,fontWeight:z.fontWeight,fontItalic:z.fontItalic},z.textBaseline),this.layer.drawFillRect(_-t+r,O-o+r,U,Q,z.bgColor?z.bgColor:a,"destination-over",1));if(this.secondClickCell){var ee=w?b.col>y.col?y.col:b.col:this.secondClickCell.col>this.clickCell.col?this.clickCell.col:this.secondClickCell.col,te=w?b.row>y.row?y.row:b.row:this.secondClickCell.row>this.clickCell.row?this.clickCell.row:this.secondClickCell.row,oe=w?b.col>y.col?b.col:y.col:this.secondClickCell.col>this.clickCell.col?this.secondClickCell.col:this.clickCell.col,ie=w?b.row>y.row?b.row:y.row:this.secondClickCell.row>this.clickCell.row?this.secondClickCell.row:this.clickCell.row;V>=ee&&V<=oe&&F>=te&&F<=ie&&(this.layer.drawFillRect(_+r-t,O-o+r,U,Q,d,"destination-over"),z.col===this.clickCell.col&&z.row===this.clickCell.row||this.mergeSelectedCell.push(z),this.moreSelectedCell.push(z))}this.isRowSelect&&this.isColSelect&&this.layer.drawFillRect(_-t+r,O-o+r,U,Q,d,"destination-over")}}},{key:"searchScreenAddr",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;performance.now();for(var o=this.contentGroup,i=0,l=0,n=0,r=0,s=0;s<o.length;s++){var a=o[s];if(l=(i=a.x)+a.width,r=(n=a.y)+a.height,i<=e&&e<=l&&n<=t&&t<=r)return performance.now(),a}}},{key:"countMergeWidthAndHeight",value:function(e){var t=e.width,o=e.height;return e.mergeLabelGroup.forEach((function(i){e.row===i.row&&(t+=i.width),e.col===i.col&&(o+=i.height)})),{mergeWidth:t,mergeHeight:o}}},{key:"searchRectIsMerge",value:function(e,t,o,i,l,n){var r=this.contentGroup.filter((function(r){return r.x>=e&&r.x<=o&&r.y>=t&&r.y<=i&&r.isMerge&&([l.row,n.row].includes(r.row)||[l.col,n.col].includes(r.col))}));return r.length>0?r:null}},{key:"searchRectByLabel",value:function(e){var t=this.contentGroup,o=t.findIndex((function(t){return t.label===e}));return-1!==o?t[o]:null}},{key:"searchRectByColAndRow",value:function(e,t){var o=this.contentGroup,i=o.findIndex((function(o){return o.col===e&&o.row===t}));return-1!==i?o[i]:null}},{key:"searchRectIndexByColAndRow",value:function(e,t){return this.contentGroup.findIndex((function(o){return o.col===e&&o.row===t}))}},{key:"changeRectTextByLabel",value:function(e){var t=this.searchRectByLabel(e.label);t&&(t.text=e.text)}},{key:"searchRectArrByCol",value:function(e){return this.contentGroup.filter((function(t){return t.col===e}))}},{key:"searchRectArrByRow",value:function(e){return this.contentGroup.filter((function(t){return t.row===e}))}},{key:"isHasMergerInRectArrByCol",value:function(e){return this.searchRectArrByCol(e).some((function(e){return e.isMerge}))}},{key:"isHasMergerInRectArrByRow",value:function(e){return this.searchRectArrByRow(e).some((function(e){return e.isMerge}))}},{key:"initContentGroupRowAndColByCol",value:function(e,t){var o=this.contentGroup,i=this.options.cellHeight;this.core.col+=t;for(var l=this.core.col,n=1,r=0,s=0,a=o.length;s<a;s++){var c=o[s];if((s+1)%l==1&&(n=1,r=0),c.col>=e&&(c.col=n,c.x=r,c.ltX=r+i,c.col>=27?c.label=String.fromCharCode(65+c.col-27)+String.fromCharCode(65+c.col-27)+c.row:c.label=String.fromCharCode(65+c.col-1)+c.row,c.isMerge)){for(var h=0,d=0,u=c.mergeStartLabel.replace(/[0-9]/,""),g=c.mergeEndLabel.replace(/[0-9]/,""),p=c.mergeStartLabel.replace(/[A-Z]/,""),m=c.mergeEndLabel.replace(/[A-Z]/,""),f=0;f<u.length;f++)h+=c.mergeStartLabel.charCodeAt(f)-65+t;for(var v=0;v<g.length;v++)d+=c.mergeEndLabel.charCodeAt(v)-65+t;h>=27?(c.mergeStartLabel=String.fromCharCode(65+h-26)+String.fromCharCode(65+h-26)+p,c.mergeEndLabel=String.fromCharCode(65+d-26)+String.fromCharCode(65+d-26)+m):(c.mergeStartLabel=String.fromCharCode(65+h)+p,c.mergeEndLabel=String.fromCharCode(65+d)+m)}n+=1,r+=c.width}}},{key:"initContentGroupRowAndColByRow",value:function(e,t){var o=this.contentGroup,i=this.options.cellHeight;this.core.row+=t;for(var l=this.core.col,n=0,r=0,s=0,a=0,c=o.length;a<c;a++){var h=o[a];if((a+1)%l==1&&((n+=1)>1&&(r+=h.height),s=0),h.row>=e&&(h.row=n,h.y=r,h.ltY=r+i,h.x=s,h.ltX=s+i,"insert"===h.label?h.col>=27?h.label=String.fromCharCode(65+h.col-27)+String.fromCharCode(65+h.col-27)+h.row:h.label=String.fromCharCode(65+h.col-1)+h.row:h.label=h.label.replace(/[0-9]/,n),h.isMerge)){var d=h.mergeStartLabel.replace(/[0-9]/,""),u=h.mergeEndLabel.replace(/[0-9]/,""),g=parseInt(h.mergeStartLabel.replace(/[A-Z]/,"")),p=parseInt(h.mergeEndLabel.replace(/[A-Z]/,""));h.mergeStartLabel=d+(g+t),h.mergeEndLabel=u+(p+t)}s+=h.width}}}]),e}(),D=function(){function e(t,i){var l=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;o(this,e),n(this,"clientHorX",0),n(this,"clientVerY",0),n(this,"recordDeltaY",0),n(this,"barTopDis",0),n(this,"barLeftDis",0),n(this,"wheelStep",10),n(this,"selectorDom",null),n(this,"barVerContainerDom",null),n(this,"barHorContainerDom",null),n(this,"layer",null),n(this,"options",{}),n(this,"components",[]),n(this,"barHeight",10),n(this,"contentComponent",null),n(this,"headerComponent",null),n(this,"sideComponent",null),n(this,"horBarDom",null),n(this,"verBarDom",null),n(this,"core",null),n(this,"leftDis",0),n(this,"topDis",0),n(this,"offsetX",0),n(this,"offsetY",0),this.selectorDom=t,this.canvasWrapperDom=a.canvasWrapperDom,this.layer=i,this.core=a,this.options=r,this.components=s,this.contentComponent=s.ContentComponent,this.headerComponent=s.HeaderComponent,this.sideComponent=s.SideComponent,this.wholeComponent=s.WholeComponent,this.registryHorScroll(),this.registryVerScroll(),document.onmouseup=function(){document.onmousemove=null,l.horBarDom.style.backgroundColor="rgb(201, 201, 201)",l.verBarDom.style.backgroundColor="rgb(201, 201, 201)",l.core.canvasDom.onmousemove=null,l.core.dragSign=!1,l.core.lockDrag=!1}}return l(e,[{key:"contentMoveX",value:function(){this.headerComponent.trendsDraw(this.offsetX),this.contentComponent.trendsDraw(this.offsetX,this.offsetY)}},{key:"contentMoveY",value:function(){this.sideComponent.trendsDraw(this.offsetY),this.contentComponent.trendsDraw(this.offsetX,this.offsetY)}},{key:"registryWheel",value:function(e){var t=this;this.canvasWrapperDom.onmouseover=function(){t.canvasWrapperDom.onwheel=function(e){e.preventDefault(),t.recordDeltaY=Math.abs(t.barTopDis),t.recordDeltaY+=e.deltaY>0?t.wheelStep:-t.wheelStep,requestAnimationFrame((function(){var e=t.recordDeltaY;t.verMoveFunc(e)}))}}}},{key:"unRegistryHorScroll",value:function(){this.barHorContainerDom.remove(),this.horBarDom.remove()}},{key:"changeHorBarWidth",value:function(){var e=(this.options.width-this.options.cellHeight-10)/this.core.sheetWidth;this.horBarDom.style.width=(this.options.width-this.options.cellHeight-10)*e+"px"}},{key:"changeVerBarHeight",value:function(){var e=(this.options.height-this.options.cellHeight-10)/this.core.sheetHeight;this.verBarDom.style.height=(this.options.height-this.options.cellHeight-10)*e+"px"}},{key:"registryHorScroll",value:function(){var e=this,t=document.createElement("div");t.style.height=this.barHeight+"px",t.style.width=this.options.width-this.options.cellHeight-10+"px",t.style.left=this.options.cellHeight+"px",t.style.bottom=0,t.style.position="absolute",this.canvasWrapperDom.appendChild(t),this.barHorContainerDom=t;var o=document.createElement("div");this.horBarDom=o;var i=(this.options.width-this.options.cellHeight-10)/this.core.sheetWidth;o.style.width=(this.options.width-this.options.cellHeight-10)*i+"px",o.style.height=this.barHeight+"px",o.style.transformOrigin="left",o.style.userSelect="none",o.style.borderRadius=this.barHeight+"px",o.style.backgroundColor="rgb(201, 201, 201)",o.style.transform="translateX(".concat(this.barLeftDis+"px",")"),t.appendChild(o),o.onmouseover=function(e){o.style.backgroundColor="rgb(150, 150, 150)"},o.onmouseleave=function(e){o.style.backgroundColor="rgb(201, 201, 201)"},o.onmousedown=function(t){t.preventDefault(),document.onmousemove=function(i){o.style.backgroundColor="rgb(150, 150, 150)",e.layer.setCursorDefault(),requestAnimationFrame((function(){var o=i.pageX-(e.canvasWrapperDom.getBoundingClientRect().x+e.options.cellHeight)-t.offsetX;e.horMoveFunc(o)}))}}}},{key:"registryVerScroll",value:function(){var e=this,t=document.createElement("div");t.style.height=this.options.height-this.options.cellHeight-10+"px",t.style.width=this.barHeight+"px",t.style.right=0,t.style.top=this.options.cellHeight+"px",t.style.position="absolute",this.canvasWrapperDom.appendChild(t),this.barVerContainerDom=t;var o=document.createElement("div");this.verBarDom=o;var i=(this.options.height-this.options.cellHeight-10)/this.core.sheetHeight;o.style.width=this.barHeight+"px",o.style.height=(this.options.height-this.options.cellHeight-10)*i+"px",o.style.transformOrigin="top",o.style.userSelect="none",o.style.backgroundColor="rgb(201, 201, 201)",o.style.borderRadius=this.barHeight+"px",o.onmouseover=function(e){o.style.backgroundColor="rgb(150, 150, 150)"},o.onmouseleave=function(e){o.style.backgroundColor="rgb(201, 201, 201)"},t.appendChild(o),this.registryWheel(o),o.onmousedown=function(t){t.preventDefault(),document.onmousemove=function(i){o.style.backgroundColor="rgb(150, 150, 150)",e.layer.setCursorDefault(),requestAnimationFrame((function(){var o=i.pageY-(e.canvasWrapperDom.getBoundingClientRect().y+e.options.cellHeight)-t.offsetY;e.verMoveFunc(o)}))}}}},{key:"horMoveFunc",value:function(e){this.core.plugins.InputPlugin.hideInput();var t=(this.options.width-this.options.cellHeight-10)/this.core.sheetWidth,o=this.options.width-this.options.cellHeight-10-(this.options.width-this.options.cellHeight)*t;e<=0?(this.horBarDom.style.transform="translateX(0px)",this.barLeftDis=0,this.leftDis=0,this.core.isScrollRightBound=!1):e>=o?(this.horBarDom.style.transform="translateX(".concat(o+"px",")"),this.barLeftDis=o,this.leftDis=-(this.core.sheetWidth-(this.options.width-this.options.cellHeight)),this.core.isScrollRightBound=!0):(this.horBarDom.style.transform="translateX(".concat(e+"px",")"),this.barLeftDis=Math.abs(e),this.leftDis=-e/t,this.core.offsetXLock=!1,this.core.isScrollRightBound=!1),this.core.offsetXLock||(this.offsetX=Math.abs(this.leftDis),this.contentMoveX(),(e<=0||e>=o)&&(this.core.offsetXLock=!0))}},{key:"verMoveFunc",value:function(e){this.core.plugins.InputPlugin.hideInput();var t=(this.options.height-this.options.cellHeight-10)/this.core.sheetHeight,o=this.options.height-this.options.cellHeight-10-(this.options.height-this.options.cellHeight)*t;e<=0?(this.verBarDom.style.transform="translateY(0px)",this.barTopDis=0,this.topDis=0,this.core.isScrollBottomBound=!1):e>=o?(this.verBarDom.style.transform="translateY(".concat(o+"px",")"),this.barTopDis=o,this.topDis=-(this.core.sheetHeight-(this.options.height-this.options.cellHeight)),this.core.isScrollBottomBound=!0):(this.verBarDom.style.transform="translateY(".concat(e+"px",")"),this.barTopDis=e,this.topDis=-e/t,this.core.offsetYLock=!1,this.core.isScrollBottomBound=!1),this.core.offsetYLock||(this.offsetY=Math.abs(this.topDis),this.contentMoveY(),(e<=0||e>=o)&&(this.core.offsetYLock=!0))}}]),e}(),M=function(){function e(t,i){var l=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;o(this,e),n(this,"options",{}),n(this,"core",null),n(this,"selectorDom",null),n(this,"contentComponent",null),n(this,"headerComponent",null),n(this,"sideBorderLine",null),n(this,"dblClickContext",null),n(this,"clickContext",null),n(this,"inputDom",null),n(this,"rectContext",null),n(this,"headerBorderLine",null),this.contentComponent=s.ContentComponent,this.headerComponent=s.HeaderComponent,this.sideComponent=s.SideComponent,this.wholeComponent=s.WholeComponent,this.selectorDom=t,this.canvasDom=a.canvasDom,this.canvasWrapperDom=a.canvasWrapperDom,this.options=r,this.layer=i,this.core=a,this.appendInput(),a.plugins.ScrollPlugin.horBarDom.addEventListener("mousedown",(function(){l.inputDom.style.display="none"})),a.plugins.ScrollPlugin.verBarDom.addEventListener("mousedown",(function(){l.inputDom.style.display="none"}))}return l(e,[{key:"hideInput",value:function(){this.inputDom.style.display="none",this.inputDom.value="",this.inputDom.oninput=null}},{key:"setCellText",value:function(){this.contentComponent.clickCell.text=this.inputDom.value}},{key:"showInput",value:function(e){var t=this,o=this.inputDom,i=this.core.plugins.ScrollPlugin,l=i.offsetX,n=i.offsetY,r=this.options.cellHeight,s=e.x,a=e.y,c=e.width,h=e.height,d=e.text,u=e.isMerge,g=e.mergeWidth,p=e.mergeHeight,m=e.bgColor,f=e.fontColor,v=d.length*this.core.fontSize,C=u?g:c;o.style.opacity=1,o.style.top=a+r-n+"px",o.style.left=s+r-l+"px",o.style.display="inline-block",o.style.textAlign="center",o.style.width=(C>v?C:v)+"px",o.style.height=(u?p:h)+"px",o.style.borderRadius="6px",o.style.backgroundColor=null!=m?m:"",o.style.color=null!=f?f:"",o.value=d,o.oninput=function(e){t.core.plugins.SettingPlugin.setCellCon(e.target.value)}}},{key:"appendInput",value:function(){var e=this,t=document.createElement("input");this.inputDom=t,t.style.display="none",t.style.position="absolute",t.style.outline="none",t.style.border="2px solid "+this.core.selectedBorderBgColor,t.style.boxSizing="border-box",this.canvasWrapperDom.appendChild(t),this.canvasDom.addEventListener("dblclick",(function(o){e.contentComponent.hideSelectedCellDom();var i=e.options.cellHeight;if(!(o.offsetX<=i||o.offsetY<=i)){e.core.plugins.SelectPlugin.clearCopyDash();var l=e.core.plugins.ScrollPlugin,n=l.offsetX,r=l.offsetY,s=e.contentComponent.clickCell,a=s.x,c=s.y,h=s.width,d=s.height,u=s.text,g=s.isMerge,p=s.mergeWidth,m=s.mergeHeight,f=s.bgColor,v=s.fontColor;e.core.fresh();var C=g?p:h,y=u.length*e.core.fontSize;t.style.opacity=1,t.style.top=c+i-r+"px",t.style.left=a+i-n+"px",t.style.display="inline-block",t.style.textAlign="center",t.style.width=(C>y?C:y)+"px",t.style.height=(g?m:d)+"px",t.style.borderRadius="6px",t.style.backgroundColor=null!=f?f:"",t.style.color=null!=v?v:"",t.value=u,t.focus(),t.onblur=function(o){t.value?(o.relatedTarget&&e.selectorDom.contains(o.relatedTarget)||e.core.plugins.SettingPlugin.changeStepArr({type:1,label:s.label,pre:s.text,next:t.value}),s.text=t.value,e.core.wsSend(2,s),e.inputDom.value="",e.core.fresh(),e.hideInput()):e.hideInput()},t.oninput=function(t){e.core.plugins.SettingPlugin.setCellCon(t.target.value)}}}))}}]),e}(),I=function(){function e(t,i){var l=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;o(this,e),n(this,"options",{}),n(this,"core",null),n(this,"selectorDom",null),n(this,"contentComponent",null),n(this,"headerComponent",null),n(this,"sideBorderLine",null),n(this,"clickContext",null),n(this,"inputDom",null),n(this,"copyKey",["text","mergeWidth","mergeHeight","mergeRow","mergeCol","isMerge","bgColor","fontColor"]),n(this,"moreShiftSelectClick",(function(e){if(l.core.shiftKey){var t=l.options.cellHeight,o=l.core.plugins.ScrollPlugin,i=o.offsetX,n=o.offsetY,r=l.contentComponent.clickCell,s=l.searchRectAddr(e.offsetX+i-t,e.offsetY+n-t);if(s.isMerge){var a=s.x>r.x,c=s.y>r.y;a&&!c?s=l.searchRectByColAndRow(s.col+s.mergeCol-1,s.row):a&&c?s=l.searchRectByColAndRow(s.col+s.mergeCol-1,s.row+s.mergeRow-1):!a&&c&&(s=l.searchRectByColAndRow(s.col,s.row+s.mergeRow-1))}l.contentComponent.setSecondClickCell(s),l.core.fresh()}})),n(this,"moreCtrlSelectClick",(function(e){if(l.core.shiftKey){var t=l.options.cellHeight,o=l.core.plugins.ScrollPlugin,i=o.offsetX,n=o.offsetY,r=l.searchRectAddr(e.offsetX+i-t,e.offsetY+n-t);l.contentComponent.setSecondClickCell(r),l.core.fresh()}})),this.contentComponent=s.ContentComponent,this.headerComponent=s.HeaderComponent,this.sideComponent=s.SideComponent,this.selectorDom=t,this.canvasDom=a.canvasDom,this.options=r,this.layer=i,this.core=a,this.showClickHandler(),this.moreSelect(),this.displayColTextRegister()}return l(e,[{key:"displayAllTextByCol",value:function(e,t){var o=this,i=this.options.cellHeight,l=this.contentComponent.contentGroup.filter((function(t){return t.col===e})).map((function(e){return o.layer.ctx.measureText(e.text).width+i}));l.push(t);var n=l.sort((function(e,t){return e-t}))[l.length-1];this.core.plugins.DragPlugin.expandWidthNoDrag(e,n-t)}},{key:"displayColTextRegister",value:function(){var e=this;this.canvasDom.addEventListener("dblclick",(function(t){var o=e.options.cellHeight,i=e.core.plugins.ScrollPlugin,l=i.offsetX;i.offsetY;var n=t.offsetX+l;if(t.offsetY<=o){for(var r=null,s=e.headerComponent.headerRectGroup,a=0;a<s.length;a++){var c=s[a];if(n>c.ltX&&n<c.ltX+c.width){r=c;break}}e.displayAllTextByCol(r.col,r.width)}}))}},{key:"copyText",value:function(e){navigator.clipboard.writeText(e)}},{key:"searchMergeArr",value:function(e,t,o,i){var l=[];return this.contentComponent.contentGroup.forEach((function(n){n.col>=e&&n.col<=o&&n.row>=t&&n.row<=i&&l.push(n)})),l.splice(1,l.length)}},{key:"copyRect",value:function(e,t){var o=e.width,i=e.height,l=this.searchMergeArr(e.col,e.row,e.col+t.mergeCol-1,e.row+t.mergeRow-1);e.mergeEndLabel=l[l.length-1].label,e.mergeStartLabel=e.label,e.isMerge=!0,l.forEach((function(t){t.isMerge=!0,t.mergeStartLabel=e.label,t.mergeEndLabel=l[l.length-1].label,e.row===t.row&&e.label!==t.label&&(o+=t.width),e.col===t.col&&e.label!==t.label&&(i+=t.height)})),e.mergeWidth=o,e.mergeHeight=i}},{key:"setCellAttr",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["row","col","x","y","ltX","ltY","mergeStartLabel","mergeEndLabel","label","isFromExcel","width","height"];for(var i in t)o.includes(i)||(e[i]=t[i]);t.isMerge&&(e.mergeStartLabel=String.fromCharCode(65+e.col-1)+e.row,e.mergeEndLabel=String.fromCharCode(65+e.col+e.mergeCol-2)+(e.row+e.mergeRow-1))}},{key:"tableDomToArr",value:function(e){for(var t=[],o=e.querySelectorAll("tr"),i=0;i<o.length;i++){t[i]=[];for(var l=o[i].querySelectorAll("td"),n=0;n<l.length;n++)t[i].push(l[n])}return t}},{key:"transformTableDomStrToCanvasCell",value:function(e,t){var o=this.core.h,i=(new DOMParser).parseFromString(e,"text/html"),l=i.querySelector("style")?i.querySelector("style").sheet.cssRules:[],n=i.querySelector("table");if(n){for(var r=n.querySelectorAll("tr"),s=this.tableDomToArr(n),a=o("td"),c=function(e){for(var t=s[e],o=function(o){var i=t[o];if(i||s[e].push(a.cloneNode()),i.rowSpan>1)for(var l=1,n=i.rowSpan;l<n;l++)s[e+l].splice(o,0,a.cloneNode());i.colSpan>1&&new Array(i.colSpan-1).fill(0).forEach((function(t){s[e].splice(o+1,0,a.cloneNode())}))},i=0;i<t.length;i++)o(i)},h=0;h<s.length;h++)c(h);for(var d=s.length,u=null,g=0;g<s.length;g++)for(var p=s[g],m=0;m<p.length;m++){var f=p[m],v={};if(p[m].getAttribute("data-json"))v=JSON.parse(p[m].getAttribute("data-json"));else{for(var C,y="",b="",w="",x="",k=0,S=l.length;k<S;k++)f.className===l[k].selectorText.replace(".","")&&(y=""!==l[k].style.backgroundColor?l[k].style.backgroundColor:null,b=""!==l[k].style.color?l[k].style.color:null,""===l[k].style.textAlign||l[k].style.textAlign,w=""!==l[k].style.fontSize?l[k].style.fontSize.replace("pt","px"):"12px",x=""!==l[k].style.fontFamily?l[k].style.fontFamily:null);C=w+" "+x,v={mergeRow:f.rowSpan>1?f.rowSpan:f.colSpan>1?1:0,mergeCol:f.colSpan>1?f.colSpan:f.rowSpan>1?1:0,isMerge:f.colSpan&&f.colSpan>1||f.rowSpan&&f.rowSpan>1,text:f.innerText,isFromExcel:!0,bgColor:y,fontColor:b,font:C,fontSize:w,fontFamily:x}}var D=this.searchRectByColAndRow(t.col+m,t.row+g);if(g===r.length-1&&m===p.length-1&&(u=D),v.isMerge)for(var M=D.row+v.mergeRow,I=D.col+v.mergeCol,L=D.row;L<M;L++)for(var A=D.col;A<I;A++)if(L===D.row&&A===D.col)this.setCellAttr(D,v),v.isFromExcel&&(D.mergeWidth=D.width,D.mergeHeight=D.height);else{var B=this.searchRectByColAndRow(A,L);B.isMerge=!0,B.mergeStartLabel=D.mergeStartLabel,B.mergeEndLabel=D.mergeEndLabel,v.isFromExcel&&(B.col===D.col&&(D.mergeHeight+=B.height),B.row===D.row&&(D.mergeWidth+=B.width))}else D.isMerge||this.setCellAttr(D,v)}0===d&&(u=null),this.contentComponent.showClickRect(t),this.contentComponent.setSecondClickCell(u),this.core.fresh()}}},{key:"transformCanvasCellToTableDomStr",value:function(){var e=this.contentComponent,t=e.clickCell,o=e.secondClickCell,i=e.clickRectShow,l=e.moreSelectedCell,n=this.core.h;if(i){var r=n("table"),s=n("tr"),a=n("td");if(t&&!o)if(t.isMerge)for(var c=t.row+t.mergeRow,h=t.row;h<c;h++){var d=s.cloneNode();if(h===t.row){var u=a.cloneNode();this.setTdAttrs(u,t),d.appendChild(u)}r.appendChild(d)}else{var g=s.cloneNode(),p=a.cloneNode();this.setTdAttrs(p,t),g.appendChild(p),r.appendChild(g)}else if(o)for(var m=0,f=null,v=0;v<l.length;v++){var C=l[v];if(m!==C.row&&(m=C.row,f=s.cloneNode(),r.appendChild(f)),C.isMerge&&C.label===C.mergeStartLabel||!C.isMerge){var y=a.cloneNode();this.setTdAttrs(y,C),f.appendChild(y)}}var b=r.outerHTML;return s.remove(),a.remove(),b}}},{key:"clearCopyDash",value:function(){this.copyText(""),this.core.copyKey=!1,this.core.copyCellDash=[],this.core.freshContent()}},{key:"moreSelect",value:function(){var e=this;document.addEventListener("paste",(function(t){var o=e.contentComponent,i=o.clickRectShow,l=o.clickCell;i&&e.transformTableDomStrToCanvasCell(t.clipboardData.getData("text/html"),l)})),document.addEventListener("copy",(function(t){t.preventDefault();var o=e.transformCanvasCellToTableDomStr();t.clipboardData.setData("text/html",o);var i=e.contentComponent,l=i.clickCell,n=i.moreSelectedCell;if(e.core.copyKey=!0,n.length>0)e.core.copyCellDash=n;else{if(!l)return;e.core.copyCellDash=[l]}e.core.freshContent()})),document.addEventListener("keydown",(function(t){e.core.shiftKey=t.shiftKey,e.core.ctrlKey=t.ctrlKey,t.shiftKey&&t.ctrlKey&&"KeyZ"===t.code||t.ctrlKey&&"z"===t.code||"Escape"===t.code&&e.clearCopyDash()})),document.addEventListener("keyup",(function(t){e.core.shiftKey=t.shiftKey,e.core.ctrlKey=t.ctrlKey})),this.canvasDom.addEventListener("mousedown",this.moreShiftSelectClick)}},{key:"setTdAttrs",value:function(e,t){t.isMerge&&(e.rowSpan=t.mergeRow,e.colSpan=t.mergeCol),e.innerText=t.text,e.style.backgroundColor=t.bgColor,e.style.color=t.fontColor,e.style.width=t.width+"px",e.style.height=t.height+"px",e.style.textAlign=t.textAlign,e.setAttribute("data-json",JSON.stringify(t))}},{key:"showClickHandler",value:function(){var e=this;this.canvasDom.addEventListener("mousedown",(function(t){if(!(2===t.button&&e.contentComponent.secondClickCell||(e.core.plugins.ContextmenuPlugin.hideContextMenu(),e.core.shiftKey||e.core.ctrlKey||e.core.dragSign))){var o=e.options,i=o.cellHeight;o.cellWidth;var l=e.core.plugins.ScrollPlugin,n=l.offsetX,r=l.offsetY;if(l.topDis,l.barVerContainerDom,l.barHorContainerDom,t.offsetY<=i&&t.offsetX<=i)e.contentComponent.setSecondClickCell(null),e.contentComponent.showClickRect({},!0,!0),e.contentComponent.hideSelectedCellDom();else if(t.offsetY<=i&&t.offsetX>i){var s=e.searchHeaderRectAddr(t.offsetX+n-i);s&&(e.contentComponent.setSecondClickCell(null),e.contentComponent.showClickRect(s,!0)),e.contentComponent.hideSelectedCellDom()}else if(t.offsetY>i&&t.offsetX<=i){var a=e.searchSideRectAddr(t.offsetY+r-i);a&&(e.contentComponent.setSecondClickCell(null),e.contentComponent.showClickRect(a,!1,!0)),e.contentComponent.hideSelectedCellDom()}else{var c=e.searchRectAddr(t.offsetX+n-i,t.offsetY+r-i);c&&(e.core.wsSend(1,c),e.contentComponent.showClickRect(c),e.core.plugins.SettingPlugin.setCellAttrInHeader(c),e.contentComponent.setSecondClickCell(null),e.canvasDom.onmousemove=function(t){var o,l=e.core.plugins.ScrollPlugin,n=l.offsetX,r=l.offsetY,s=e.searchRectAddr(t.offsetX+n-i,t.offsetY+r-i);if(s&&c.label===s.label)e.contentComponent.setSecondClickCell(null);else if(s&&s.label!==(null===(o=e.contentComponent.secondClickCell)||void 0===o?void 0:o.label)){var a=s.x>c.x,h=s.y>c.y;s.isMerge&&(a&&!h?s=e.searchRectByColAndRow(s.col+s.mergeCol-1,s.row):a&&h?s=e.searchRectByColAndRow(s.col+s.mergeCol-1,s.row+s.mergeRow-1):!a&&h&&(s=e.searchRectByColAndRow(s.col,s.row+s.mergeRow-1))),e.contentComponent.setSecondClickCell(s),e.core.fresh()}})}e.core.fresh()}}))}},{key:"searchRectIsMerge",value:function(e,t,o,i){var l=this.contentComponent.contentGroup.find((function(l){return l.x>=e&&l.x<=o&&l.y>=t&&l.y<=i&&l.isMerge}));return l?{startRect:this.searchRectByLabel(l.mergeStartLabel),endRect:this.searchRectByLabel(l.mergeEndLabel)}:null}},{key:"searchRectByLabel",value:function(e){var t=this.contentComponent.contentGroup,o=t.findIndex((function(t){return t.label===e}));return-1!==o?t[o]:null}},{key:"searchRectByColAndRow",value:function(e,t){var o=this.contentComponent.contentGroup,i=o.findIndex((function(o){return o.col===e&&o.row===t}));return-1!==i?o[i]:null}},{key:"searchRectAddr",value:function(e,t){for(var o,i=this.contentComponent.contentGroup,l=function(){var o=i[n];if(e>=o.x&&e<=o.x+o.width&&t>=o.y&&t<=o.y+o.height){if(o.isMerge){if(o.label===o.mergeStartLabel)return{v:o};var l=i.findIndex((function(e){return e.label===o.mergeStartLabel}));return{v:i[l]}}return{v:o}}},n=0;n<i.length;n++)if(o=l())return o.v}},{key:"searchHeaderRectAddr",value:function(e){for(var t=this.headerComponent.headerRectGroup,o=0;o<t.length;o++){var i=t[o];if(e>=i.x&&e<=i.x+i.width)return i}}},{key:"searchSideRectAddr",value:function(e){for(var t=this.sideComponent.sideRectGroup,o=0;o<t.length;o++){var i=t[o];if(e>=i.y&&e<=i.y+i.height)return i}}}]),e}(),L=function(){function e(t,i){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0;o(this,e),n(this,"dragShowDis",6),n(this,"dragCell",null),n(this,"stepObj",{}),this.contentComponent=r.ContentComponent,this.headerComponent=r.HeaderComponent,this.sideComponent=r.SideComponent,this.selectorDom=t,this.canvasDom=s.canvasDom,this.options=l,this.layer=i,this.core=s,this.registerDragEvent()}return l(e,[{key:"expandWidthNoDrag",value:function(e,t){for(var o=this.contentComponent.contentGroup,i=0;i<o.length;i++){var l=o[i];if(!(l.col<e)&&(l.col===e?l.width+=t:l.col>e&&(l.x+=t,l.ltX+=t),l.col===e&&1===l.row&&(this.core.sheetWidth+=t),l.isMerge&&l.mergeStartLabel===l.label&&l.col===e&&(l.mergeWidth+=t),l.isMerge&&l.mergeStartLabel!==l.label&&l.col===e)){var n=this.contentComponent.searchRectByLabel(l.mergeStartLabel);n.row===l.row&&(n.mergeWidth+=t)}}this.core.freshScrollBar(),this.core.fresh()}},{key:"expandHeightNoDrag",value:function(e,t){for(var o=this.contentComponent.contentGroup,i=0;i<o.length;i++){var l=o[i];if(l.row===e?l.height+=t:l.row>e&&(l.y+=t,l.ltY+=t),l.row===e&&1===l.col&&(this.core.sheetHeight+=t),l.isMerge&&l.mergeStartLabel===l.label&&l.row===e&&(l.mergeHeight+=t),l.isMerge&&l.mergeStartLabel!==l.label&&l.row===e){var n=this.contentComponent.searchRectByLabel(l.mergeStartLabel);n.col===l.col&&(n.mergeHeight+=t)}}this.core.freshScrollBar(),this.core.fresh()}},{key:"expandWidth",value:function(e,t){var o=this.contentComponent.contentGroup,i=this.options.cellHeight;if(this.layer.setCursor("col-resize"),!this.dragCell||this.dragCell.width+t<i&&t<0)return this.stepObj.next={width:i},void(this.dragCell=null);for(var l=0;l<o.length;l++){var n=o[l];if(!(n.col<e)&&(n.col===e?n.width+=t:n.col>e&&(n.x+=t,n.ltX+=t),n.col===e&&1===n.row&&(this.core.sheetWidth+=t),n.isMerge&&n.mergeStartLabel===n.label&&n.col===e&&(n.mergeWidth+=t),n.isMerge&&n.mergeStartLabel!==n.label&&n.col===e)){var r=this.contentComponent.searchRectByLabel(n.mergeStartLabel);r.row===n.row&&(r.mergeWidth+=t)}}this.core.freshScrollBar(),this.core.fresh()}},{key:"expandHeight",value:function(e,t){var o=this.contentComponent.contentGroup,i=this.options.cellHeight;if(this.layer.setCursor("col-resize"),!this.dragCell||this.dragCell.height+t<i&&t<0)return this.stepObj.next={height:i},void(this.dragCell=null);for(var l=0;l<o.length;l++){var n=o[l];if(n.row===e?n.height+=t:n.row>e&&(n.y+=t,n.ltY+=t),n.row===e&&1===n.col&&(this.core.sheetHeight+=t),n.isMerge&&n.mergeStartLabel===n.label&&n.row===e&&(n.mergeHeight+=t),n.isMerge&&n.mergeStartLabel!==n.label&&n.row===e){var r=this.contentComponent.searchRectByLabel(n.mergeStartLabel);r.col===n.col&&(r.mergeHeight+=t)}}this.core.freshScrollBar(),this.core.fresh()}},{key:"registerDragEvent",value:function(){var e=this;this.canvasDom.addEventListener("mouseup",(function(t){e.core.lockDrag=!1,e.dragCell&&(e.stepObj.next={width:e.dragCell.width,height:e.dragCell.height},e.core.plugins.SettingPlugin.changeStepArr(JSON.parse(JSON.stringify(e.stepObj))),e.core.wsSend(3,e.dragCell))})),this.canvasDom.addEventListener("mousedown",(function(t){if(e.core.lockDrag=!0,e.dragCell&&e.core.dragSign){e.stepObj.pre={},e.stepObj.label=e.dragCell.label,e.stepObj.pre.width=e.dragCell.width,e.stepObj.pre.height=e.dragCell.height;var o=0,i=t.pageX,l=0,n=t.pageY;e.canvasDom.onmousemove=function(t){if(!e.dragCell)return!1;e.core.dragSignDirectionIsHor?(o=t.pageX,e.stepObj.type=11,e.expandWidth(e.dragCell.col,o-i),i=o):(l=t.pageY,e.stepObj.type=12,e.expandHeight(e.dragCell.row,l-n),n=l)}}})),this.canvasDom.addEventListener("mousemove",(function(t){if(e.core.lockDrag)return!1;var o=e.headerComponent.headerRectGroup,i=e.sideComponent.sideRectGroup,l=e.core.plugins.ScrollPlugin,n=l.offsetX,r=l.offsetY,s=e.options.cellHeight,a=e.dragShowDis,c=t.offsetX+n,h=t.offsetY+r;if(e.dragCell&&(c<e.dragCell.ltX+e.dragCell.width-a||c>e.dragCell.ltX+e.dragCell.width+a+1)&&(e.core.dragSign=!1,e.dragCell=null),e.dragCell&&(h<e.dragCell.ltY+e.dragCell.height-a||c>e.dragCell.ltY+e.dragCell.height+a+1)&&(e.core.dragSign=!1,e.dragCell=null),!e.core.lockDrag){if(t.offsetY<=s){t.offsetX>s&&e.layer.setCursor("s-resize");for(var d=0;d<o.length;d++){var u=o[d];c>u.ltX+u.width-a&&c<u.ltX+u.width+a+1&&(e.core.dragSign||(e.dragCell=u),e.layer.setCursor("col-resize"),e.core.dragSign=!0,e.core.dragSignDirectionIsHor=!0)}}if(t.offsetX<=s){t.offsetY>s&&e.layer.setCursor("e-resize");for(var g=0;g<i.length;g++){var p=i[g];h>p.ltY+p.height-a&&h<p.ltY+p.height+a+1&&(e.core.dragSign||(e.dragCell=p),e.layer.setCursor("row-resize"),e.core.dragSign=!0,e.core.dragSignDirectionIsHor=!1)}}}}))}}]),e}(),A=function(){function e(t,i){var l=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;o(this,e),n(this,"containerDom",null),n(this,"hideContextMenu",(function(){l.containerDom.style.display="none"})),n(this,"insertRow",(function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t){var i=l.core.col,n=l.options,r=n.cellWidth,s=n.cellHeight,a=l.contentComponent.contentGroup;l.core.sheetHeight+=t*s;for(var c=l.contentComponent.searchRectIndexByColAndRow(1,o?e:e+1),h=function(){var t=a[c];new Array(i).fill(void 0).forEach((function(o,l){a.splice(c,0,{row:e,col:i-l,text:"",width:r,height:s,x:t.x,y:t.y,ltX:t.ltX,ltY:t.ltY,mergeWidth:0,mergeHeight:0,mergeRow:1,mergeCol:1,mergeStartLabel:"",mergeEndLabel:"",mergeLabelGroup:[],isMerge:!1,bgColor:null,fontColor:null,font:null,textAlign:"center",label:"insert"})}))},d=1;d<=t;d++)h();l.contentComponent.initContentGroupRowAndColByRow(e,t),l.contentComponent.hideClickRect(),l.core.fresh(),l.core.plugins.ScrollPlugin.changeVerBarHeight()}})),n(this,"insertCol",(function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t){var i=l.core.row,n=l.options,r=n.cellWidth,s=n.cellHeight,a=l.contentComponent.contentGroup;l.core.sheetWidth+=t*r;for(var c=function(i){var n=l.contentComponent.searchRectIndexByColAndRow(e,i),c=a[n];new Array(t).fill(void 0).forEach((function(t){a.splice(o?n:n+1,0,{row:i,col:e,text:"",width:r,height:s,x:c.x,y:c.y,ltX:c.ltX,ltY:c.ltY,mergeWidth:0,mergeHeight:0,mergeRow:1,mergeCol:1,mergeStartLabel:"",mergeEndLabel:"",mergeLabelGroup:[],isMerge:!1,bgColor:null,fontColor:null,font:null,textAlign:"center",label:"insert"})}))},h=1;h<=i;h++)c(h);l.contentComponent.initContentGroupRowAndColByCol(e,t),l.contentComponent.hideClickRect(),l.core.fresh(),l.core.plugins.ScrollPlugin.changeHorBarWidth()}})),n(this,"splitCell",(function(e){if(e.isMerge){e.mergeEndLabel="",e.mergeStartLabel="",e.isMerge=!1;for(var t=e.row,o=e.row+e.mergeRow;t<o;t++)for(var i=e.col,n=e.col+e.mergeCol;i<n;i++)if(t===e.row&&i===e.col);else{var r=l.contentComponent.searchRectByColAndRow(i,t);r.mergeEndLabel="",r.mergeStartLabel="",r.isMerge=!1}e.mergeRow=1,e.mergeCol=1,l.contentComponent.showClickRect(e),l.core.fresh(),l.hideContextMenu()}})),n(this,"mergeCell",(function(e,t){if(!t.some((function(e){return e.isMerge}))&&0!==t.length){var o=e.width,i=e.height;e.mergeEndLabel=t[t.length-1].label,e.mergeStartLabel=e.label,e.isMerge=!0,e.mergeRow=1,e.mergeCol=1,t.forEach((function(l){l.isMerge=!0,l.mergeStartLabel=e.label,l.mergeEndLabel=t[t.length-1].label,e.row===l.row&&e.label!==l.label&&(o+=l.width,e.mergeCol+=1),e.col===l.col&&e.label!==l.label&&(i+=l.height,e.mergeRow+=1)})),e.mergeWidth=o,e.mergeHeight=i,l.contentComponent.setSecondClickCell(null),l.contentComponent.showClickRect(e),l.core.freshContent(),l.hideContextMenu()}})),this.contentComponent=s.ContentComponent,this.headerComponent=s.HeaderComponent,this.sideComponent=s.SideComponent,this.selectorDom=t,this.canvasDom=a.canvasDom,this.canvasWrapperDom=a.canvasWrapperDom,this.options=r,this.layer=i,this.core=a,this.registryContextMenu()}return l(e,[{key:"registryContextMenu",value:function(){var e=this,t=this.core.h,o=t("div",{style:{display:"none"},attr:{className:"e-sheet-contextmenu-layout"}}),i=t("div",{style:{cursor:"pointer"},attr:{innerText:"合并单元格",className:"item-btn"}}),l=t("div",{style:{cursor:"pointer"},attr:{innerText:"拆分单元格",className:"item-btn"}}),n=t("div",{attr:{className:"item-input-btn item-top-border"}},[t("span",{attr:{innerText:"左侧插入"}}),t("input",{attr:{type:"number",placeholder:"请输入列数",className:"input-con",onkeydown:function(t){if("Enter"===t.key){var o=e.contentComponent.clickCell;e.contentComponent.isHasMergerInRectArrByCol(o.col)||e.insertCol(o.col,t.target.valueAsNumber),t.target.value=null,e.hideContextMenu()}}}}),t("span",{attr:{innerText:"列"}})]),r=t("div",{style:{cursor:"pointer"},attr:{className:"item-input-btn item-top-border"}},[t("span",{attr:{innerText:"右侧插入"}}),t("input",{attr:{type:"number",placeholder:"请输入列数",className:"input-con",onkeydown:function(t){if("Enter"===t.key){var o=e.contentComponent.clickCell;e.contentComponent.isHasMergerInRectArrByCol(o.col)||e.insertCol(o.col,t.target.valueAsNumber,!1),t.target.value=null,e.hideContextMenu()}}}}),t("span",{attr:{innerText:"列"}})]),s=t("div",{style:{cursor:"pointer"},attr:{className:"item-input-btn item-top-border"}},[t("span",{attr:{innerText:"上侧插入"}}),t("input",{attr:{type:"number",placeholder:"请输入行数",className:"input-con",onkeydown:function(t){if("Enter"===t.key){var o=e.contentComponent.clickCell;e.contentComponent.isHasMergerInRectArrByRow(o.row)||e.insertRow(o.row,t.target.valueAsNumber),t.target.value=null,e.hideContextMenu()}}}}),t("span",{attr:{innerText:"行"}})]),a=t("div",{style:{cursor:"pointer"},attr:{className:"item-input-btn item-top-border"}},[t("span",{attr:{innerText:"下侧插入"}}),t("input",{attr:{type:"number",placeholder:"请输入行数",className:"input-con",onkeydown:function(t){if("Enter"===t.key){var o=e.contentComponent.clickCell;e.contentComponent.isHasMergerInRectArrByRow(o.row)||e.insertRow(o.row,t.target.valueAsNumber,!1),t.target.value=null,e.hideContextMenu()}}}}),t("span",{attr:{innerText:"行"}})]);this.containerDom=o,this.canvasDom.addEventListener("contextmenu",(function(t){t.preventDefault();var n=e.contentComponent.clickCell,r=e.options.cellHeight,s=e.core.plugins.ScrollPlugin;s.offsetX,s.offsetY,t.offsetX<=r||t.offsetY<=r||n&&(o.style.display="flex",o.style.left=t.offsetX+"px",o.style.top=t.offsetY+"px",n.isMerge?(i.style.display="none",l.style.display="flex"):(l.style.display="none",i.style.display="flex"))})),i.onclick=function(t){var o=e.contentComponent,i=o.clickCell,l=o.mergeSelectedCell,n=[i].concat(p(l)).sort((function(e,t){return e.row-t.row+(e.col-t.col)}));e.mergeCell(n[0],n.slice(0))},l.onclick=function(t){var o=e.contentComponent.clickCell;e.splitCell(o)},o.appendChild(i),o.appendChild(l),o.appendChild(n),o.appendChild(r),o.appendChild(s),o.appendChild(a),this.canvasWrapperDom.appendChild(o)}}]),e}(),B=function(){function e(t,i){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0;o(this,e),n(this,"labelInputDom",null),n(this,"fxInputDom",null),n(this,"fontHorAddrGroup",null),n(this,"fontVerAddrGroup",null),n(this,"fontSizeSelectDom",null),n(this,"fontColorSelectDom",null),n(this,"bgColorSelectDom",null),n(this,"fontItalicBtnDom",null),n(this,"fontWeightBtnDom",null),n(this,"cellMergerBtnDom",null),n(this,"cellSplitBtnDom",null),this.contentComponent=r.ContentComponent,this.headerComponent=r.HeaderComponent,this.sideComponent=r.SideComponent,this.selectorDom=t,this.canvasDom=s.canvasDom,this.canvasWrapperDom=s.canvasWrapperDom,this.options=l,this.layer=i,this.core=s,this.registrySettingDom()}return l(e,[{key:"setLabelCon",value:function(e){this.labelInputDom.value=e}},{key:"setCellCon",value:function(e){this.fxInputDom.value=e}},{key:"cellFontTextAlignChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.textAlign=e,this.core.freshContent())}},{key:"cellFontTextBaseLineChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.textBaseline=e,this.core.freshContent())}},{key:"cellFontSizeChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.fontSize=e,this.core.freshContent())}},{key:"cellFontColorChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.fontColor=e,this.core.freshContent())}},{key:"cellBgColorChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.bgColor=e,this.core.freshContent())}},{key:"cellFontWeightChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.fontWeight=e,this.core.freshContent())}},{key:"cellFontItalicChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.fontItalic=e,this.core.freshContent())}},{key:"setCellAttrInHeader",value:function(e){this.fontHorAddrGroup.setAttribute("value",e.textAlign),this.fontVerAddrGroup.setAttribute("value",e.textBaseline),this.fontSizeSelectDom.setAttribute("value",e.fontSize),this.fontWeightBtnDom.setAttribute("current",e.fontWeight),this.fontItalicBtnDom.setAttribute("current",e.fontItalic),e.isMerge?(this.cellMergerBtnDom.style.display="none",this.cellSplitBtnDom.style.display="flex"):(this.cellMergerBtnDom.style.display="flex",this.cellSplitBtnDom.style.display="none"),this.setLabelCon(e.label),this.setCellCon(e.text)}},{key:"changeFirstSelectedCell",value:function(e){var t=this.contentComponent.searchRectByLabel(e);t&&(this.contentComponent.showClickRect(t),this.setCellAttrInHeader(t),this.setCellCon(t.text),this.contentComponent.setSecondClickCell(null),this.core.fresh())}},{key:"convenientChangeStepArr",value:function(e,t,o){var i=this.contentComponent.clickCell;this.changeStepArr({type:e,label:i.label,pre:i[t],next:o})}},{key:"changeStepArr",value:function(e){var t=this.core.getCurrentSheet();t.stepNum!==t.step.length-1?-1===t.stepNum?t.step.splice(t.stepNum+1,t.step.length,e):t.step.splice(t.stepNum+1,t.step.length-1-t.stepNum,e):t.step.push(e),t.stepNum+=1}},{key:"forwardSetSheet",value:function(){var e=this.core,t=this.contentComponent,o=e.getCurrentSheet();if(o.stepNum!==o.step.length-1){var i=o.step[o.stepNum+1],l=t.searchRectByLabel(i.label);switch(i.type){case 1:l.text=i.next,t.showClickRect(l);break;case 2:l.fontSize=i.next;break;case 3:l.textAlign=i.next;break;case 4:l.textBaseline=i.next;break;case 5:l.fontWeight=i.next;break;case 6:l.fontItalic=i.next;break;case 7:l.fontColor=i.next;break;case 8:l.bgColor=i.next;break;case 9:for(var n=[],r=1;r<i.next.length;r++)n.push(t.searchRectByLabel(i.next[r]));var s=t.searchRectByLabel(i.next[0]);this.core.plugins.ContextmenuPlugin.mergeCell(s,n);break;case 10:var a=t.searchRectByColAndRow(i.next.col,i.next.row);this.core.plugins.ContextmenuPlugin.splitCell(a);break;case 11:this.core.plugins.DragPlugin.expandWidthNoDrag(l.col,i.next.width-i.pre.width);break;case 12:this.core.plugins.DragPlugin.expandHeightNoDrag(l.row,i.next.height-i.pre.height)}e.fresh(),o.stepNum+=1}}},{key:"fallbackSetSheet",value:function(){var e=this.core,t=this.contentComponent,o=e.getCurrentSheet();if(-1!==o.stepNum){var i=o.step[0===o.stepNum?0:o.stepNum],l=t.searchRectByLabel(i.label);switch(i.type){case 1:l.text=i.pre,t.showClickRect(l);break;case 2:l.fontSize=i.pre;break;case 3:l.textAlign=i.pre;break;case 4:l.textBaseline=i.pre;break;case 5:l.fontWeight=i.pre;break;case 6:l.fontItalic=i.pre;break;case 7:l.fontColor=i.pre;break;case 8:l.bgColor=i.pre;break;case 9:var n=t.searchRectByLabel(i.pre);this.core.plugins.ContextmenuPlugin.splitCell(n);break;case 10:for(var r=[],s=0;s<i.pre.mergeRow;s++)for(var a=0;a<i.pre.mergeCol;a++)0===s&&0===a||r.push(t.searchRectByColAndRow(i.pre.col+a,i.pre.row+s));var c=t.searchRectByLabel(i.pre.mergeStartLabel);this.core.plugins.ContextmenuPlugin.mergeCell(c,r);break;case 11:this.core.plugins.DragPlugin.expandWidthNoDrag(l.col,i.pre.width-i.next.width);break;case 12:this.core.plugins.DragPlugin.expandHeightNoDrag(l.row,i.pre.height-i.next.height)}e.fresh(),o.stepNum-=1}}},{key:"registrySettingDom",value:function(){var e=this,t=this.core.h,o=t("input",{attr:{className:"cell-label-input",onblur:function(t){e.changeFirstSelectedCell(e.labelInputDom.value)},onkeydown:function(t){"Enter"===t.key&&e.changeFirstSelectedCell(e.labelInputDom.value)}}});this.labelInputDom=o;var i="A1",l=t("input",{attr:{className:"fx-input",oninput:function(t){e.core.plugins.InputPlugin.inputDom.value=t.target.value},onfocus:function(t){e.contentComponent.clickCell&&(i=e.contentComponent.clickCell.label,e.core.plugins.InputPlugin.showInput(e.contentComponent.clickCell))},onblur:function(t){e.core.plugins.InputPlugin.inputDom.value?(e.changeStepArr({type:1,label:i,pre:e.contentComponent.clickCell.text,next:e.core.plugins.InputPlugin.inputDom.value}),e.contentComponent.searchRectByLabel(i).text=e.core.plugins.InputPlugin.inputDom.value,e.core.freshContent(),e.core.plugins.InputPlugin.hideInput()):e.core.plugins.InputPlugin.hideInput()}}});this.fxInputDom=l;var n=t("div",{attr:{className:"e-sheet-setting-input-bar-layout"}},[t("div",{attr:{className:"left-input-layout"}},[o]),t("div",{attr:{className:"right-input-layout"}},[t("span",{attr:{innerText:"fx",className:"prefix-label"}}),l])]);this.selectorDom.insertBefore(n,this.canvasWrapperDom);var r=t("e-sheet-radio-group",{},[t("e-sheet-radio-button",{attribute:{label:"左对齐",value:"left"}},[t("e-sheet-icon-svg",{attribute:{category:"hor",position:"left"}})]),t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"居中对齐",value:"center"}},[t("e-sheet-icon-svg",{attribute:{category:"hor",position:"center"}})]),t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"右对齐",value:"right"}},[t("e-sheet-icon-svg",{attribute:{category:"hor",position:"right"}})])]);this.fontHorAddrGroup=r,r.addEventListener("e-sheet-radio-group-onchange",(function(t){e.convenientChangeStepArr(4,"textAlign",t.detail),e.cellFontTextAlignChange(t.detail)}));var s=t("e-sheet-radio-group",{},[t("e-sheet-radio-button",{attribute:{label:"顶部对齐",value:"top"}},[t("e-sheet-icon-svg",{attribute:{category:"ver",position:"top"}})]),t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"垂直居中",value:"middle"}},[t("e-sheet-icon-svg",{attribute:{category:"ver",position:"middle"}})]),t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"底部对齐",value:"bottom"}},[t("e-sheet-icon-svg",{attribute:{category:"ver",position:"bottom"}})])]);this.fontVerAddrGroup=s,s.addEventListener("e-sheet-radio-group-onchange",(function(t){e.convenientChangeStepArr(3,"textBaseLine",t.detail),e.cellFontTextBaseLineChange(t.detail)}));var a=t("div",{attr:{className:"e-sheet-setting-layout"}}),c=t("div",{attr:{className:"font-position-layout"}});c.appendChild(s),c.appendChild(r);var h=t("e-sheet-select",{});h.addEventListener("e-sheet-select-onchange",(function(t){e.convenientChangeStepArr(2,"fontSize",parseInt(t.detail)),e.cellFontSizeChange(t.detail)})),h.setAttribute("label","字号");var d=t("div",{attr:{className:"font-position-layout"}}),u=t("div",{attr:{className:"font-position-layout"}});this.fontSizeSelectDom=h,d.appendChild(h);var g=t("e-sheet-radio-button",{attribute:{label:"粗体",value:"bold"}},[t("e-sheet-icon-svg",{attribute:{category:"font",position:"weight"}})]);this.fontWeightBtnDom=g,g.addEventListener("e-sheet-radio-group-change",(function(t){""===g.getAttribute("current")?(g.setAttribute("current",t.detail),e.convenientChangeStepArr(5,"fontWeight",t.detail),e.cellFontWeightChange(t.detail)):(g.setAttribute("current",""),e.convenientChangeStepArr(5,"fontWeight",""),e.cellFontWeightChange(""))}));var m=t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"斜体",value:"italic"}},[t("e-sheet-icon-svg",{attribute:{category:"font",position:"italic"}})]);this.fontItalicBtnDom=m,m.addEventListener("e-sheet-radio-group-change",(function(t){""===m.getAttribute("current")?(m.setAttribute("current",t.detail),e.convenientChangeStepArr(6,"fontItalic",t.detail),e.cellFontItalicChange(t.detail)):(m.setAttribute("current",""),e.convenientChangeStepArr(6,"fontItalic",""),e.cellFontItalicChange(""))}));var f=t("div",{attr:{className:"e-sheet-font-style-layout"}},[g,m]);d.appendChild(f);var v=t("e-sheet-icon-color-svg",{attribute:{category:"font-color"}});v.addEventListener("e-sheet-icon-color-svg-onchange",(function(t){e.convenientChangeStepArr(7,"fontColor",t.detail),e.cellFontColorChange(t.detail)}));var C=t("e-sheet-tip",{attribute:{"tip-label":"字体颜色",left:-10,top:22}});C.appendChild(v),this.fontColorSelectDom=v,u.appendChild(C);var y=t("e-sheet-tip",{attribute:{"tip-label":"背景颜色",left:-10,top:22}}),b=t("e-sheet-icon-color-svg",{attribute:{category:"bg-color"}});this.bgColorSelectDom=b,y.appendChild(b),b.addEventListener("e-sheet-icon-color-svg-onchange",(function(t){e.convenientChangeStepArr(8,"bgColor",t.detail),e.cellBgColorChange(t.detail)})),u.appendChild(y);var w=t("div",{attr:{className:"e-sheet-divide-line"}}),x=t("e-sheet-tip",{attribute:{"tip-label":"合并单元格",left:4,top:24}},[t("div",{attr:{className:"e-sheet-font-style-layout e-sheet-cell-hover"},style:{padding:"2px",userSelect:"none"}},[t("e-sheet-icon-svg",{attribute:{category:"cell",position:"merge"}}),t("div",{attr:{innerText:"合并单元格",className:"e-sheet-cell-font"}})])]),k=t("e-sheet-tip",{style:{display:"none"}},[t("div",{attr:{className:"e-sheet-font-style-layout e-sheet-cell-hover"},style:{cursor:"pointer",padding:"2px"}},[t("e-sheet-icon-svg",{attribute:{category:"cell",position:"split"}}),t("div",{attr:{innerText:"拆分单元格",className:"e-sheet-cell-font"}})])]),S=t("div",{attr:{className:"font-position-layout"}});x.onclick=function(t){var o=e.contentComponent,i=o.clickCell,l=o.mergeSelectedCell,n={type:9,label:i.label},r=[i].concat(p(l)).sort((function(e,t){return e.row-t.row+(e.col-t.col)}));e.core.plugins.ContextmenuPlugin.mergeCell(r[0],r.slice(0)),n.pre=r[0].label,n.next=r.map((function(e){return e.label})),e.changeStepArr(n),x.style.display="none",k.style.display="flex"},k.onclick=function(t){var o=e.contentComponent.clickCell;e.changeStepArr({type:10,label:o.label,pre:{row:o.row,col:o.col,mergeRow:o.mergeRow,mergeCol:o.mergeCol,mergeStartLabel:o.mergeStartLabel,mergeEndLabel:o.mergeEndLabel,isMerge:!0},next:{row:o.row,col:o.col,mergeRow:o.mergeRow,mergeCol:o.mergeCol,mergeStartLabel:o.mergeStartLabel,mergeEndLabel:o.mergeEndLabel,isMerge:!1}}),e.core.plugins.ContextmenuPlugin.splitCell(o),x.style.display="flex",k.style.display="none"},this.cellMergerBtnDom=x,this.cellSplitBtnDom=k,S.appendChild(x),S.appendChild(k),S.appendChild(t("div",{attr:{innerText:"单元格",className:"e-sheet-font-style-layout e-sheet-cell-font"},style:{justifyContent:"center"}}));var D=t("e-sheet-radio-button",{attribute:{label:"撤销(Ctrl+Z)",value:"fallback",top:24,left:-24},attr:{onclick:function(t){e.fallbackSetSheet()}}},[t("e-sheet-icon-svg",{attribute:{category:"step",position:"fallback"}})]),M=t("e-sheet-radio-button",{attribute:{label:"重做(Ctrl+Y)",value:"forward",top:24,left:-24},attr:{onclick:function(t){e.forwardSetSheet()}}},[t("e-sheet-icon-svg",{attribute:{category:"step",position:"forward"}})]);document.addEventListener("keydown",(function(t){t.ctrlKey&&"z"===t.key&&e.fallbackSetSheet(),t.ctrlKey&&"y"===t.key&&e.forwardSetSheet()}));var I=t("div",{attr:{className:"font-position-layout"}});I.appendChild(D),I.appendChild(M),a.appendChild(I),a.appendChild(w.cloneNode()),a.appendChild(c),a.appendChild(w.cloneNode()),a.appendChild(d),a.appendChild(w.cloneNode()),a.appendChild(u),a.appendChild(w.cloneNode()),a.appendChild(S),this.selectorDom.insertBefore(a,n)}}]),e}(),Z=function(){function e(t,i){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0;o(this,e),n(this,"sheetArrLayoutDom",null),this.contentComponent=r.ContentComponent,this.headerComponent=r.HeaderComponent,this.sideComponent=r.SideComponent,this.selectorDom=t,this.canvasDom=s.canvasDom,this.canvasWrapperDom=s.canvasWrapperDom,this.options=l,this.layer=i,this.core=s,this.registryDom()}return l(e,[{key:"createNewSheet",value:function(){this.core.createNewSheet(),this.core.currentSheetIndex=this.core.eSheetWorkBook.length-1;var e=this.core.eSheetWorkBook[this.core.currentSheetIndex];this.core.switchSheet(this.core.currentSheetIndex),this.sheetArrLayoutDom.childNodes.forEach((function(e){e.className="item-span"})),this.sheetArrLayoutDom.appendChild(this.core.h("span",{attr:{innerText:e.label,className:"item-span active-item-span"},attribute:{index:this.core.currentSheetIndex}}))}},{key:"switchSheet",value:function(e){this.core.switchSheet(e);var t=this.core.currentSheetIndex;this.sheetArrLayoutDom.childNodes.forEach((function(e,o){e.className=t===o?"item-span active-item-span":"item-span"}))}},{key:"setSheetName",value:function(e,t){this.core.eSheetWorkBook[e].label=t}},{key:"setCanvasScale",value:function(e){var t=this,o=this.options,i=o.width,l=o.height,n=o.cellHeight;this.contentComponent.contentGroup.forEach((function(o){o.width/=t.core.scale,o.height/=t.core.scale,o.x/=t.core.scale,o.y/=t.core.scale,o.ltX=n+o.x,o.ltY=n+o.y,o.mergeWidth/=t.core.scale,o.mergeHeight/=t.core.scale,o.width*=e,o.height*=e,o.x*=e,o.y*=e,o.ltX=e*n+o.x,o.ltY=e*n+o.y,o.mergeWidth*=e,o.mergeHeight*=e})),this.core.scale=e;var r=this.contentComponent.contentGroup[this.contentComponent.contentGroup.length-1];this.core.sheetWidth=r.ltX+r.width,this.core.sheetHeight=r.ltY+r.height,this.layer.clearRect(0,0,i,l),this.core.fresh(),this.core.freshScrollBar()}},{key:"registryDom",value:function(){var e=this,t=this.core,o=t.h,i=t.eSheetWorkBook,l=t.currentSheetIndex,n=o("div",{attr:{className:"sheet-arr-layout",onclick:function(t){var o=t.target.getAttribute("index");o&&e.switchSheet(parseInt(o))},ondblclick:function(t){var i=t.target,l=parseInt(t.target.getAttribute("index")),n=o("input",{attr:{className:"item-input",onblur:function(t){i.innerText=n.value,n.remove(),e.setSheetName(l,i.innerText)},onkeydown:function(t){"Enter"===t.key&&(i.innerText=n.value,n.remove(),e.setSheetName(l,i.innerText))}}});n.value=i.innerText,n.style.width=i.getBoundingClientRect().width-24+"px",i.innerText="",i.appendChild(n),n.focus()}}},i.map((function(e,t){return o("div",{attr:{innerText:e.label,className:l===t?"item-span active-item-span":"item-span"},attribute:{index:t}})})));this.sheetArrLayoutDom=n;var r=o("div",{attr:{className:"e-sheet-book-layout"}},[o("div",{attr:{className:"e-sheet-book-con"}},[o("div",{attr:{className:"menu-layout"}},[o("div",{attr:{className:"e-sheet-cell-hover"}},[o("e-sheet-tip",{attribute:{"tip-label":"全部",left:-6,top:-36}},[o("e-sheet-icon-svg",{attribute:{category:"book",position:"menu"}})])]),o("div",{attr:{className:"e-sheet-cell-hover"}},[o("e-sheet-tip",{attribute:{"tip-label":"新增",left:-6,top:-36},attr:{onclick:function(t){e.createNewSheet()}}},[o("e-sheet-icon-svg",{attribute:{category:"book",position:"plus"}})])])]),n,o("div",{attr:{className:"scroll-handle-layout"}},[o("e-sheet-tip",{attribute:{"tip-label":"向左滚动",left:-20,top:-36},style:{height:"100%"},attr:{onclick:function(e){n.scrollLeft-=300}}},[o("div",{attr:{className:"arrow"}},[o("e-sheet-icon-svg",{attribute:{category:"book",position:"arrow-left"}})])]),o("e-sheet-tip",{attribute:{"tip-label":"向右滚动",left:-20,top:-36},style:{height:"100%"},attr:{onclick:function(e){n.scrollLeft+=300}}},[o("div",{attr:{className:"arrow"}},[o("e-sheet-icon-svg",{attribute:{category:"book",position:"arrow-right"}})])])])])]);this.selectorDom.appendChild(r)}}]),e}(),R=function(e){r(i,e);var t=g(i);function i(){return o(this,i),t.apply(this,arguments)}return l(i,[{key:"connectedCallback",value:function(){var e=this;this.tipLabel=this.getAttribute("tip-label"),this.left=parseInt(this.getAttribute("left")),this.top=parseInt(this.getAttribute("top"));var t=document.createElement("div");t.className="e-sheet-radio-button-tip",t.innerText=this.tipLabel,this.className="e-sheet-tip",this.addEventListener("mouseover",(function(o){if(!document.body.contains(t)){var i=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,l=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,n=e.getBoundingClientRect(),r=n.x,s=n.y;t.style.left=r+e.left+l+"px",t.style.top=s+e.top+i+"px",document.body.appendChild(t)}})),this.addEventListener("mouseleave",(function(e){t.remove()}))}}]),i}(d(HTMLElement));customElements.define("e-sheet-tip",R);var N=function(e){r(i,e);var t=g(i);function i(){var e;return o(this,i),n(u(e=t.call(this)),"optionLayoutDom",null),n(u(e),"isOpen",!1),n(u(e),"showTextDom",null),n(u(e),"arrowDom",null),e}return l(i,[{key:"close",value:function(){this.optionLayoutDom&&this.optionLayoutDom.remove(),this.optionLayoutDom=null,this.isOpen=!1,this.arrowDom.style.transform="rotate(0deg)"}},{key:"connectedCallback",value:function(){var e,t=this;this.value=null!==(e=this.getAttribute("value"))&&void 0!==e?e:12,this.label=this.getAttribute("label"),this.className="e-sheet-select";var o=document.createElement("div");o.className="e-sheet-radio-button-tip",o.innerText=this.label,this.addEventListener("mouseover",(function(e){o||((o=document.createElement("div")).className="e-sheet-radio-button-tip",o.innerText=t.label);var i=t.getBoundingClientRect(),l=i.x,n=i.y;o.style.left=l+12+"px",o.style.top=n+24+"px",document.body.appendChild(o)})),this.addEventListener("mouseleave",(function(e){o.remove()}));var i=document.createElement("div");i.innerText=this.value,i.className="select-text",this.showTextDom=i;var l=document.createElement("e-sheet-icon-svg");l.setAttribute("category","select"),l.setAttribute("position","down"),this.arrowDom=l,l.style.transition="transform .5s",this.appendChild(i),this.appendChild(l),document.addEventListener("click",(function(e){t.contains(e.target)||t.close()})),this.addEventListener("e-sheet-option-onchange",(function(e){i.innerText=t.value=e.detail,t.dispatchEvent(new CustomEvent("e-sheet-select-onchange",{bubbles:!1,composed:!0,detail:t.value})),o.remove(),t.close()})),this.addEventListener("click",(function(e){if(e.stopImmediatePropagation(),t.isOpen)t.close();else if(!t.optionLayoutDom||t.optionLayoutDom.contains(e.target)){t.isOpen=!0,l.style.transform="rotate(180deg)",t.optionLayoutDom=document.createElement("div"),t.optionLayoutDom.className="e-sheet-option-layout",new Array(10).fill(0).forEach((function(e,o){var i=document.createElement("e-sheet-option");i.setAttribute("label",(12+o).toString()),i.setAttribute("value",12+o),i.setAttribute("current",t.value),t.optionLayoutDom.appendChild(i)}));var o=t.getBoundingClientRect().height;t.optionLayoutDom.style.left="-1px",t.optionLayoutDom.style.top=o+"px",t.appendChild(t.optionLayoutDom)}}))}},{key:"attributeChangedCallback",value:function(e,t,o){this.value=o,this.showTextDom.innerText=this.value}}],[{key:"observedAttributes",get:function(){return["value"]}}]),i}(d(HTMLElement));customElements.define("e-sheet-select",N);var P=function(e){r(i,e);var t=g(i);function i(){return o(this,i),t.call(this)}return l(i,[{key:"connectedCallback",value:function(){var e=this;this.label=this.getAttribute("label"),this.value=this.getAttribute("value"),this.current=this.getAttribute("current"),this.className="e-sheet-option";var t=document.createElement("div");t.className="option-font",t.innerText=this.label;var o=document.createElement("e-sheet-icon-svg");this.value!==this.current&&(o.style.display="none"),o.setAttribute("category","bool"),o.setAttribute("position","true"),this.appendChild(t),this.appendChild(o),this.addEventListener("click",(function(t){t.stopImmediatePropagation(),e.dispatchEvent(new CustomEvent("e-sheet-option-onchange",{bubbles:!0,composed:!0,detail:e.value}))}))}}]),i}(d(HTMLElement));customElements.define("e-sheet-option",P);var T=function(e){r(i,e);var t=g(i);function i(){return o(this,i),t.call(this)}return l(i,[{key:"connectedCallback",value:function(){var e=this;this.value=this.getAttribute("value");var t=this.attachShadow({mode:"open"}),o=document.createElement("slot");this.className="e-sheet-radio-group",t.appendChild(o),t.addEventListener("e-sheet-radio-group-change",(function(o){e.value=o.detail,new Array(e.childElementCount).fill(void 0).forEach((function(t,o){e.children.item(o).setAttribute("current",e.value)})),t.dispatchEvent(new CustomEvent("e-sheet-radio-group-onchange",{bubbles:!1,composed:!0,detail:e.value}))}))}},{key:"attributeChangedCallback",value:function(e,t,o){var i=this;this.value=o,new Array(this.childElementCount).fill(void 0).forEach((function(e,t){i.children.item(t).setAttribute("current",i.value)}))}}],[{key:"observedAttributes",get:function(){return["value"]}}]),i}(d(HTMLElement));customElements.define("e-sheet-radio-group",T);var W=function(e){r(i,e);var t=g(i);function i(){return o(this,i),t.call(this)}return l(i,[{key:"connectedCallback",value:function(){var e=this;this.label=this.getAttribute("label"),this.value=this.getAttribute("value"),this.left=this.getAttribute("left"),this.top=this.getAttribute("top"),this.className="e-sheet-radio-button";var t=this.attachShadow({mode:"open"}),o=document.createElement("div");o.className="e-sheet-radio-button-tip",o.innerText=this.label;var i=document.createElement("slot");t.addEventListener("click",(function(o){t.dispatchEvent(new CustomEvent("e-sheet-radio-group-change",{bubbles:!0,composed:!0,detail:e.value}))})),this.addEventListener("mouseover",(function(t){if(!document.body.contains(o)){var i=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,l=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,n=e.getBoundingClientRect(),r=n.x,s=n.y,a=e.left?parseInt(e.left):12*-e.label.length/2+4,c=e.top?parseInt(e.top):24;o.style.left=r+a+l+"px",o.style.top=s+i+c+"px",document.body.appendChild(o)}})),this.addEventListener("mouseleave",(function(e){o.remove()})),t.appendChild(i)}},{key:"attributeChangedCallback",value:function(e,t,o){this.value===o?this.className="e-sheet-radio-button e-sheet-radio-button-selected":this.className="e-sheet-radio-button"}}],[{key:"observedAttributes",get:function(){return["current"]}}]),i}(d(HTMLElement));customElements.define("e-sheet-radio-button",W);var H=function(e){r(i,e);var t=g(i);function i(){return o(this,i),t.call(this)}return l(i,[{key:"connectedCallback",value:function(){if(this.category=this.getAttribute("category"),this.position=this.getAttribute("position"),"hor"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"left":case"start":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_6926_00059"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_6926_00059)"><path fill="currentColor" fill-opacity="0.94" d="M17 5H3V4h14v1Zm-7 4H3V8h7v1Zm0 8H3v-1h7v1Zm7-4v-1H3v1h14Z"></path></g></svg>');case"center":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_6926_00035"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_6926_00035)"><path fill="currentColor" fill-opacity="0.94" d="M17 5H3V4h14v1ZM7 9h6V8H7v1Zm10 4H3v-1h14v1Zm-4 4H7v-1h6v1Z"></path></g></svg>');case"right":case"end":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_6926_00066"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_6926_00066)"><path fill="currentColor" fill-opacity="0.94" d="M17 5H3V4h14v1Zm-7 4h7V8h-7v1Zm7 3v1H3v-1h14Zm0 5h-7v-1h7v1Z"></path></g></svg>')}if("ver"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"top":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_7600_00213"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_7600_00213)"><path fill="currentColor" d="M17 4H3V3h14v1Z"></path><path fill="#0089FF" d="m10.013 6 3.487 4h-7l3.513-4Z"></path><path fill="#0089FF" fill-rule="evenodd" d="M10.5 9v8h-1V9h1Z"></path></g></svg>');case"middle":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_7600_00207"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_7600_00207)"><path fill="currentColor" d="M17 10H3V9h14v1Z"></path><path fill="#0089FF" fill-rule="evenodd" d="M10.5 1v5h-1V1h1Z"></path><path fill="#0089FF" d="m10.01 8 2.49-3h-5l2.51 3ZM10.01 11l2.49 3h-5l2.51-3Z"></path><path fill="#0089FF" fill-rule="evenodd" d="M10.5 14v4h-1v-4h1Z"></path></g></svg>');case"bottom":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_7600_00217"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_7600_00217)"><path fill="currentColor" d="M17 17H3v-1h14v1Z"></path><path fill="#0089FF" fill-rule="evenodd" d="M10.5 3v8h-1V3h1Z"></path><path fill="#0089FF" d="m10.013 14 3.487-4h-7l3.513 4Z"></path></g></svg>')}if("bool"!==this.category||(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20","true"!==this.position))if("select"!==this.category||(this.className="e-sheet-cell-svg-layout e-sheet-svg-12-12","down"!==this.position)){if("font"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"weight":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_6926_00081"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_6926_00081)"><path fill="currentColor" d="M5.8 3.05a.75.75 0 0 0-.75.75v12.5c0 .414.336.75.75.75h5.5c2.297 0 3.75-1.862 3.75-4 0-1.415-.637-2.71-1.734-3.423.734-.635 1.234-1.588 1.234-2.827 0-2.424-1.91-3.75-3.75-3.75h-5Zm5 6H6.55v-4.5h4.25c1.16 0 2.25.796 2.25 2.25s-1.09 2.25-2.25 2.25Zm-4.25 1.5h4.75c1.314 0 2.25 1.027 2.25 2.5s-.936 2.5-2.25 2.5H6.55v-5Z" data-spm-anchor-id=""></path></g></svg>');case"italic":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20" data-spm-anchor-id=""><defs><clipPath id="master_svg0_7600_9375"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_7600_9375)"><path fill="currentColor" d="M12 4h3V3H8v1h2.769l-2.77 12H5v1h7v-1H9.231l2.77-12Z"></path></g></svg>')}if("cell"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"merge":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20"><defs><clipPath id="master_svg0_31608_94416"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_31608_94416)"><path fill="#0089FF" d="M15 10.5H5v-1h10v1Z"></path><path fill="currentColor" d="M6.5 3A1.5 1.5 0 0 1 8 4.5V6H7V4.5a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 0-.5.5v11a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5V14h1v1.5A1.5 1.5 0 0 1 6.5 17h-2A1.5 1.5 0 0 1 3 15.5v-11A1.5 1.5 0 0 1 4.5 3h2Zm7 0A1.5 1.5 0 0 0 12 4.5V6h1V4.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5V14h-1v1.5a1.5 1.5 0 0 0 1.5 1.5h2a1.5 1.5 0 0 0 1.5-1.5v-11A1.5 1.5 0 0 0 15.5 3h-2Z"></path></g></svg>');case"split":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20"><defs><clipPath id="master_svg0_31608_94446"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_31608_94446)"><path fill="currentColor" fill-rule="evenodd" d="M4 4.5A1.5 1.5 0 0 1 5.5 3h2A1.5 1.5 0 0 1 9 4.5v11A1.5 1.5 0 0 1 7.5 17h-2A1.5 1.5 0 0 1 4 15.5V14h1v1.5a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5v-11a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 0-.5.5V6H4V4.5ZM16 4.5A1.5 1.5 0 0 0 14.5 3h-2A1.5 1.5 0 0 0 11 4.5v11a1.5 1.5 0 0 0 1.5 1.5h2a1.5 1.5 0 0 0 1.5-1.5V14h-1v1.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5V6h1V4.5Z"></path><path fill="#0089FF" fill-rule="evenodd" d="M7 10.5H4v-1h3v1ZM16 10.5h-3v-1h3v1Z"></path><path fill="#0089FF" d="m18 10-3-2.5v5l3-2.5ZM2 10l3-2.5v5L2 10Z"></path></g></svg>')}if("book"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"menu":return void(this.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" data-spm-anchor-id=""><path d="M6 5H18V4H6V5ZM18 10H6V9H18V10ZM18 15H6V14H18V15ZM2 5H4V4H2V5ZM4 10H2V9H4V10ZM4 15H2V14H4V15Z" fill="rgba(40,50,72,1)"></path></svg>');case"plus":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20"><defs><clipPath id="master_svg0_30306_58308"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_30306_58308)"><path fill="currentColor" fill-opacity="0.94" d="M9.5 4.5v5h-5a.5.5 0 0 0 0 1h5v5a.5.5 0 0 0 1 0v-5h5a.5.5 0 0 0 0-1h-5v-5a.5.5 0 0 0-1 0Z"></path></g></svg>');case"arrow-left":return void(this.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="wdn-icon" data-spm-anchor-id=""><path d="m12.646 3.646.708.708L7.707 10l5.647 5.646-.707.708L6.292 10l6.353-6.354Z" fill="currentColor"></path></svg>');case"arrow-right":return void(this.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="wdn-icon"><path d="m7.353 3.646-.707.708L12.293 10l-5.647 5.646.707.708L13.707 10 7.353 3.646Z" fill="currentColor"></path></svg>')}if("step"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"forward":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20" data-spm-anchor-id=""><defs><clipPath id="___SVG_ID__50__0___"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#___SVG_ID__50__0___)"><path fill="currentColor" fill-opacity="0.94" d="M16.3 6H7.988C4.975 6 3 8.22 3 11s1.975 5 4.988 5h4.168v1H7.988C4.388 17 2 14.296 2 11s2.387-6 5.988-6h8.298l-2.14-2.147.708-.706 3.353 3.364-3.354 3.343-.706-.708L16.3 6Z"></path></g></svg>');case"fallback":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="___SVG_ID__49__0___"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#___SVG_ID__49__0___)"><path fill="currentColor" fill-opacity="0.94" d="M6.354 2.353 3.714 5h8.298C15.612 5 18 7.704 18 11s-2.387 6-5.988 6H8v-1h4.012C15.025 16 17 13.78 17 11s-1.975-5-4.988-5H3.7l2.653 2.646-.706.708-3.854-3.843 3.853-3.864.708.706Z"></path></g></svg>')}}else this.innerHTML='<svg width="12" height="12" viewBox="0 0 12 12" stroke="none" data-spm-anchor-id="" style=""><path d="M6.00004 7.79293L1.85359 3.64648L1.14648 4.35359L6.00004 9.20714L10.8536 4.35359L10.1465 3.64648L6.00004 7.79293Z" fill="currentColor" data-spm-anchor-id=""></path></svg>';else this.innerHTML='<svg fill="none" width="20" height="20" viewBox="0 0 20 20" class="wdn-icon"><path d="M16.354 6.854a.5.5 0 0 0-.708-.708L8.5 13.293 4.854 9.647a.5.5 0 1 0-.708.707l4 4a.5.5 0 0 0 .708 0l7.5-7.5Z" fill="currentColor"></path></svg>'}}]),i}(d(HTMLElement));customElements.define("e-sheet-icon-svg",H);var j=function(e){r(i,e);var t=g(i);function i(){return o(this,i),t.call(this)}return l(i,[{key:"connectedCallback",value:function(){var e=this;this.category=this.getAttribute("category"),this.color=this.getAttribute("color"),this.className="e-sheet-icon-color-svg";var t=document.createElement("div");t.onclick=function(t){e.querySelector("svg").querySelectorAll("path").forEach((function(t){"currentColor"!==t.getAttribute("fill")&&e.dispatchEvent(new CustomEvent("e-sheet-icon-color-svg-onchange",{bubbles:!1,composed:!0,detail:t.getAttribute("fill")}))}))};var o=document.createElement("div"),i=document.createElement("e-sheet-icon-svg");i.setAttribute("category","select"),i.setAttribute("position","down"),i.style.transition="transform .5s",o.appendChild(i);var l=document.createElement("input");l.className="no-draw-input",l.type="color",l.oninput=function(t){e.setAttribute("color",t.target.value),e.dispatchEvent(new CustomEvent("e-sheet-icon-color-svg-onchange",{bubbles:!1,composed:!0,detail:t.target.value}))},o.appendChild(l),o.className="arrow-layout",o.onclick=function(e){i.style.transform="rotate(180deg)",l.click()},document.addEventListener("click",(function(t){e.contains(t.target)||(i.style.transform="rotate(0deg)")})),t.className="e-sheet-cell-svg-layout e-sheet-svg-20-20","font-color"===this.category?t.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" data-spm-anchor-id=""><defs><clipPath id="master_svg0_23880_31533"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_23880_31533)"><path fill="#000000" d="M17 19H3a1 1 0 0 1 0-2h14a1 1 0 1 1 0 2Z"></path><path fill="currentColor" fill-opacity="0.14" d="M17 19.5q.621 0 1.06-.44.44-.439.44-1.06t-.44-1.06q-.439-.44-1.06-.44H3q-.621 0-1.06.44-.44.439-.44 1.06t.44 1.06q.439.44 1.06.44h14Zm0-.5H3a1 1 0 0 1 0-2h14a1 1 0 1 1 0 2Z"></path><path fill="currentColor" fill-opacity="0.94" d="m12.456 11 1.584 3.697a.5.5 0 0 0 .92-.394l-1.715-4-2.785-6.5a.5.5 0 0 0-.92 0l-2.785 6.5-1.714 4a.5.5 0 0 0 .919.394L7.544 11h4.912Zm-.429-1H7.973L10 5.27 12.027 10Z"></path></g></svg>':"bg-color"===this.category&&(t.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20"><defs><clipPath id="master_svg0_31391_75878"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_31391_75878)"><path fill="currentColor" fill-opacity="0.94" fill-rule="evenodd" d="M9.718 1.843 5.857 5.704h-3.87v1h2.87L3.354 8.207q-.44.44-.44 1.061t.44 1.06l4.95 4.95q.439.44 1.06.44t1.06-.44l6.365-6.364q.44-.439.44-1.06 0-.622-.44-1.061l-4.95-4.95q-.44-.44-1.06-.44-.622 0-1.061.44ZM11.5 6.704H6.271l-2.21 2.21q-.147.147-.147.354t.147.354l.531.531 10.315-.771 1.175-1.175q.146-.146.146-.353t-.146-.354l-4.95-4.95q-.147-.146-.354-.146t-.353.146L7.27 5.704H11.5v1Zm5.088 8.442c.78 0 1.412-.632 1.412-1.411q0-.78-1.412-2.353-1.412 1.573-1.412 2.353c0 .78.633 1.411 1.412 1.411Z"></path><path fill="#F2C150" d="M17 19H3a1 1 0 0 1 0-2h14a1 1 0 1 1 0 2Z"></path><path fill="currentColor" fill-opacity="0.14" d="M17 19.5q.621 0 1.06-.44.44-.439.44-1.06t-.44-1.06q-.439-.44-1.06-.44H3q-.621 0-1.06.44-.44.439-.44 1.06t.44 1.06q.439.44 1.06.44h14Zm0-.5H3a1 1 0 0 1 0-2h14a1 1 0 1 1 0 2Z"></path></g></svg>'),this.appendChild(t),this.appendChild(o)}},{key:"attributeChangedCallback",value:function(e,t,o){this.color=o,this.querySelector("svg").querySelectorAll("path").forEach((function(e){"currentColor"!==e.getAttribute("fill")&&e.setAttribute("fill",o)}))}}],[{key:"observedAttributes",get:function(){return["color"]}}]),i}(d(HTMLElement));customElements.define("e-sheet-icon-color-svg",j);var G=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(o(this,e),n(this,"excelDom",null),n(this,"AppExcel",null),"[object HTMLDivElement]"===Object.prototype.toString.call(t)?this.excelDom=t:this.excelDom=document.querySelector(t),!this.excelDom)throw new Error("the selector is error");return this.excelDom.style.position="relative",this.init(i,l)}return l(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.AppExcel=new b(this.excelDom,e,{ContentComponent:S,HeaderComponent:x,SideComponent:k,WholeComponent:w},t({SettingPlugin:B,ScrollPlugin:D,InputPlugin:M,DragPlugin:L,SelectPlugin:I,ContextmenuPlugin:A,BookPlugin:Z},o)),this.AppExcel}},{key:"installXlsxData",value:function(e){this.AppExcel.installXlsxData(e)}}]),e}();return G}));
