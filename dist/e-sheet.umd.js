!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).eSheet=t()}(this,(function(){"use strict";function e(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function t(t){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{};o%2?e(Object(n),!0).forEach((function(e){l(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function i(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e,t,o){return(t=f(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function h(e,t,o){return h=c()?Reflect.construct.bind():function(e,t,o){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return o&&a(i,o.prototype),i},h.apply(null,arguments)}function d(e){var t="function"==typeof Map?new Map:void 0;return d=function(e){if(null===e||(o=e,-1===Function.toString.call(o).indexOf("[native code]")))return e;var o;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return h(e,arguments,s(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,e)},d(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){var t=c();return function(){var o,n=s(e);if(t){var i=s(this).constructor;o=Reflect.construct(n,arguments,i)}else o=n.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}(this,o)}}function p(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return m(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function f(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var v={cell:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTkgMTd2LTVoLTJ2NWgtNXYyaDV2NWgydi01aDV2LTJoLTV6IiBmaWxsPSIjZmZmIiBmaWxsLW9wYWNpdHk9Ii44OCIvPjxwYXRoIGQ9Ik0xMiAxOS41aDQuNXY1aDN2LTVoNXYtM2gtNXYtNWgtM3Y1aC01djNoLjV6IiBzdHJva2U9IiMxNzFBMUQiLz48L2c+PGRlZnM+PGZpbHRlciBpZD0iZmlsdGVyMF9kIiB4PSI4IiB5PSI5IiB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPjxmZU9mZnNldCBkeT0iMSIvPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEuNSIvPjxmZUNvbG9yTWF0cml4IHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4yNSAwIi8+PGZlQmxlbmQgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93Ii8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+PC9maWx0ZXI+PC9kZWZzPjwvc3ZnPg==","col-resize":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxtYXNrIGlkPSJhIiBtYXNrVW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4PSI3IiB5PSI5IiB3aWR0aD0iMjIiIGhlaWdodD0iMTgiIGZpbGw9IiMwMDAiPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik03IDloMjJ2MThIN3oiLz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE5IDEwaC0ydjdoLTR2Mmg0djdoMnYtN2g0di0yaC00di03ek05IDE4bDQtM3Y2bC00LTN6bTE4IDBsLTQgM3YtNmw0IDN6Ii8+PC9tYXNrPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTkgMTBoLTJ2N2gtNHYyaDR2N2gydi03aDR2LTJoLTR2LTd6TTkgMThsNC0zdjZsLTQtM3ptMTggMGwtNCAzdi02bDQgM3oiIGZpbGw9IiMxNzFBMUQiLz48cGF0aCBkPSJNMTkgMTBoMVY5aC0xdjF6bS0yIDBWOWgtMXYxaDF6bTAgN3YxaDF2LTFoLTF6bS00IDB2LTFoLTF2MWgxem0wIDJoLTF2MWgxdi0xem00IDBoMXYtMWgtMXYxem0wIDdoLTF2MWgxdi0xem0yIDB2MWgxdi0xaC0xem0wLTd2LTFoLTF2MWgxem00IDB2MWgxdi0xaC0xem0wLTJoMXYtMWgtMXYxem0tNCAwaC0xdjFoMXYtMXpNOSAxOGwtLjYtLjgtMS4wNjcuOCAxLjA2Ny44LjYtLjh6bTQtM2gxdi0ybC0xLjYgMS4yLjYuOHptMCA2bC0uNi44TDE0IDIzdi0yaC0xem0xNC0zbC42LjggMS4wNjctLjgtMS4wNjctLjgtLjYuOHptLTQgM2gtMXYybDEuNi0xLjItLjYtLjh6bTAtNmwuNi0uOEwyMiAxM3YyaDF6bS00LTZoLTJ2MmgyVjl6bS0zIDF2N2gydi03aC0yem0xIDZoLTR2Mmg0di0yem0tNSAxdjJoMnYtMmgtMnptMSAzaDR2LTJoLTR2MnptMy0xdjdoMnYtN2gtMnptMSA4aDJ2LTJoLTJ2MnptMy0xdi03aC0ydjdoMnptLTEtNmg0di0yaC00djJ6bTUtMXYtMmgtMnYyaDJ6bS0xLTNoLTR2Mmg0di0yem0tMyAxdi03aC0ydjdoMnpNOS42IDE4LjhsNC0zLTEuMi0xLjYtNCAzIDEuMiAxLjZ6TTEyIDE1djZoMnYtNmgtMnptMS42IDUuMmwtNC0zLTEuMiAxLjYgNCAzIDEuMi0xLjZ6bTEyLjgtM2wtNCAzIDEuMiAxLjYgNC0zLTEuMi0xLjZ6TTI0IDIxdi02aC0ydjZoMnptLTEuNi01LjJsNCAzIDEuMi0xLjYtNC0zLTEuMiAxLjZ6IiBmaWxsPSIjZmZmIiBtYXNrPSJ1cmwoI2EpIi8+PC9nPjxkZWZzPjxmaWx0ZXIgaWQ9ImZpbHRlcjBfZCIgeD0iNC4zMzMiIHk9IjciIHdpZHRoPSIyNy4zMzMiIGhlaWdodD0iMjQiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPjxmZU9mZnNldCBkeT0iMSIvPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEuNSIvPjxmZUNvbG9yTWF0cml4IHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4yNSAwIi8+PGZlQmxlbmQgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93Ii8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+PC9maWx0ZXI+PC9kZWZzPjwvc3ZnPg==","row-resize":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxtYXNrIGlkPSJhIiBtYXNrVW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4PSI5IiB5PSI3IiB3aWR0aD0iMTgiIGhlaWdodD0iMjIiIGZpbGw9IiMwMDAiPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik05IDdoMTh2MjJIOXoiLz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTI2IDE5di0yaC03di00aC0ydjRoLTd2Mmg3djRoMnYtNGg3ek0xOCA5bDMgNGgtNmwzLTR6bTAgMThsLTMtNGg2bC0zIDR6Ii8+PC9tYXNrPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjYgMTl2LTJoLTd2LTRoLTJ2NGgtN3YyaDd2NGgydi00aDd6TTE4IDlsMyA0aC02bDMtNHptMCAxOGwtMy00aDZsLTMgNHoiIGZpbGw9IiMxNzFBMUQiLz48cGF0aCBkPSJNMjYgMTl2MWgxdi0xaC0xem0wLTJoMXYtMWgtMXYxem0tNyAwaC0xdjFoMXYtMXptMC00aDF2LTFoLTF2MXptLTIgMHYtMWgtMXYxaDF6bTAgNHYxaDF2LTFoLTF6bS03IDB2LTFIOXYxaDF6bTAgMkg5djFoMXYtMXptNyAwaDF2LTFoLTF2MXptMCA0aC0xdjFoMXYtMXptMiAwdjFoMXYtMWgtMXptMC00di0xaC0xdjFoMXpNMTggOWwuOC0uNi0uOC0xLjA2Ny0uOCAxLjA2Ny44LjZ6bTMgNHYxaDJsLTEuMi0xLjYtLjguNnptLTYgMGwtLjgtLjZMMTMgMTRoMnYtMXptMyAxNGwtLjguNi44IDEuMDY3LjgtMS4wNjctLjgtLjZ6bS0zLTR2LTFoLTJsMS4yIDEuNi44LS42em02IDBsLjguNkwyMyAyMmgtMnYxem02LTR2LTJoLTJ2Mmgyem0tMS0zaC03djJoN3YtMnptLTYgMXYtNGgtMnY0aDJ6bS0xLTVoLTJ2Mmgydi0yem0tMyAxdjRoMnYtNGgtMnptMSAzaC03djJoN3YtMnptLTggMXYyaDJ2LTJIOXptMSAzaDd2LTJoLTd2MnptNi0xdjRoMnYtNGgtMnptMSA1aDJ2LTJoLTJ2MnptMy0xdi00aC0ydjRoMnptLTEtM2g3di0yaC03djJ6TTE3LjIgOS42bDMgNCAxLjYtMS4yLTMtNC0xLjYgMS4yek0yMSAxMmgtNnYyaDZ2LTJ6bS01LjIgMS42bDMtNC0xLjYtMS4yLTMgNCAxLjYgMS4yem0zIDEyLjhsLTMtNC0xLjYgMS4yIDMgNCAxLjYtMS4yek0xNSAyNGg2di0yaC02djJ6bTUuMi0xLjZsLTMgNCAxLjYgMS4yIDMtNC0xLjYtMS4yeiIgZmlsbD0iI2ZmZiIgbWFzaz0idXJsKCNhKSIvPjwvZz48ZGVmcz48ZmlsdGVyIGlkPSJmaWx0ZXIwX2QiIHg9IjYiIHk9IjUuMzMzIiB3aWR0aD0iMjQiIGhlaWdodD0iMjcuMzMzIiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+PGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz48ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMTI3IDAiLz48ZmVPZmZzZXQgZHk9IjEiLz48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIxLjUiLz48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMjUgMCIvPjxmZUJsZW5kIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9ImVmZmVjdDFfZHJvcFNoYWRvdyIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImVmZmVjdDFfZHJvcFNoYWRvdyIgcmVzdWx0PSJzaGFwZSIvPjwvZmlsdGVyPjwvZGVmcz48L3N2Zz4=","s-resize":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTcgMTl2LThoM3Y4aDNsLTQuNSA1LjVMMTQgMTloM3oiIGZpbGw9IiMxNzFBMUQiLz48cGF0aCBkPSJNMjMgMTguNWgtMi41di04aC00djhoLTMuNTU1bC42NjguODE3IDQuNSA1LjUuMzg3LjQ3My4zODctLjQ3MyA0LjUtNS41LjY2OC0uODE3SDIzeiIgc3Ryb2tlPSIjZmZmIi8+PC9nPjxkZWZzPjxmaWx0ZXIgaWQ9ImZpbHRlcjBfZCIgeD0iOC44OSIgeT0iOCIgd2lkdGg9IjE5LjIyMSIgaGVpZ2h0PSIyMi4wNzkiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPjxmZU9mZnNldCBkeT0iMSIvPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEuNSIvPjxmZUNvbG9yTWF0cml4IHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4yNSAwIi8+PGZlQmxlbmQgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93Ii8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+PC9maWx0ZXI+PC9kZWZzPjwvc3ZnPg==","e-resize":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAgMTloLTh2LTNoOHYtM2w1IDQuNS01IDQuNXYtM3oiIGZpbGw9IiMxNzFBMUQiLz48cGF0aCBkPSJNMTkuNSAxM3YyLjVoLTh2NGg4djMuNjIzbC44MzQtLjc1MSA1LTQuNS40MTMtLjM3Mi0uNDEzLS4zNzItNS00LjUtLjgzNC0uNzVWMTN6IiBzdHJva2U9IiNmZmYiLz48L2c+PGRlZnM+PGZpbHRlciBpZD0iZmlsdGVyMF9kIiB4PSI4IiB5PSI4Ljc1NSIgd2lkdGg9IjIxLjQ5NSIgaGVpZ2h0PSIxOS40OTEiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPjxmZU9mZnNldCBkeT0iMSIvPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEuNSIvPjxmZUNvbG9yTWF0cml4IHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4yNSAwIi8+PGZlQmxlbmQgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93Ii8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+PC9maWx0ZXI+PC9kZWZzPjwvc3ZnPg==",crosshair:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZCkiPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTggMTh2LTZoLTF2NmgtNnYxaDZ2Nmgxdi02aDZ2LTFoLTZ6IiBmaWxsPSIjMTcxQTFEIi8+PHBhdGggZD0iTTE4LjUgMTJ2LS41aC0ydjZoLTZ2Mmg2djZoMnYtNmg2di0yaC02VjEyeiIgc3Ryb2tlPSIjZmZmIi8+PC9nPjxkZWZzPjxmaWx0ZXIgaWQ9ImZpbHRlcjBfZCIgeD0iNyIgeT0iOSIgd2lkdGg9IjIxIiBoZWlnaHQ9IjIxIiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+PGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz48ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMTI3IDAiLz48ZmVPZmZzZXQgZHk9IjEiLz48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIxLjUiLz48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMjUgMCIvPjxmZUJsZW5kIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9ImVmZmVjdDFfZHJvcFNoYWRvdyIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImVmZmVjdDFfZHJvcFNoYWRvdyIgcmVzdWx0PSJzaGFwZSIvPjwvZmlsdGVyPjwvZGVmcz48L3N2Zz4="};function C(e){return new Promise((function(t,o){var n=new FileReader;n.onload=function(n){var i=(new Date).valueOf(),l=new Blob([n.target.result],{type:e.type}),r=URL.createObjectURL(l),s=new Image;s.src=r,s.onload=function(){t({url:i,imgEl:s})},s.onerror=function(e){o(e)}},n.onerror=function(e){o(e)},n.readAsArrayBuffer(e)}))}function y(e){return new Promise((function(t,o){var n=new Image;n.src=res,n.onload=function(){t({url:e,imgEl:n})}}))}function w(e){for(var t=[],o=0;o<e.length;o++)t.push(y(e[o]));return Promise.all(t)}var b=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0;o(this,e),l(this,"uploadCellImgInputDom",null),l(this,"uploadCellImgDom",null),l(this,"textWrapGroup",null),l(this,"labelInputDom",null),l(this,"fxInputDom",null),l(this,"fontHorAddrGroup",null),l(this,"fontVerAddrGroup",null),l(this,"fontSizeSelectDom",null),l(this,"fontColorSelectDom",null),l(this,"bgColorSelectDom",null),l(this,"fontItalicBtnDom",null),l(this,"fontWeightBtnDom",null),l(this,"fontStrikethroughBtnDom",null),l(this,"fontUnderlineBtnDom",null),l(this,"cellMergerBtnDom",null),l(this,"cellSplitBtnDom",null),l(this,"warnDialogDom",null),this.contentComponent=r.ContentComponent,this.headerComponent=r.HeaderComponent,this.sideComponent=r.SideComponent,this.selectorDom=t,this.canvasDom=s.canvasDom,this.canvasWrapperDom=s.canvasWrapperDom,this.options=i,this.layer=n,this.core=s,this.registrySettingDom(),this.registryWarnDialogDom()}return i(e,[{key:"registryWarnDialogDom",value:function(){var e=this.core.h;this.warnDialogDom=e("e-sheet-warn-dialog-tip",{attribute:{show:!1}}),this.selectorDom.appendChild(this.warnDialogDom)}},{key:"showDialog",value:function(e,t){this.warnDialogDom.setAttribute("t",e),this.warnDialogDom.setAttribute("content",t),this.warnDialogDom.setAttribute("show",!0)}},{key:"setLabelCon",value:function(e){this.labelInputDom.value=e}},{key:"setCellCon",value:function(e){this.fxInputDom.value=e}},{key:"setTextWrapChange",value:function(e){this.core.getCurrentSheet().config.textWrapType=e,this.core.freshContent()}},{key:"cellImgChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.img=this.contentComponent.clickCell.img.concat(e),this.core.fresh())}},{key:"cellFontTextAlignChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.textAlign=e,this.core.freshContent())}},{key:"cellFontTextBaseLineChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.textBaseline=e,this.core.freshContent())}},{key:"cellFontSizeChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.fontSize=e,this.core.freshContent())}},{key:"cellFontColorChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.fontColor=e,this.core.freshContent())}},{key:"cellBgColorChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.bgColor=e,this.core.freshContent())}},{key:"cellFontWeightChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.fontWeight=e,this.core.freshContent())}},{key:"cellUnderlineChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.underline=e,this.core.freshContent())}},{key:"cellStrikethroughChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.strikethrough=e,this.core.freshContent())}},{key:"cellFontItalicChange",value:function(e){this.contentComponent.clickCell&&(this.contentComponent.clickCell.fontItalic=e,this.core.freshContent())}},{key:"setCellAttrInHeader",value:function(e){this.fontHorAddrGroup.setAttribute("value",e.textAlign),this.fontVerAddrGroup.setAttribute("value",e.textBaseline),this.fontSizeSelectDom.setAttribute("value",e.fontSize),this.fontWeightBtnDom.setAttribute("current",e.fontWeight),this.fontStrikethroughBtnDom.setAttribute("current",e.strikethrough),this.fontUnderlineBtnDom.setAttribute("current",e.underline),this.fontItalicBtnDom.setAttribute("current",e.fontItalic),e.isMerge?(this.cellMergerBtnDom.style.display="none",this.cellSplitBtnDom.style.display="flex"):(this.cellMergerBtnDom.style.display="flex",this.cellSplitBtnDom.style.display="none"),this.setLabelCon(e.label),this.setCellCon(e.text)}},{key:"changeFirstSelectedCell",value:function(e){var t=this.contentComponent.searchRectByLabel(e);t&&(this.contentComponent.showClickRect(t),this.setCellAttrInHeader(t),this.setCellCon(t.text),this.contentComponent.setSecondClickCell(null),this.core.fresh())}},{key:"convenientChangeStepArr",value:function(e,t,o){var n=this.contentComponent.clickCell;this.changeStepArr({type:e,label:n.label,pre:n[t],next:o})}},{key:"convenientGroupChangeStepArr",value:function(e){var t=this.contentComponent,o=t.clickCell,n=t.contentGroup;this.changeStepArr({label:null!=e?e:o.label,sheet:JSON.stringify(n)})}},{key:"changeStepArr",value:function(e){var t=this.core.getCurrentSheet();t.stepNum!==t.stepArr.length-1?-1===t.stepNum?t.stepArr.splice(t.stepNum+1,t.stepArr.length,e):t.stepArr.splice(t.stepNum+1,t.stepArr.length-1-t.stepNum,e):t.stepArr.push(e),t.stepNum+=1,this.core.afterHandle()}},{key:"forwardSetSheet",value:function(){var e=this,o=this.core,n=this.contentComponent,i=o.getCurrentSheet(),l=o.ws;if(i.stepNum!==i.stepArr.length-1){var r=i.stepArr[i.stepNum+1],s=n.searchRectByLabel(r.label);switch(r.type){case 1:s.text=r.next,n.showClickRect(s),void 0!==r.widthDis&&0!==r.widthDis&&this.core.plugins.DragPlugin.expandWidthNoDrag(s.col,r.widthDis,!1),void 0!==r.heightDis&&0!==r.heightDis&&this.core.plugins.DragPlugin.expandHeightNoDrag(s.row,r.heightDis,!1),l.wsSend(1,t(t({},s),{},{widthDis:r.widthDis,heightDis:r.heightDis}));break;case 2:s.fontSize=r.next;break;case 3:s.textAlign=r.next;break;case 4:s.textBaseline=r.next;break;case 5:s.fontWeight=r.next;break;case 6:s.fontItalic=r.next;break;case 7:s.fontColor=r.next;break;case 8:s.bgColor=r.next;break;case 9:for(var a=[],c=1;c<r.next.length;c++)a.push(n.searchRectByLabel(r.next[c]));var h=n.searchRectByLabel(r.next[0]);this.wsSendInfoByTypeAndData(9,r.next),this.core.plugins.ContextmenuPlugin.mergeCell(h,a);break;case 10:var d=n.searchRectByColAndRow(r.next.col,r.next.row);this.wsSendInfoByTypeAndData(10,t({},r.next)),this.core.plugins.ContextmenuPlugin.splitCell(d);break;case 11:this.core.plugins.DragPlugin.expandWidthNoDrag(s.col,r.next.width-r.pre.width),this.core.ws.wsSend(11,t({dis:r.next.width-r.pre.width},r));break;case 12:this.core.plugins.DragPlugin.expandHeightNoDrag(s.row,r.next.height-r.pre.height),this.core.ws.wsSend(12,t({dis:r.next.height-r.pre.height},r));break;case 13:this.core.ws.wsSend(13,t({},r.next)),this.core.plugins.ContextmenuPlugin.insertCol(r.next.col,r.next.num,r.next.isLeft);break;case 14:this.core.ws.wsSend(14,t({},r.next)),this.core.plugins.ContextmenuPlugin.insertRow(r.next.row,r.next.num,r.next.isTop);break;case 15:var u=this.contentComponent.searchRectByLabel(r.next.label);this.core.plugins.SelectPlugin.transformTableDomStrToCanvasCell(r.next.pasteStr,u);break;case 16:this.core.plugins.SelectPlugin.forcePasteCellToNewCell(JSON.parse(r.pre.lastStr));var g=this.contentComponent.searchRectByLabel(r.next.label);this.core.plugins.SelectPlugin.transformTableDomStrToCanvasCell(r.next.lastStr,g),this.contentComponent.setSecondClickCell(null),this.core.ws.wsSend(16,{pre:r.pre.lastStr,next:r.next.lastStr,label:r.next.label});break;case 17:r.next.forEach((function(t){var o=e.contentComponent.searchRectByLabel(t.label);e.core.plugins.SelectPlugin.transformTableDomStrToCanvasCell(t.tableDomStr,o)})),this.core.ws.wsSend(17,{next:r.next});break;case 18:s.strikethrough=r.next;break;case 19:s.underline=r.next;break;case 20:r.cells.forEach((function(e){n.searchRectByLabel(e.label).text=""})),this.core.ws.wsSend(20,{cells:r.cells});break;case 21:this.setTextWrapChange(r.next),this.setTextWrapInHeader(r.next),this.core.ws.wsSend(21,{textWrapType:r.next});break;case 22:s.img=JSON.parse(r.next),this.core.ws.wsSend(22,r)}[1,2,3,4,5,6,7,8,18,19].includes(r.type)&&this.wsSendCellAttrByTypeAndData(r.type),o.fresh(),i.stepNum+=1,this.core.afterHandle()}}},{key:"fallbackSetSheet",value:function(){var e=this,o=this.core,n=this.contentComponent,i=o.getCurrentSheet(),l=o.ws;if(-1!==i.stepNum){var r=i.stepArr[i.stepNum],s=n.searchRectByLabel(r.label);switch(r.type){case 1:s.text=r.pre,n.showClickRect(s),void 0!==r.widthDis&&0!==r.widthDis&&this.core.plugins.DragPlugin.expandWidthNoDrag(s.col,-r.widthDis,!1),void 0!==r.heightDis&&0!==r.heightDis&&this.core.plugins.DragPlugin.expandHeightNoDrag(s.row,-r.heightDis,!1),l.wsSend(1,t(t({undo:!0},s),{},{widthDis:r.widthDis,heightDis:r.heightDis}));break;case 2:s.fontSize=r.pre;break;case 3:s.textAlign=r.pre;break;case 4:s.textBaseline=r.pre;break;case 5:s.fontWeight=r.pre;break;case 6:s.fontItalic=r.pre;break;case 7:s.fontColor=r.pre;break;case 8:s.bgColor=r.pre;break;case 9:var a=n.searchRectByLabel(r.pre);this.wsSendInfoByTypeAndData(9,{label:r.pre,undo:!0}),this.core.plugins.ContextmenuPlugin.splitCell(a);break;case 10:for(var c=[],h=0;h<r.pre.mergeRow;h++)for(var d=0;d<r.pre.mergeCol;d++)0===h&&0===d||c.push(n.searchRectByColAndRow(r.pre.col+d,r.pre.row+h));var u=n.searchRectByLabel(r.pre.mergeStartLabel);this.wsSendInfoByTypeAndData(10,t(t({},r.pre),{},{undo:!0})),this.core.plugins.ContextmenuPlugin.mergeCell(u,c);break;case 11:this.core.plugins.DragPlugin.expandWidthNoDrag(s.col,r.pre.width-r.next.width),this.core.ws.wsSend(11,t({dis:r.pre.width-r.next.width},r));break;case 12:this.core.plugins.DragPlugin.expandHeightNoDrag(s.row,r.pre.height-r.next.height),this.core.ws.wsSend(12,t({dis:r.pre.height-r.next.height},r));break;case 13:this.core.ws.wsSend(13,t(t({},r.pre),{},{undo:!0})),this.core.plugins.ContextmenuPlugin.removeCol(r.pre.col,r.pre.num,r.pre.isLeft);break;case 14:this.core.ws.wsSend(14,t(t({},r.pre),{},{undo:!0})),this.core.plugins.ContextmenuPlugin.removeRow(r.pre.row,r.pre.num,r.pre.isTop);break;case 15:this.core.plugins.SelectPlugin.forcePasteCellToNewCell(JSON.parse(r.pre.pasteStr)),this.core.ws.wsSend(15,{undo:!0,pasteStr:r.pre.pasteStr});break;case 16:this.core.plugins.SelectPlugin.forcePasteCellToNewCell(JSON.parse(r.pre.beforeStr));var g=this.contentComponent.searchRectByLabel(r.next.label);this.core.plugins.SelectPlugin.forcePasteCellToNewCellByTargetCell(JSON.parse(r.next.beforeStr),g),this.core.ws.wsSend(16,{undo:!0,pre:r.pre.beforeStr,next:r.next.beforeStr,label:r.next.label}),this.contentComponent.setSecondClickCell(null);break;case 17:r.pre.forEach((function(t){e.core.plugins.SelectPlugin.forcePasteCellToNewCell(JSON.parse(t))})),this.core.ws.wsSend(17,{undo:!0,pre:r.pre});break;case 18:s.strikethrough=r.pre;break;case 19:s.underline=r.pre;break;case 20:r.cells.forEach((function(e){n.searchRectByLabel(e.label).text=e.text})),this.core.ws.wsSend(20,{undo:!0,cells:r.cells});break;case 21:this.setTextWrapChange(r.pre),this.setTextWrapInHeader(r.pre),this.core.ws.wsSend(21,{textWrapType:r.pre});break;case 22:s.img=JSON.parse(r.pre),this.core.ws.wsSend(22,t({undo:!0},r))}[2,3,4,5,6,7,8,18,19].includes(r.type)&&this.wsSendCellAttrByTypeAndData(r.type),o.fresh(),i.stepNum-=1,this.core.afterHandle()}}},{key:"wsSendCellAttrByTypeAndData",value:function(e){var t=this.contentComponent.clickCell;this.core.ws.wsSend(e,t)}},{key:"wsSendInfoByTypeAndData",value:function(e,t){this.core.ws.wsSend(e,t)}},{key:"registrySettingDom",value:function(){var e=this,t=this.core.h,o=t("input",{attr:{className:"cell-label-input",onblur:function(t){e.changeFirstSelectedCell(e.labelInputDom.value)},onkeydown:function(t){"Enter"===t.key&&e.changeFirstSelectedCell(e.labelInputDom.value)}}});this.labelInputDom=o;var n="A1",i=t("input",{attr:{className:"fx-input",oninput:function(t){e.core.plugins.InputPlugin.inputDom.value=t.target.value},onfocus:function(t){e.contentComponent.clickCell&&(n=e.contentComponent.clickCell.label,e.core.plugins.InputPlugin.showInput(e.contentComponent.clickCell))},onblur:function(t){void 0!==e.core.plugins.InputPlugin.inputDom.value&&null!==e.core.plugins.InputPlugin.inputDom.value?(e.changeStepArr({type:1,label:n,pre:e.contentComponent.clickCell.text,next:e.core.plugins.InputPlugin.inputDom.value}),e.contentComponent.searchRectByLabel(n).text=e.core.plugins.InputPlugin.inputDom.value,e.core.freshContent(),e.core.plugins.InputPlugin.hideInput()):e.core.plugins.InputPlugin.hideInput()}}});this.fxInputDom=i;var l=t("div",{attr:{className:"e-sheet-setting-input-bar-layout"}},[t("div",{attr:{className:"left-input-layout"}},[o]),t("div",{attr:{className:"right-input-layout"}},[t("span",{attr:{innerText:"fx",className:"prefix-label"}}),i])]);this.selectorDom.insertBefore(l,this.canvasWrapperDom),this.createFontHorAddrGroup(),this.createFontVerAddrGroup();var r=t("div",{attr:{className:"e-sheet-setting-layout"}}),s=t("div",{attr:{className:"font-position-layout"}});s.appendChild(this.fontVerAddrGroup),s.appendChild(this.fontHorAddrGroup),this.createFontSizeSelectDom();var a=t("div",{attr:{className:"font-position-layout"}}),c=t("div",{attr:{className:"font-position-layout"}});a.appendChild(this.fontSizeSelectDom),this.createFontWeightBtnDom(),this.createFontItalicBtnDom(),this.createFontUnderlineBtnDom(),this.createFontStrikethroughBtnDom();var h=t("div",{attr:{className:"e-sheet-font-style-layout"}},[this.fontWeightBtnDom,this.fontItalicBtnDom,this.fontUnderlineBtnDom,this.fontStrikethroughBtnDom]);a.appendChild(h),c.appendChild(this.createFontColorSelectDom()),c.appendChild(this.createBgColorSelectDom());var d=t("div",{attr:{className:"e-sheet-divide-line"}});this.createCellMergerBtnDom(),this.createCellSplitBtnDom(),this.createTextWrapBtnDom(),this.createExtraFuncDom();var u=t("div",{attr:{className:"font-position-layout"}});u.appendChild(this.cellMergerBtnDom),u.appendChild(this.cellSplitBtnDom),u.appendChild(this.textWrapGroup),r.appendChild(this.createStepDom()),r.appendChild(d.cloneNode()),r.appendChild(s),r.appendChild(d.cloneNode()),r.appendChild(a),r.appendChild(d.cloneNode()),r.appendChild(c),r.appendChild(d.cloneNode()),r.appendChild(u),r.appendChild(d.cloneNode()),r.appendChild(this.uploadCellImgDom),this.selectorDom.insertBefore(r,l)}},{key:"createStepDom",value:function(){var e=this,t=this.core.h,o=t("e-sheet-radio-button",{attribute:{label:"撤销(Ctrl+Z)",value:"fallback",top:24,left:-24},attr:{onclick:function(t){e.fallbackSetSheet()}}},[t("e-sheet-icon-svg",{attribute:{category:"step",position:"fallback"}})]),n=t("e-sheet-radio-button",{attribute:{label:"重做(Ctrl+Y)",value:"forward",top:24,left:-24},attr:{onclick:function(t){e.forwardSetSheet()}}},[t("e-sheet-icon-svg",{attribute:{category:"step",position:"forward"}})]);document.addEventListener("keydown",(function(t){t.ctrlKey&&"z"===t.key&&e.fallbackSetSheet(),t.ctrlKey&&"y"===t.key&&e.forwardSetSheet()}));var i=t("div",{attr:{className:"font-position-layout"}});return i.appendChild(o),i.appendChild(n),i}},{key:"createCellSplitBtnDom",value:function(){var e=this,t=this.core.h,o=t("e-sheet-tip",{style:{display:"none"}},[t("div",{attr:{className:"e-sheet-font-style-layout e-sheet-cell-hover"},style:{cursor:"pointer",padding:"2px"}},[t("e-sheet-icon-svg",{attribute:{category:"cell",position:"split"}}),t("div",{attr:{innerText:"拆分单元格",className:"e-sheet-cell-font"}})])]);o.onclick=function(t){var n=e.contentComponent.clickCell,i={row:n.row,col:n.col,mergeRow:n.mergeRow,mergeCol:n.mergeCol,mergeStartLabel:n.mergeStartLabel,mergeEndLabel:n.mergeEndLabel,isMerge:!1};e.changeStepArr({type:10,label:n.label,pre:{row:n.row,col:n.col,mergeRow:n.mergeRow,mergeCol:n.mergeCol,mergeStartLabel:n.mergeStartLabel,mergeEndLabel:n.mergeEndLabel,isMerge:!0},next:i}),e.wsSendInfoByTypeAndData(10,i),e.core.plugins.ContextmenuPlugin.splitCell(n)&&(e.cellMergerBtnDom.style.display="flex",o.style.display="none")},this.cellSplitBtnDom=o}},{key:"createCellMergerBtnDom",value:function(){var e=this,t=this.core.h,o=t("e-sheet-tip",{attribute:{"tip-label":"合并单元格",left:4,top:24}},[t("div",{attr:{className:"e-sheet-font-style-layout e-sheet-cell-hover"},style:{padding:"2px",userSelect:"none"}},[t("e-sheet-icon-svg",{attribute:{category:"cell",position:"merge"}}),t("div",{attr:{innerText:"合并单元格",className:"e-sheet-cell-font"}})])]);o.onclick=function(t){var n=e.contentComponent,i=n.clickCell,l=n.mergeSelectedCell,r={type:9,label:i.label},s=[i].concat(p(l)).sort((function(e,t){return e.row-t.row+(e.col-t.col)}));r.pre=s[0].label,r.next=s.map((function(e){return e.label})),e.changeStepArr(r),e.wsSendInfoByTypeAndData(9,r.next),e.core.plugins.ContextmenuPlugin.mergeCell(s[0],s.slice(0))&&(o.style.display="none",e.cellSplitBtnDom.style.display="flex")},this.cellMergerBtnDom=o}},{key:"createBgColorSelectDom",value:function(){var e=this,t=this.core.h,o=t("e-sheet-tip",{attribute:{"tip-label":"背景颜色",left:-10,top:22}}),n=t("e-sheet-icon-color-svg",{attribute:{category:"bg-color"}});return this.bgColorSelectDom=n,o.appendChild(n),n.addEventListener("e-sheet-icon-color-svg-onchange",(function(t){e.convenientChangeStepArr(8,"bgColor",t.detail),e.cellBgColorChange(t.detail),e.wsSendCellAttrByTypeAndData(8)})),o}},{key:"createFontColorSelectDom",value:function(){var e=this,t=this.core.h,o=t("e-sheet-icon-color-svg",{attribute:{category:"font-color"}});o.addEventListener("e-sheet-icon-color-svg-onchange",(function(t){e.convenientChangeStepArr(7,"fontColor",t.detail),e.cellFontColorChange(t.detail),e.wsSendCellAttrByTypeAndData(7)}));var n=t("e-sheet-tip",{attribute:{"tip-label":"字体颜色",left:-10,top:22}});return n.appendChild(o),this.fontColorSelectDom=o,n}},{key:"createFontHorAddrGroup",value:function(){var e=this,t=this.core.h,o=t("e-sheet-radio-group",{},[t("e-sheet-radio-button",{attribute:{label:"左对齐",value:"left"}},[t("e-sheet-icon-svg",{attribute:{category:"hor",position:"left"}})]),t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"居中对齐",value:"center"}},[t("e-sheet-icon-svg",{attribute:{category:"hor",position:"center"}})]),t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"右对齐",value:"right"}},[t("e-sheet-icon-svg",{attribute:{category:"hor",position:"right"}})])]);this.fontHorAddrGroup=o,o.addEventListener("e-sheet-radio-group-onchange",(function(t){e.convenientChangeStepArr(4,"textAlign",t.detail),e.cellFontTextAlignChange(t.detail),e.wsSendCellAttrByTypeAndData(4)}))}},{key:"createFontVerAddrGroup",value:function(){var e=this,t=this.core.h,o=t("e-sheet-radio-group",{},[t("e-sheet-radio-button",{attribute:{label:"顶部对齐",value:"top"}},[t("e-sheet-icon-svg",{attribute:{category:"ver",position:"top"}})]),t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"垂直居中",value:"middle"}},[t("e-sheet-icon-svg",{attribute:{category:"ver",position:"middle"}})]),t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"底部对齐",value:"bottom"}},[t("e-sheet-icon-svg",{attribute:{category:"ver",position:"bottom"}})])]);this.fontVerAddrGroup=o,o.addEventListener("e-sheet-radio-group-onchange",(function(t){e.convenientChangeStepArr(3,"textBaseLine",t.detail),e.cellFontTextBaseLineChange(t.detail),e.wsSendCellAttrByTypeAndData(3)}))}},{key:"createFontSizeSelectDom",value:function(){var e=this,t=(0,this.core.h)("e-sheet-select",{});t.addEventListener("e-sheet-select-onchange",(function(t){e.convenientChangeStepArr(2,"fontSize",parseInt(t.detail)),e.cellFontSizeChange(t.detail),e.wsSendCellAttrByTypeAndData(2)})),t.setAttribute("label","字号"),this.fontSizeSelectDom=t}},{key:"createFontWeightBtnDom",value:function(){var e=this,t=this.core.h,o=t("e-sheet-radio-button",{attribute:{label:"粗体",value:"bold"}},[t("e-sheet-icon-svg",{attribute:{category:"font",position:"weight"}})]);this.fontWeightBtnDom=o,o.addEventListener("e-sheet-radio-group-change",(function(t){""===o.getAttribute("current")?(o.setAttribute("current",t.detail),e.convenientChangeStepArr(5,"fontWeight",t.detail),e.cellFontWeightChange(t.detail)):(o.setAttribute("current",""),e.convenientChangeStepArr(5,"fontWeight",""),e.cellFontWeightChange("")),e.wsSendCellAttrByTypeAndData(5)}))}},{key:"createFontItalicBtnDom",value:function(){var e=this,t=this.core.h,o=t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"斜体",value:"italic"}},[t("e-sheet-icon-svg",{attribute:{category:"font",position:"italic"}})]);this.fontItalicBtnDom=o,o.addEventListener("e-sheet-radio-group-change",(function(t){""===o.getAttribute("current")?(o.setAttribute("current",t.detail),e.convenientChangeStepArr(6,"fontItalic",t.detail),e.cellFontItalicChange(t.detail)):(o.setAttribute("current",""),e.convenientChangeStepArr(6,"fontItalic",""),e.cellFontItalicChange("")),e.wsSendCellAttrByTypeAndData(6)}))}},{key:"createFontStrikethroughBtnDom",value:function(){var e=this,t=this.core.h,o=t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"删除线",value:"true"}},[t("e-sheet-icon-svg",{attribute:{category:"font",position:"strikethrough"}})]);this.fontStrikethroughBtnDom=o,o.addEventListener("e-sheet-radio-group-change",(function(t){""===o.getAttribute("current")?(o.setAttribute("current",t.detail),e.convenientChangeStepArr(18,"strikethrough",t.detail),e.cellStrikethroughChange("true")):(o.setAttribute("current",""),e.convenientChangeStepArr(18,"strikethrough",""),e.cellStrikethroughChange("")),e.wsSendCellAttrByTypeAndData(18)}))}},{key:"createFontUnderlineBtnDom",value:function(){var e=this,t=this.core.h,o=t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"下划线",value:"true"}},[t("e-sheet-icon-svg",{attribute:{category:"font",position:"underline"}})]);this.fontUnderlineBtnDom=o,o.addEventListener("e-sheet-radio-group-change",(function(t){""===o.getAttribute("current")?(o.setAttribute("current",t.detail),e.convenientChangeStepArr(19,"underline",t.detail),e.cellUnderlineChange("true")):(o.setAttribute("current",""),e.convenientChangeStepArr(19,"underline",""),e.cellUnderlineChange("")),e.wsSendCellAttrByTypeAndData(19)}))}},{key:"createTextWrapBtnDom",value:function(){var e=this,t=this.core.h,o=t("e-sheet-radio-group",{},[t("e-sheet-radio-button",{attribute:{label:"截断",value:"cut"}},[t("e-sheet-icon-svg",{attribute:{category:"text",position:"cut"}})]),t("e-sheet-radio-button",{style:{marginLeft:"6px"},attribute:{label:"换行",value:"wrap"}},[t("e-sheet-icon-svg",{attribute:{category:"text",position:"wrap"}})])]);this.textWrapGroup=o,o.addEventListener("e-sheet-radio-group-onchange",(function(t){var o=e.core.getCurrentSheet();e.changeStepArr({type:21,pre:o.config.textWrapType,next:t.detail}),e.core.ws.wsSend(21,{textWrapType:t.detail}),e.setTextWrapChange(t.detail)}))}},{key:"setTextWrapInHeader",value:function(e){this.textWrapGroup.setAttribute("value",null!=e?e:"cut")}},{key:"createExtraFuncDom",value:function(){var e=this,t=this.core.h;this.uploadCellImgInputDom=t("input",{style:{width:0,height:0,padding:0,border:"none"},attr:{type:"file",multiple:!0}});var o=t("div",{style:{display:"flex",alignItems:"center",height:"52px"}},[t("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},[t("e-sheet-tip",{attribute:{"tip-label":"插入单元格图片",left:-40,top:22}},[t("e-sheet-icon-svg",{attribute:{category:"extra",position:"cell-img"}})]),t("div",{attr:{innerText:"图片",className:"e-sheet-cell-font"},style:{marginTop:"6px"}})]),this.uploadCellImgInputDom]);this.uploadCellImgInputDom.addEventListener("input",(function(t){var o=e.contentComponent.clickCell;e.core.options.uploadImg?e.core.options.uploadImg(t.target.files).then((function(t){w(t).then((function(t){var n=[],i=0,l=0;t.forEach((function(t){n.push(t.url),e.core.imgCanvasElMap[t.url]=t.imgEl,i+=t.imgEl.width,l+=t.imgEl.height})),i>o.width&&e.core.plugins.DragPlugin.expandWidthNoDrag(o.col,i,!1),l>o.height&&e.core.plugins.DragPlugin.expandHeightNoDrag(o.row,l,!1),e.changeStepArr({type:22,label:o.label,pre:JSON.stringify(o.img),next:JSON.stringify(o.img.concat(n))}),e.cellImgChange(n)}))})):function(e){for(var t=[],o=0;o<e.length;o++)t.push(C(e[o]));return Promise.all(t)}(t.target.files).then((function(t){var n=[],i=0;t.forEach((function(t){n.push(t.url),e.core.imgCanvasElMap[t.url]=t.imgEl,i+=t.imgEl.width})),i>o.width&&e.core.plugins.DragPlugin.expandWidthNoDrag(o.col,i,!1);var l=Math.max.apply(Math,p(t.map((function(e){return e.imgEl.height}))));l>o.height&&e.core.plugins.DragPlugin.expandHeightNoDrag(o.row,l,!1),e.cellImgChange(n)}))})),o.addEventListener("click",(function(t){e.uploadCellImgInputDom.click()})),this.uploadCellImgDom=o}}]),e}(),S=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;o(this,e),l(this,"canvasDom",null),l(this,"ctx",null),l(this,"cellWidth",0),l(this,"cellHeight",0),this.ctx=t.getContext("2d"),this.cellWidth=i.cellWidth,this.cellHeight=i.cellHeight,this.canvasDom=t,this.core=r,t.addEventListener("mousemove",(function(e){n.setCursor("cell")}))}return i(e,[{key:"setCursor",value:function(e){this.canvasDom.style.cursor="url(".concat(v[e],") 18 18, ").concat(e)}},{key:"setCursorDefault",value:function(){this.canvasDom.style.cursor="default"}},{key:"drawLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"source-over",o=arguments.length>2?arguments[2]:void 0;if(this.ctx.strokeStyle=null!=o?o:"black",this.ctx.lineWidth=1,this.ctx.globalCompositeOperation=t,this.ctx.beginPath(),e.length%2!=0)throw new Error("points is error");var n=e.length/2;this.ctx.moveTo(e[0],e[1]);for(var i=2;i<n+1;i+=2)this.ctx.lineTo(e[i],e[i+1]);this.ctx.closePath(),this.ctx.stroke()}},{key:"drawImage",value:function(e,t,o,n,i,l,r){var s=this,a=e;o.forEach((function(e){s.ctx.globalCompositeOperation="destination-over";var o=s.core.imgCanvasElMap[e];s.ctx.drawImage(o,a,t,o.width,o.height),a+=o.width}))}},{key:"drawText",value:function(e,t){var o,n,i=this,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"center",d=arguments.length>8?arguments[8]:void 0,u=arguments.length>9?arguments[9]:void 0,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"",m=arguments.length>12&&void 0!==arguments[12]?arguments[12]:"cut";if(0!==l.length){var f=this.ctx,v=this.cellWidth,C=this.cellHeight;if(f.globalCompositeOperation=null!=a?a:"source-over",r=null!==(o=r)&&void 0!==o?o:v,s=null!==(n=s)&&void 0!==n?n:C,d.fontSize=d.fontSize?parseInt(d.fontSize):12,f.font=d?"".concat(d.fontWeight+" ").concat(d.fontItalic+" ").concat(d.fontSize,"px ").concat(d.fontFamily):"12px Calibre",f.fillStyle=c||"black","wrap"===m)return f.textBaseline="top",f.textAlign="start",void l.split("\n").forEach((function(o,n){f.fillText(o,e+2,t+2+n*d.fontSize);var l=f.measureText(o).width;if("true"===g){var r=d.fontSize/2;i.drawThroughLine(e,t+n*d.fontSize+r,e+l+2,t+n*d.fontSize+r)}"true"===p&&i.drawThroughLine(e,t+(n+1)*d.fontSize,e+l+2,t+(n+1)*d.fontSize)}));var y=e+r/2,w=t+s/2;f.textBaseline=u||"middle",f.textAlign=h||"center";var b="";if(f.measureText(l).width>r){var S=(r/d.fontSize).toFixed(0)-1;b=l.slice(0,S-1)+"..."}else b=l;var x=0,k=0;if(x="left"===h?e:"right"===h?e+r:y,k="top"===u?t+2:"bottom"===u?t+s-2:w,f.fillText(b,x,k,r),"true"===g&&l){var D=f.measureText(b);"right"===h&&"middle"===u&&this.drawThroughLine(x-D.width,k,x,k),"left"===h&&"middle"===u&&this.drawThroughLine(x,k,x+D.width,k),"center"===h&&"top"===u&&this.drawThroughLine(x-D.width/2,k+d.fontSize/2,x+D.width/2,k+d.fontSize/2),"center"===h&&"bottom"===u&&this.drawThroughLine(x-D.width/2,k-d.fontSize/2,x+D.width/2,k-d.fontSize/2),"right"===h&&"bottom"===u&&this.drawThroughLine(x-D.width,k-d.fontSize/2,x,k-d.fontSize/2),"right"===h&&"top"===u&&this.drawThroughLine(x-D.width,k+d.fontSize/2,x,k+d.fontSize/2),"left"===h&&"bottom"===u&&this.drawThroughLine(x,k-d.fontSize/2,x+D.width,k-d.fontSize/2),"left"===h&&"top"===u?this.drawThroughLine(x,k+d.fontSize/2,x+D.width,k+d.fontSize/2):"center"===h&&"middle"===u&&this.drawThroughLine(x-D.width/2,k,x+D.width/2,k)}if("true"===p&&l){var M=f.measureText(b);"right"===h&&"middle"===u&&this.drawThroughLine(x-M.width,k+d.fontSize/2,x,k+d.fontSize/2),"left"===h&&"middle"===u&&this.drawThroughLine(x,k+d.fontSize/2,x+M.width,k+d.fontSize/2),"center"===h&&"top"===u&&this.drawThroughLine(x-M.width/2,k+d.fontSize,x+M.width/2,k+d.fontSize),"center"===h&&"bottom"===u&&this.drawThroughLine(x-M.width/2,k,x+M.width/2,k),"right"===h&&"bottom"===u&&this.drawThroughLine(x-M.width,k,x,k),"right"===h&&"top"===u&&this.drawThroughLine(x-M.width,k+d.fontSize,x,k+d.fontSize),"left"===h&&"bottom"===u&&this.drawThroughLine(x,k,x+M.width,k),"left"===h&&"top"===u?this.drawThroughLine(x,k+d.fontSize,x+M.width,k+d.fontSize):"center"===h&&"middle"===u&&this.drawThroughLine(x-M.width/2,k+d.fontSize/2,x+M.width/2,k+d.fontSize/2)}}}},{key:"drawThroughLine",value:function(e,t,o,n){this.ctx.strokeStyle="black",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(o,n),this.ctx.closePath(),this.ctx.stroke()}},{key:"clearRect",value:function(e,t,o,n){this.ctx.clearRect(e,t,o,n)}},{key:"drawStrokeRect",value:function(e,t,o,n,i,l){var r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;this.ctx.lineWidth=r,this.ctx.globalCompositeOperation=null!=l?l:"source-over",this.ctx.strokeStyle=null!=i?i:"black",this.ctx.strokeRect(e,t,o,n)}},{key:"drawFillRect",value:function(e,t,o,n,i,l){this.ctx.fillStyle=null!=i?i:"black",this.ctx.globalCompositeOperation=null!=l?l:"source-over",this.ctx.fillRect(e,t,o,n)}},{key:"drawDashStrokeRect",value:function(e,t,o,n,i,l){var r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;this.ctx.lineWidth=r,this.ctx.globalCompositeOperation=null!=l?l:"source-over",this.ctx.strokeStyle=null!=i?i:"black",this.ctx.setLineDash([5,5]),this.ctx.strokeRect(e,t,o,n),this.ctx.setLineDash([])}},{key:"drawTriangleRect",value:function(e,t,o,n){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.lineTo(o.x,o.y),this.ctx.closePath(),this.ctx.fillStyle=null!=n?n:"black",this.ctx.fill()}}]),e}();function x(e){return e>26?e%26==0?String.fromCharCode(64+parseInt((Math.floor(e/26)-1).toFixed(0)))+String.fromCharCode(90):String.fromCharCode(64+parseInt(Math.floor(e/26).toFixed(0)))+String.fromCharCode(64+e%26):String.fromCharCode(64+e)}var k=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};o(this,e),l(this,"imgCanvasElMap",{}),l(this,"textWrapType","cut"),l(this,"mulPersonSelected",[]),l(this,"userId",(new Date).valueOf()),l(this,"userName",(new Date).valueOf().toString()),l(this,"userColor",this.getRandomColor()),l(this,"stepCallbackArr",[]),l(this,"scale",1),l(this,"ws",void 0),l(this,"fontSize",12),l(this,"workBook",{}),l(this,"eSheetWorkBook",[]),l(this,"row",60),l(this,"col",26),l(this,"cellWidth",120),l(this,"cellHeight",40),l(this,"width",600),l(this,"height",600),l(this,"sheetWidth",0),l(this,"sheetHeight",0),l(this,"selectorDom",null),l(this,"canvasDom",null),l(this,"canvasWrapperDom",null),l(this,"layer",null),l(this,"components",{}),l(this,"plugins",{}),l(this,"copyKey",!1),l(this,"copyCellDash",[]),l(this,"shiftKey",!1),l(this,"ctrlKey",!1),l(this,"dragSign",!1),l(this,"lockDrag",!1),l(this,"dragSignDirectionIsHor",!1),l(this,"offsetYLock",!1),l(this,"offsetXLock",!1),l(this,"isScrollBottomBound",!1),l(this,"isScrollRightBound",!1),l(this,"nonSelectBgColor","#FFFFFF"),l(this,"selectedBorderBgColor","#0089FF"),l(this,"selectedBgColor","#EBF4FF"),l(this,"borderColor","#ECEDEE"),l(this,"borderCellBgColor","#F9FBFD"),l(this,"currentSheetIndex",0),l(this,"installComponentsObj",{}),l(this,"installPluginsObj",{}),l(this,"getType",(function(e){return Object.prototype.toString.call(e)})),l(this,"h",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.attr,i=t.style,l=t.attribute,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=document.createElement(e);for(var a in o)s[a]=o[a];for(var c in l)s.setAttribute(c,l[c]);for(var h in i)s.style[h]=i[h];r&&("[object Array]"===n.getType(r)?r.forEach((function(e){s.appendChild(e)})):s.appendChild(r));return s})),l(this,"fps",0),l(this,"lastTime",0),l(this,"draw",(function(){var e=performance.now(),t=e-n.lastTime;n.lastTime=e,n.fps=Math.round(1e3/t),requestAnimationFrame(n.draw)})),i.width=i.width&&!isNaN(i.width)&&i.width>0?i.width:this.width,i.height=i.height&&!isNaN(i.height)&&i.height>0?i.height:this.width,i.row=i.row&&i.row>this.row?i.row:this.row,i.col=i.col&&i.col>this.col?i.col:this.col,i.cellWidth=this.cellWidth,i.cellHeight=this.cellHeight,this.installComponentsObj=r,this.installPluginsObj=s,this.selectorDom=t;var a=document.createElement("canvas");a.width=i.width,a.height=i.height;var c=this.h("div",{attr:{className:"e-sheet-canvas-wrapper"}});if(c.appendChild(a),this.canvasWrapperDom=c,this.selectorDom.style.width=i.width+"px",this.canvasWrapperDom.style.width=i.width+"px",this.canvasWrapperDom.style.height=i.height+"px",this.selectorDom.appendChild(c),this.canvasDom=a,this.layer=new S(a,i,this),this.options=i,i.init)this.installComponents(r),this.installPlugins(s),this.createNewSheet(),this.drawCanvas(),this.freshScrollBar(),this.plugins.SettingPlugin.changeFirstSelectedCell("A1"),this.plugins.SettingPlugin.setTextWrapInHeader("cut"),this.ws=this.plugins.WebsocketPlugin;else{var h=this.h("e-sheet-loading-cup");this.selectorDom.appendChild(h)}}return i(e,[{key:"resetESheetWorkBook",value:function(){this.eSheetWorkBook=[]}},{key:"loadData",value:function(e){var t=this;return new Promise((function(o){t.resetESheetWorkBook(),(!e||Array.isArray(e)&&0===e.length)&&(t.createNewSheet(),o());var n=[];e.forEach((function(e){var o,i;e.sheet.forEach((function(e){Array.isArray(e.img)&&e.img.length>0&&(n=n.concat(e.img))})),t.eSheetWorkBook.push({id:e.id,label:e.label,sheet:e.sheet,clickCell:null,stepArr:[],stepNum:-1,config:{textWrapType:null!==(o=null===(i=e.config)||void 0===i?void 0:i.textWrapType)&&void 0!==o?o:"cut"}})})),w(n).then((function(e){e.forEach((function(e){t.imgCanvasElMap[e.url]=e.imgEl})),o()}))}))}},{key:"drawExcel",value:function(e){var t=this;this.currentSheetIndex=0,this.loadData(e).then((function(){0===Object.keys(t.components).length&&(t.installComponents(t.installComponentsObj),t.installPlugins(t.installPluginsObj)),t.drawCanvas(),t.freshScrollBar(),t.plugins.SettingPlugin.changeFirstSelectedCell("A1");var e=t.getCurrentSheet();t.plugins.SettingPlugin.setTextWrapInHeader(e.config.textWrapType),t.ws||(t.ws=t.plugins.WebsocketPlugin);var o=t.selectorDom.querySelector(".e-sheet-loading-cup-layout");o&&o.remove()}))}},{key:"drawCanvas",value:function(){this.currentSheetIndex=0;var e=this.eSheetWorkBook[this.currentSheetIndex];this.components.ContentComponent.installContentDataByData(e.sheet),e.clickCell&&this.components.ContentComponent.showClickRect(e.clickCell);var t=this.getSheetAttr();this.sheetWidth=t.sheetWidth,this.sheetHeight=t.sheetHeight,this.row=t.row,this.col=t.col,this.components.WholeComponent.draw(),this.components.HeaderComponent.trendsDraw(0),this.components.SideComponent.trendsDraw(0),this.components.ContentComponent.trendsDraw(0,0),this.plugins.BookPlugin.freshBookSheet()}},{key:"getRandomColor",value:function(){var e=Math.floor(16777215*Math.random()).toString(16);return 6===e.length?"#"+e:this.getRandomColor()}},{key:"stepCallbackHandle",value:function(e){this.stepCallbackArr.push(e)}},{key:"afterHandle",value:function(){var e=this;this.stepCallbackArr.forEach((function(t){"[object Function]"===e.getType(t)&&t()}))}},{key:"exportXlsxData",value:function(){var e=[];return this.eSheetWorkBook.forEach((function(t){var o=t.sheet.filter((function(e){return e.isMerge})),n=o.filter((function(e){return e.mergeStartLabel===e.label})).map((function(e){var t=o.findIndex((function(t){return t.label===e.mergeEndLabel})),n=o[t];return{s:{c:e.col-1,r:e.row-1},e:{c:n.col-1,r:n.row-1}}})),i=t.sheet.filter((function(e){return!!e.text})).filter((function(e){return e.isMerge&&e.label===e.mergeStartLabel||!e.isMerge})),l={};if(i.forEach((function(e){l[e.label]={t:"s",v:e.text}})),i.length>1){var r=i.map((function(e){return e.row})),s=i.map((function(e){return e.col})),a=Math.min.apply(Math,p(r)),c=Math.min.apply(Math,p(s)),h=Math.max.apply(Math,p(r)),d=Math.max.apply(Math,p(s)),u=x(c)+a,g=x(d)+h;l["!ref"]=u+":"+g}else 1===i.length&&(l["!ref"]=i[0].label);var m={label:t.label,sheet:l};n.length>0&&(l["!merges"]=n),e.push(m)})),e}},{key:"connectWebSocket",value:function(e){this.ws.connect(e)}},{key:"setUserName",value:function(e){this.userName=e}},{key:"setUserId",value:function(e){this.userId=e}},{key:"switchSheet",value:function(e){this.saveHandle();var t=this.eSheetWorkBook[e];if(this.currentSheetIndex=e,this.components.ContentComponent.installContentDataByData(t.sheet),t.clickCell)this.components.ContentComponent.showClickRect(t.clickCell),this.plugins.SettingPlugin.setLabelCon(t.clickCell.label),this.plugins.SettingPlugin.setCellCon(t.clickCell.text);else{var o=this.components.ContentComponent.searchRectByLabel("A1");this.components.ContentComponent.showClickRect(o),this.plugins.SettingPlugin.setLabelCon(o.label),this.plugins.SettingPlugin.setCellCon(o.text)}this.plugins.SettingPlugin.setTextWrapInHeader(t.config.textWrapType),this.fresh()}},{key:"saveHandle",value:function(){if(this.copyKey=!1,this.copyCellDash=[],this.components.ContentComponent&&this.components.ContentComponent.clickCell){var e=this.eSheetWorkBook[this.currentSheetIndex];e&&(e.clickCell=this.components.ContentComponent.clickCell),this.components.ContentComponent.hideClickRect()}}},{key:"getCurrentSheet",value:function(){return this.eSheetWorkBook[this.currentSheetIndex]}},{key:"getSheetById",value:function(e){var t=this.eSheetWorkBook.findIndex((function(t){return t.id===e}));return-1!==t?this.eSheetWorkBook[t]:null}},{key:"createNewSheet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Sheet";this.saveHandle();var t=this.options,o=t.row,n=t.col,i=t.cellWidth,l=t.cellHeight,r=0,s=0,a=0,c=l;this.sheetWidth=0,this.sheetHeight=0;for(var h=1,d=e+h,u=this.eSheetWorkBook.findIndex((function(e){return e.label===d}));-1!==u;)h++,d=e+h,u=this.eSheetWorkBook.findIndex((function(e){return e.label===d}));this.eSheetWorkBook.push({id:(new Date).valueOf(),label:d,sheet:[],clickCell:null,stepArr:[],stepNum:-1,config:{textWrapType:"cut"}}),this.currentSheetIndex=this.eSheetWorkBook.length-1;for(var g=this.eSheetWorkBook[this.eSheetWorkBook.length-1].sheet,p=0;p<o;p++){r=0,s=l,this.sheetHeight+=l;for(var m=0;m<n;m++){0===p&&(this.sheetWidth+=i);var f=x(m+1)+(p+1);g.push({row:p+1,col:m+1,text:"",textAsNumber:NaN,width:i,height:l,x:r,y:a,ltX:s,ltY:c,mergeWidth:0,mergeHeight:0,mergeRow:1,mergeCol:1,mergeStartLabel:"",mergeEndLabel:"",mergeLabelGroup:[],isMerge:!1,bgColor:"#ffffff",fontColor:"#000000",font:null,fontSize:12,fontWeight:"",fontItalic:"",fontFamily:"Calibre",textAlign:"center",textBaseline:"middle",strikethrough:"",underline:"",img:[],label:f}),r+=i,s+=i}a+=l,c+=l}this.afterHandle()}},{key:"initExcelData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Sheet1",t=this.options,o=t.row,n=t.col,i=t.cellWidth,l=t.cellHeight,r=0,s=0,a=0,c=l;this.sheetWidth=0,this.sheetHeight=0;var h=this.eSheetWorkBook.findIndex((function(t){return t.label===e})),d=0;-1===h?(this.eSheetWorkBook.push({label:e,sheet:[]}),d=this.eSheetWorkBook.length-1):d=h,this.eSheetWorkBook[d].sheet=[];for(var u=0;u<o;u++){r=0,s=l,this.sheetHeight+=l;for(var g=0;g<n;g++){var p,m;0===u&&(this.sheetWidth+=i);var f=x(g+1)+(u+1);this.eSheetWorkBook[d].sheet.push({row:u+1,col:g+1,text:this.workBook[e]&&null!==(p=null===(m=this.workBook[e][String.fromCharCode(65+g)+(u+1)])||void 0===m?void 0:m.v)&&void 0!==p?p:"",textAsNumber:NaN,width:i,height:l,x:r,y:a,ltX:s,ltY:c,mergeWidth:0,mergeHeight:0,mergeRow:1,mergeCol:1,mergeStartLabel:"",mergeEndLabel:"",mergeLabelGroup:[],isMerge:!1,bgColor:"#ffffff",fontColor:"#000000",font:null,fontSize:12,fontWeight:"",fontItalic:"",fontFamily:"Calibre",textAlign:"center",textBaseline:"middle",label:f}),r+=i,s+=i}a+=l,c+=l}}},{key:"installXlsxData",value:function(e){if(this.workBook=e,0===Object.keys(e).length)throw new Error("data is error");this.initExcelData(Object.keys(e)[0]),this.components.ContentComponent.installContentDataByName(Object.keys(e)[0]),this.components.ContentComponent.hideClickRect(),this.fresh()}},{key:"installComponents",value:function(e){for(var t in e)this.components[t]=new e[t](this.layer,this.options,this)}},{key:"installPlugins",value:function(e){for(var t in e)this.plugins[t]=new e[t](this.selectorDom,this.layer,this.options,this.components,this)}},{key:"fresh",value:function(){var e=this.plugins.ScrollPlugin,t=e.offsetX,o=e.offsetY,n=this.components,i=n.ContentComponent,l=n.HeaderComponent,r=n.SideComponent,s=n.WholeComponent;i.trendsDraw(t,o),l.trendsDraw(t),r.trendsDraw(o),s.draw()}},{key:"freshContent",value:function(){var e=this.plugins.ScrollPlugin,t=e.offsetX,o=e.offsetY;this.components.ContentComponent.trendsDraw(t,o)}},{key:"getSheetAttr",value:function(){var e=this.getCurrentSheet(),t=Math.max.apply(Math,p(e.sheet.map((function(e){return e.col})))),o=Math.max.apply(Math,p(e.sheet.map((function(e){return e.row})))),n=0,i=0;return e.sheet.forEach((function(e){e.col<=t&&1===e.row&&(n+=e.width),1===e.col&&(i+=e.height)})),{col:t,row:o,sheetWidth:n,sheetHeight:i}}},{key:"freshScrollBar",value:function(){var e=this.getSheetAttr();this.sheetWidth=e.sheetWidth,this.sheetHeight=e.sheetHeight,this.plugins.ScrollPlugin.changeHorBarWidth(),this.plugins.ScrollPlugin.changeVerBarHeight()}}]),e}(),D=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;o(this,e),l(this,"options",{}),l(this,"layer",null),l(this,"core",null),this.layer=t,this.options=n,this.core=i}return i(e,[{key:"draw",value:function(){var e=this.core,t=e.borderCellBgColor,o=e.borderColor,n=this.options.cellHeight;this.layer.clearRect(0,0,n,n),this.layer.drawTriangleRect({x:n-6,y:6},{x:n-6,y:n-6},{x:6,y:n-6},"#DCDCDC"),this.layer.drawLine([0,0,n,0],null,o),this.layer.drawLine([0,0,0,n],null,o),this.layer.drawFillRect(0,0,n,n,t,"destination-over")}},{key:"addEvent",value:function(){}}]),e}(),M=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;o(this,e),l(this,"options",{}),l(this,"layer",null),l(this,"headerRectGroup",[]),this.options=n,this.layer=t,this.core=i}return i(e,[{key:"initDraw",value:function(){for(var e=this.options.col,t=this.options.cellWidth,o=this.options.cellHeight,n=0;n<e;n++){var i=String.fromCharCode(65+n),l=new Konva.Rect({x:n*t+40,y:0,width:t,height:o,fill:"#c0c4cc",stroke:"#606266",strokeWidth:1,attrs:{headerLabel:i,col:n,row:0}}),r=new Konva.Text({x:n*t+40,y:0,width:t,height:o,align:"center",verticalAlign:"middle",text:i,fontSize:20,fontFamily:"Calibri",fill:"black",attrs:{headerLabel:i,col:n,row:0}});l.hide(),r.hide(),this.headerBackGroup.add(l),this.headerTextGroup.add(r)}var s=new Konva.Line({points:[0,0,0,0],stroke:"blue",strokeWidth:1,lineCap:"round",lineJoin:"round"});this.headerBorderGroup.add(s)}},{key:"trendsDraw",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=this.options,n=o.width,i=o.cellHeight,l=this.core,r=l.borderCellBgColor,s=l.nonSelectBgColor,a=l.borderColor,c=l.selectedBgColor,h=this.core.components.ContentComponent,d=h.contentGroup,u=h.clickCell,g=h.clickRectShow,p=h.isRowSelect,m=h.secondClickCell,f=h.attrSecond,v=h.attrFirst,C=h.startAndEndRect,y=this.searchScreenAddr(t,0),w=this.searchScreenAddr(t+n-i,i),b=d.filter((function(e){return e.col>=y.col&&1===e.row&&e.col<=w.col}));this.headerRectGroup=b,this.layer.clearRect(i,0,n,i),this.layer.drawLine([i,0,n,0],null,a),this.layer.drawLine([i,i,n,i],null,a);for(var S=function(){var o=b[x];if(e.layer.drawText(o.x+i-t,0,o.label.slice(0,o.label.length-1),o.width,i,"destination-over",null,null,{fontSize:12,fontFamily:"",fontWeight:"",fontItalic:""}),e.layer.drawLine([o.x+i-t,0,o.x+i-t,i],"destination-over",a),g&&!p){var n=C?v.col:(null==m?void 0:m.col)>u.col?u.col:null==m?void 0:m.col,l=C?f.col:(null==m?void 0:m.col)>u.col?null==m?void 0:m.col:u.col;if(m&&o.col>=n&&o.col<=l)e.layer.drawFillRect(o.x+i-t,0,o.width,i,c,"destination-over");else if(o.col!==u.col||u.isMerge)if(u.isMerge){-1!==e.findClickCellRowArr(u).findIndex((function(e){return e===o.col}))&&e.layer.drawFillRect(o.x+i-t,0,o.width,i,c,"destination-over")}else e.layer.drawFillRect(o.x+i-t,0,o.width,i,r,"destination-over");else e.layer.drawFillRect(o.x+i-t,0,o.width,i,c,"destination-over")}else e.layer.drawFillRect(o.x+i-t,0,o.width,i,r,"destination-over");e.layer.drawFillRect(o.x+i-t,0,o.width,i,s,"destination-over")},x=0;x<b.length;x++)S()}},{key:"findClickCellRowArr",value:function(e){for(var t=[],o=e.col+e.mergeCol-1,n=e.col;n<=o;n++)t.push(n);return t}},{key:"searchScreenAddr",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=this.core.components.ContentComponent.contentGroup.filter((function(e){return 1===e.row})),n=0,i=0,l=0,r=0,s=0;s<o.length;s++){var a=o[s];if(i=(n=a.x)+a.width,r=(l=a.y)+a.height,n<=e&&e<=i&&l<=t&&t<=r&&1===a.row)return a}return o[o.length-1]}}]),e}(),I=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;o(this,e),l(this,"options",{}),l(this,"layer",null),l(this,"sideRectGroup",[]),this.options=n,this.layer=t,this.core=i}return i(e,[{key:"initDraw",value:function(){for(var e=this.options,t=e.row,o=e.cellHeight,n=0;n<t;n++){var i=new Konva.Rect({x:0,y:n*o+40,width:o,height:o,fill:"#fff",stroke:"#606266",strokeWidth:1,attrs:{uniPos:"header"+n,exHeaderCell:!0,col:0,row:n,zIndex:99}}),l=new Konva.Text({x:0,y:n*o+40,width:o,height:o,text:n+1,fontSize:20,align:"center",verticalAlign:"middle",fontFamily:"Calibri",fill:"black",attrs:{col:0,row:n,label:n}});i.hide(),l.hide(),this.sideBackGroup.add(i),this.sideTextGroup.add(l)}var r=new Konva.Line({points:[0,0,0,0],stroke:"blue",strokeWidth:1,lineCap:"round",lineJoin:"round"});this.sideBorderGroup.add(r)}},{key:"trendsDraw",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=this.options,n=o.height,i=o.cellHeight,l=this.core.components.ContentComponent,r=l.contentGroup,s=l.clickCell,a=l.clickRectShow,c=l.isColSelect,h=l.secondClickCell,d=l.attrSecond,u=l.attrFirst,g=l.startAndEndRect,p=this.core,m=p.borderCellBgColor;p.selectedBorderBgColor;var f=p.borderColor,v=p.selectedBgColor,C=p.nonSelectBgColor,y=this.searchScreenAddr(0,t),w=this.searchScreenAddr(i,n-i+t),b=r.filter((function(e){return e.row>=y.row&&1===e.col&&e.row<=w.row}));this.sideRectGroup=b,this.layer.clearRect(0,i,i,n),this.layer.drawLine([0,i,0,n],null,f),this.layer.drawLine([i,i,i,n],null,f);for(var S=function(){var o=b[x];if(e.layer.drawText(0,o.y+i-t,o.row,i,o.height,"destination-over",null,null,{fontSize:o.fontSize,fontWeight:o.fontWeight,fontItalic:o.fontItalic,fontFamily:o.fontFamily}),e.layer.drawLine([0,o.y+i-t,i,o.y+i-t],"destination-over",f),a&&!c){var n=g?u.row:(null==h?void 0:h.row)>s.row?s.row:null==h?void 0:h.row,l=g?d.row:(null==h?void 0:h.row)>s.row?null==h?void 0:h.row:s.row;if(h&&o.row>=n&&o.row<=l)e.layer.drawFillRect(0,o.y+i-t,i,o.height,v,"destination-over");else if(s.row!==o.row||s.isMerge)if(s.isMerge){-1!==e.findClickCellRowArr(s).findIndex((function(e){return e===o.row}))&&e.layer.drawFillRect(0,o.y+i-t,i,o.height,v,"destination-over")}else e.layer.drawFillRect(0,o.y+i-t,i,o.height,m,"destination-over");else e.layer.drawFillRect(0,o.y+i-t,i,o.height,v,"destination-over")}else e.layer.drawFillRect(0,o.y+i-t,i,o.height,m,"destination-over");e.layer.drawFillRect(0,o.y+i-t,i,o.height,C,"destination-over")},x=0;x<b.length;x++)S()}},{key:"findClickCellRowArr",value:function(e){for(var t=[],o=e.row+e.mergeRow-1,n=e.row;n<=o;n++)t.push(n);return t}},{key:"searchScreenAddr",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=this.core.components.ContentComponent.contentGroup.filter((function(e){return 1===e.col})),n=0,i=0,l=0,r=0,s=0;s<o.length;s++){var a=o[s];if(i=(n=a.x)+a.width,r=(l=a.y)+a.height,n<=e&&e<=i&&l<=t&&t<=r&&1===a.col)return a}return o[o.length-1]}}]),e}(),A=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;o(this,e),l(this,"selectedCellTopBorderDom",null),l(this,"selectedCellBottomBorderDom",null),l(this,"selectedCellLeftBorderDom",null),l(this,"selectedCellRightBorderDom",null),l(this,"selectedCellWidth",0),l(this,"selectedCellHeight",0),l(this,"canvasDom",null),l(this,"options",{}),l(this,"offsetX",0),l(this,"offsetY",0),l(this,"clickRectShow",!1),l(this,"moveClickCell",null),l(this,"clickCell",null),l(this,"secondClickCell",null),l(this,"isColSelect",!1),l(this,"isRowSelect",!1),l(this,"moreSelectedCell",[]),l(this,"mergeSelectedCell",[]),l(this,"startAndEndRect",null),l(this,"attrFirst",null),l(this,"attrSecond",null),l(this,"layer",null),l(this,"contentGroup",[]),l(this,"moveCell",(function(e){var t=n.options.cellHeight,o=n.core.plugins.ScrollPlugin,i=o.offsetX,l=o.offsetY,r=n.core.plugins.SelectPlugin.searchRectAddr(e.offsetX+i-t,e.offsetY+l-t);n.moveClickCell=r,n.showSelectedCellDom(r.x+t-i,r.y-l+t,r.isMerge?r.mergeWidth:r.width,r.isMerge?r.mergeHeight:r.height)})),l(this,"cellPainterDom",null),l(this,"cellPainterTopBorderDom",null),l(this,"cellPainterBottomBorderDom",null),l(this,"cellPainterLeftBorderDom",null),l(this,"cellPainterRightBorderDom",null),this.options=i,this.layer=t,this.core=r,this.canvasDom=r.canvasDom,this.selectorDom=r.selectorDom,this.canvasWrapperDom=r.canvasWrapperDom,this.registrySelectedCellDom(),this.registryCellPainterDom()}return i(e,[{key:"installContentDataByName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Sheet1",t=this.core.eSheetWorkBook.findIndex((function(t){return t.label===e}));this.contentGroup=this.core.eSheetWorkBook[t].sheet}},{key:"installContentDataByData",value:function(e){this.contentGroup=e}},{key:"showClickRect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.clickCell=e,this.clickRectShow=!0,this.isColSelect=t,this.isRowSelect=o,this.core.ws&&this.core.ws.wsSend(0,e)}},{key:"setSecondClickCell",value:function(e){this.secondClickCell=e}},{key:"hideClickRect",value:function(){this.clickRectShow=!1,this.isColSelect=!1,this.isRowSelect=!1,this.secondClickCell=null,this.clickCell=null,this.moreSelectedCell=[],this.hideSelectedCellDom()}},{key:"drawMulPersonSelected",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.options.cellHeight,i=this.core.getCurrentSheet();this.core.mulPersonSelected.forEach((function(l){if(i.id===l.sheetId){var r=e.searchRectByLabel(l.command.label);if(r.isMerge){var s=r.mergeWidth,a=r.mergeHeight;e.layer.drawStrokeRect(r.x+n-t,r.y-o+n,s,a,l.userColor,"destination-over",2)}else e.layer.drawStrokeRect(r.x+n-t,r.y-o+n,r.width,r.height,l.userColor,"destination-over",2);e.layer.drawText(r.x+n-t+6,r.y-o+n-16,l.userName,r.width,20,"destination-over","#ffffff","left",{},"top"),e.layer.drawFillRect(r.x+n-t,r.y-o+n-20,r.width,20,l.userColor,"destination-over")}}))}},{key:"initDraw",value:function(){for(var e=this.options.col,t=this.options.row,o=this.options.cellWidth,n=this.options.cellHeight,i=0;i<t;i++)for(var l=0;l<e;l++){var r=String.fromCharCode(65+l),s=new Konva.Rect({x:l*o+40,y:i*n+40,width:o,height:n,stroke:"#dcdfe6",strokeWidth:1,listening:!1,attrs:{row:i,col:l,name:r+(i+1)}}),a=new Konva.Text({x:l*o+40,y:i*n+40,width:o,height:n,align:"center",verticalAlign:"middle",padding:6,ellipsis:!0,fontSize:12,fontFamily:"Calibri",fill:"black",attrs:{row:i,col:l,name:r+(i+1)}});s.hide(),a.hide(),this.contentBackGroup.add(s),this.contentTextGroup.add(a)}var c=new Konva.Rect({x:0,y:0,width:0,height:0});this.contentBorderGroup.add(c)}},{key:"showSelectedCellDom",value:function(e,t,o,n){var i,l;o=null!==(i=o)&&void 0!==i?i:this.selectedCellWidth,n=null!==(l=n)&&void 0!==l?l:this.selectedCellHeight,this.selectedCellWidth=o,this.selectedCellHeight=n,t<this.core.cellHeight||e<this.core.cellHeight?this.hideSelectedCellDom():(this.selectedCellTopBorderDom.style.display="block",this.selectedCellTopBorderDom.style.left=e+"px",this.selectedCellTopBorderDom.style.top=t+"px",this.selectedCellTopBorderDom.style.width=o+"px",this.selectedCellBottomBorderDom.style.display="block",this.selectedCellBottomBorderDom.style.left=e+"px",this.selectedCellBottomBorderDom.style.top=t+n-4+"px",this.selectedCellBottomBorderDom.style.width=o+"px",this.selectedCellLeftBorderDom.style.display="block",this.selectedCellLeftBorderDom.style.left=e+"px",this.selectedCellLeftBorderDom.style.top=t+"px",this.selectedCellLeftBorderDom.style.height=n+"px",this.selectedCellRightBorderDom.style.display="block",this.selectedCellRightBorderDom.style.left=e+o-4+"px",this.selectedCellRightBorderDom.style.top=t+"px",this.selectedCellRightBorderDom.style.height=n+"px"),this.showSelectedCellPainterDom(e+o,t+n)}},{key:"setSelectedCellBorderDomBgColor",value:function(e){var t=this.core.selectedBorderBgColor,o=null!=e?e:t;this.selectedCellTopBorderDom.style.backgroundColor=o,this.selectedCellBottomBorderDom.style.backgroundColor=o,this.selectedCellLeftBorderDom.style.backgroundColor=o,this.selectedCellRightBorderDom.style.backgroundColor=o}},{key:"hideSelectedCellDom",value:function(){this.selectedCellTopBorderDom.style.display="none",this.selectedCellBottomBorderDom.style.display="none",this.selectedCellLeftBorderDom.style.display="none",this.selectedCellRightBorderDom.style.display="none",this.cellPainterDom.style.display="none"}},{key:"searchAllCellInMergeCell",value:function(e){if(e||!e.isMerge)return[];for(var t=e.row+e.mergeRow,o=e.col+e.mergeCol,n=[],i=e.row;i<t;i++)for(var l=e.col;l<o;l++)n.push(this.searchRectByColAndRow(l,i));return n}},{key:"initMoreSelectedCell",value:function(){var e=this.moreSelectedCell,t=this.clickCell,o="",n="";if(e.length>0)o=JSON.stringify(e),e.forEach((function(e){e.text="",e.fontColor="",e.bgColor="",e.font="",e.textAlign="",e.mergeWidth=0,e.mergeHeight=0,e.mergeRow=1,e.mergeCol=1,e.isMerge=!1,e.fontSize=12,e.fontFamily=""})),n=JSON.stringify(e);else if(t.isMerge){o=JSON.stringify(this.searchAllCellInMergeCell(t));for(var i=t.row+t.mergeRow,l=t.col+t.mergeCol,r=[],s=t.row;s<i;s++)for(var a=t.col;a<l;a++){var c=this.searchRectByColAndRow(a,s);c.text="",c.fontSize=12,c.fontFamily="",c.fontColor="",c.bgColor="",c.font="",c.textAlign="",c.mergeWidth=0,c.mergeHeight=0,c.mergeRow=1,c.mergeCol=1,c.isMerge=!1,r.push(c)}n=JSON.stringify(r)}else o=JSON.stringify([t]),t.text="",t.fontColor="",t.bgColor="",t.font="",t.textAlign="",t.mergeWidth=0,t.mergeHeight=0,t.mergeRow=1,t.mergeCol=1,t.isMerge=!1,t.fontSize=12,t.fontFamily="",n=JSON.stringify([t]);return{preCellStr:o,lastCellStr:n}}},{key:"searchAllCellsByMoreSelectedCellAndTargetCell",value:function(e,t){var o=[];if(!(t.length>1))return[e];for(var n=t[0],i=t[t.length-1],l=i.col-n.col,r=i.row-n.row,s=e.row,a=e.row+r;s<=a;s++)for(var c=e.col,h=e.col+l;c<=h;c++)o.push(this.searchRectByColAndRow(c,s));return o}},{key:"moveSelectedCellDom",value:function(){var e=this;this.setSelectedCellBorderDomBgColor(),this.canvasDom.onmousemove=function(t){e.moveCell(t)},this.canvasWrapperDom.onmouseup=function(t){if(e.setSelectedCellBorderDomBgColor("transparent"),e.moveClickCell&&!e.moveClickCell.isMerge){var o=e.core.plugins,n=o.SelectPlugin,i=o.SettingPlugin,l=n.transformCanvasCellToTableDomStr(),r=e.initMoreSelectedCell(),s=r.preCellStr,a=r.lastCellStr,c=e.searchAllCellsByMoreSelectedCellAndTargetCell(e.moveClickCell,JSON.parse(s));i.changeStepArr({type:16,pre:{beforeStr:s,lastStr:a},next:{beforeStr:JSON.stringify(c),lastStr:l,label:e.moveClickCell.label}}),e.core.ws.wsSend(16,{pre:a,next:l,label:e.moveClickCell.label}),n.transformTableDomStrToCanvasCell(l,e.moveClickCell),e.setSecondClickCell(null),e.moveClickCell=null,e.canvasDom.onmousemove=null,e.canvasWrapperDom.onmouseup=null}}}},{key:"registrySelectedCellDom",value:function(){var e=this,o=this.core,n=o.h,i=o.canvasWrapperDom,l={onmousedown:function(t){e.moveSelectedCellDom()},oncontextmenu:function(e){e.preventDefault()}},r={left:0,top:0,display:"none"},s=n("div",{attr:t({className:"e-sheet-hor-cell-border"},l),style:t(t({},r),{},{width:0})}),a=n("div",{attr:t({className:"e-sheet-hor-cell-border"},l),style:t(t({},r),{},{width:0})}),c=n("div",{attr:t({className:"e-sheet-ver-cell-border"},l),style:t(t({},r),{},{height:0})}),h=n("div",{attr:t({className:"e-sheet-ver-cell-border"},l),style:t(t({},r),{},{height:0})});this.selectedCellTopBorderDom=s,this.selectedCellBottomBorderDom=a,this.selectedCellLeftBorderDom=c,this.selectedCellRightBorderDom=h,i.appendChild(s),i.appendChild(a),i.appendChild(c),i.appendChild(h)}},{key:"registryCellPainterDom",value:function(){var e=this,t=this.core,o=t.h,n=t.canvasWrapperDom;this.cellPainterDom=o("div",{attr:{className:"e-sheet-cell-painter",onmouseup:function(t){e.canvasDom.onmousemove=null}}}),this.cellPainterTopBorderDom=o("div",{attr:{className:"e-sheet-cell-painter-border",onmouseup:function(t){e.canvasDom.onmousemove=null}},style:{height:"4px",display:"none"}}),this.cellPainterBottomBorderDom=o("div",{attr:{className:"e-sheet-cell-painter-border",onmouseup:function(t){e.canvasDom.onmousemove=null}},style:{height:"4px",display:"none"}}),this.cellPainterLeftBorderDom=o("div",{attr:{className:"e-sheet-cell-painter-border",onmouseup:function(t){e.canvasDom.onmousemove=null}},style:{width:"4px",display:"none"}}),this.cellPainterRightBorderDom=o("div",{attr:{className:"e-sheet-cell-painter-border",onmouseup:function(t){e.canvasDom.onmousemove=null}},style:{width:"4px",display:"none"}}),n.appendChild(this.cellPainterTopBorderDom),n.appendChild(this.cellPainterBottomBorderDom),n.appendChild(this.cellPainterLeftBorderDom),n.appendChild(this.cellPainterRightBorderDom),this.cellPainterDom.oncontextmenu=function(e){e.preventDefault()},this.cellPainterDom.onmousedown=function(t){t.stopImmediatePropagation();var o=parseInt(e.cellPainterDom.style.left),n=parseInt(e.cellPainterDom.style.top),i=0,l=0,r=0,s=0,a=0,c=0,h=null,d=null,u="";e.canvasDom.onmousemove=function(t){var g=e.options.cellHeight,p=e.clickCell,m=e.moreSelectedCell,f=e.core.plugins.ScrollPlugin,v=f.offsetX,C=f.offsetY,y=e.core.plugins.SelectPlugin.searchRectAddr(t.offsetX+v-g,t.offsetY+C-g),w=Math.abs(t.offsetX-o),b=Math.abs(t.offsetY-n);if(m.length>0){var S=m.filter((function(e){return e.row===p.row}));d=S[S.length-1],i=d.col-p.col+1,r=d.x-p.x+d.width;var x=m.filter((function(e){return e.col===p.col}));h=x[x.length-1],l=h.row-p.row+1,s=h.y-p.y+h.height,m[m.length-1]}else p.isMerge?(d=e.searchRectByColAndRow(p.col+p.mergeCol-1,p.row),h=e.searchRectByColAndRow(p.col,p.row+p.mergeRow-1),e.searchRectByLabel(p.mergeEndLabel),r=p.mergeWidth,s=p.mergeHeight):(d=h=p,r=p.width,s=p.height),i=p.mergeCol,l=p.mergeRow;if(t.offsetX>=p.ltX-v&&t.offsetX<=p.ltX-v+r&&t.offsetY>=p.ltY-C&&t.offsetY<=p.ltY-C+s)return e.hidePainterBorderDom(),u=null,e.canvasWrapperDom.onmouseup=null,void(e.canvasDom.onmouseup=null);if(w>b){var k=e.searchRectByColAndRow(y.col,p.row);t.offsetX>o?(u="right",a=Math.ceil(Math.abs(k.col-d.col)/i),e.showPainterBorderDom(p.ltX+r-v,p.ltY-C,r*a,s)):t.offsetX<o&&(u="left",a=Math.ceil(Math.abs(k.col-p.col)/i),e.showPainterBorderDom(p.ltX-r*a-v,p.ltY-C,r*a,s))}else{var D=e.searchRectByColAndRow(p.col,y.row);t.offsetY>n?(u="bottom",c=Math.ceil(Math.abs(D.row-h.row)/l),e.showPainterBorderDom(p.ltX,p.ltY+s-C,r,s*c)):t.offsetY<n&&(u="top",c=Math.ceil(Math.abs(D.row-p.row)/l),e.showPainterBorderDom(p.ltX,p.ltY-s*c-C,r,s*c))}e.canvasWrapperDom.onmouseup=function(t){if(t.stopImmediatePropagation(),null!==u){var o=e.core.plugins,n=o.SelectPlugin,r=o.SettingPlugin,s=n.transformCanvasCellToTableDomStr(),h=[];if("right"===u)for(var d=1;d<=a;d++)h.push(e.searchRectByColAndRow(p.col+d*i,p.row));else if("left"===u)for(var g=1;g<=a;g++)h.push(e.searchRectByColAndRow(p.col-g*i,p.row));else if("bottom"===u)for(var f=1;f<=c;f++)h.push(e.searchRectByColAndRow(p.col,p.row+f*l));else if("top"===u)for(var v=1;v<=c;v++)h.push(e.searchRectByColAndRow(p.col,p.row-v*l));var C=[];h.forEach((function(t){C.push(JSON.stringify(e.searchAllCellsByMoreSelectedCellAndTargetCell(t,m)))}));var y=[];h.forEach((function(e){y.push({tableDomStr:s,label:e.label}),n.transformTableDomStrToCanvasCell(s,e)})),r.changeStepArr({type:17,pre:C,next:y}),e.core.ws.wsSend(17,{next:y}),e.setSecondClickCell(null),e.canvasDom.onmousemove=null,e.canvasWrapperDom.onmouseup=null,e.hidePainterBorderDom()}}}},n.appendChild(this.cellPainterDom)}},{key:"hidePainterBorderDom",value:function(){this.cellPainterTopBorderDom.style.display="none",this.cellPainterBottomBorderDom.style.display="none",this.cellPainterLeftBorderDom.style.display="none",this.cellPainterRightBorderDom.style.display="none"}},{key:"showPainterBorderDom",value:function(e,t,o,n){this.cellPainterTopBorderDom.style.left=e+"px",this.cellPainterTopBorderDom.style.top=t+"px",this.cellPainterTopBorderDom.style.width=o+"px",this.cellPainterTopBorderDom.style.display="block",this.cellPainterBottomBorderDom.style.left=e+"px",this.cellPainterBottomBorderDom.style.top=t+n-4+"px",this.cellPainterBottomBorderDom.style.width=o+"px",this.cellPainterBottomBorderDom.style.display="block",this.cellPainterLeftBorderDom.style.left=e+"px",this.cellPainterLeftBorderDom.style.top=t+"px",this.cellPainterLeftBorderDom.style.height=n+"px",this.cellPainterLeftBorderDom.style.display="block",this.cellPainterRightBorderDom.style.left=e+o-4+"px",this.cellPainterRightBorderDom.style.top=t+"px",this.cellPainterRightBorderDom.style.height=n+"px",this.cellPainterRightBorderDom.style.display="block"}},{key:"showSelectedCellPainterDom",value:function(e,t){t<this.core.cellHeight||e<this.core.cellHeight||e>this.options.width||t>this.options.height?this.cellPainterDom.style.display="none":this.cellPainterDom.style.display="block",this.cellPainterDom.style.left=e-3+"px",this.cellPainterDom.style.top=t-3+"px",this.cellPainterDom.style.cursor="url(".concat(v.crosshair,") 18 18, crosshair")}},{key:"hideCellPainterDom",value:function(){this.cellPainterDom.style.display="none"}},{key:"trendsDraw",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.options,i=n.width,l=n.height,r=n.cellHeight;n.cellWidth;var s=this.core,a=s.nonSelectBgColor,c=s.selectedBorderBgColor,h=s.borderColor,d=s.selectedBgColor,u=s.copyKey,g=this.core.getCurrentSheet().config.textWrapType,p=this.searchScreenAddr(t,o),m=this.searchScreenAddr(t+i-r,o+l-r);this.layer.clearRect(r,r,i,l);var f=this.core.copyCellDash;if(u)if(f.length>1){var v=f[0],C=f[f.length-1];this.layer.drawDashStrokeRect(v.ltX-t+2,v.ltY-o+2,C.ltX-v.ltX+C.width-4,C.ltY-v.ltY+C.height-4,c,"destination-over")}else if(1===f.length){var y=f[0];y.isMerge?this.layer.drawDashStrokeRect(y.ltX-t+2,y.ltY-o+2,y.mergeWidth-4,y.mergeHeight-4,c,"destination-over"):this.layer.drawDashStrokeRect(y.ltX-t+2,y.ltY-o+2,y.width-4,y.height-4,c,"destination-over")}var w=null,b=null,S=null;if(this.secondClickCell){w=this.clickCell;var x=(b=this.secondClickCell).x>w.x,k=b.y>w.y;if(S=x&&!k?this.searchRectIsMerge(w.x,b.y,b.x,w.y,w,b):x&&k?this.searchRectIsMerge(w.x,w.y,b.x,b.y,w,b):!x&&k?this.searchRectIsMerge(b.x,w.y,w.x,b.y,w,b):this.searchRectIsMerge(b.x,b.y,w.x,w.y,w,b),this.startAndEndRect=S,S){var D=[],M=[];S.forEach((function(t){D.push(e.searchRectByLabel(t.mergeStartLabel)),M.push(e.searchRectByLabel(t.mergeEndLabel))}));var I=D.concat([w,b]),A=M.concat([w,b]),B=I.sort((function(e,t){return e.x-t.x}))[0].col,L=I.sort((function(e,t){return e.y-t.y}))[0].row,T=A.sort((function(e,t){return e.x-t.x}))[A.length-1].col,P=A.sort((function(e,t){return e.y-t.y}))[A.length-1].row;w=this.searchRectByColAndRow(B,L),b=this.searchRectByColAndRow(T,P),this.attrFirst=w,this.attrSecond=b}}var R=p.col,N=m.col,Z=p.row,W=m.row,H=this.contentGroup;if(this.clickRectShow)if(this.isColSelect&&!this.isRowSelect)this.layer.drawStrokeRect(this.clickCell.x+r-t,r,this.clickCell.width,this.core.isScrollBottomBound?l-r:l,c,"destination-over",2);else if(this.isRowSelect&&!this.isColSelect)this.layer.drawStrokeRect(r,this.clickCell.y-o+r,this.core.isScrollRightBound?i-r:i,r,c,"destination-over",2);else if(this.isRowSelect&&this.isColSelect)this.layer.drawStrokeRect(r,r,this.core.isScrollRightBound?i-r:i,this.core.isScrollBottomBound?l-r:l,c,"destination-over",2);else if(this.secondClickCell)if(S)S&&(this.layer.drawStrokeRect(w.x+r-t,w.y-o+r,b.x-w.x+b.width,b.y-w.y+b.height,c,"destination-over",2),this.showSelectedCellDom(w.x+r-t,w.y-o+r,b.x-w.x+b.width,b.y-w.y+b.height));else if(this.secondClickCell.x>=this.clickCell.x){var E=this.secondClickCell.y>this.clickCell.y;this.layer.drawStrokeRect(this.clickCell.x+r-t,(E?this.clickCell.y:this.secondClickCell.y)-o+r,this.secondClickCell.x-this.clickCell.x+this.secondClickCell.width,Math.abs(this.secondClickCell.y-this.clickCell.y)+this.secondClickCell.height,c,"destination-over",2),this.showSelectedCellDom(this.clickCell.x+r-t,(E?this.clickCell.y:this.secondClickCell.y)-o+r,this.secondClickCell.x-this.clickCell.x+this.secondClickCell.width,Math.abs(this.secondClickCell.y-this.clickCell.y)+this.secondClickCell.height)}else{var j=this.secondClickCell.y>this.clickCell.y;this.layer.drawStrokeRect(this.secondClickCell.x+r-t,(j?this.clickCell.y:this.secondClickCell.y)-o+r,this.clickCell.x-this.secondClickCell.x+this.clickCell.width,Math.abs(this.secondClickCell.y-this.clickCell.y)+this.secondClickCell.height,c,"destination-over",2),this.showSelectedCellDom(this.secondClickCell.x+r-t,(j?this.clickCell.y:this.secondClickCell.y)-o+r,this.clickCell.x-this.secondClickCell.x+this.clickCell.width,Math.abs(this.secondClickCell.y-this.clickCell.y)+this.secondClickCell.height)}else if(this.clickCell.isMerge){var G=this.clickCell,Y=G.mergeWidth,z=G.mergeHeight;this.layer.drawStrokeRect(this.clickCell.x+r-t,this.clickCell.y-o+r,Y,z,c,"destination-over",2),this.showSelectedCellDom(this.clickCell.x+r-t,this.clickCell.y-o+r,Y,z)}else this.layer.drawStrokeRect(this.clickCell.x+r-t,this.clickCell.y-o+r,this.clickCell.width,this.clickCell.height,c,"destination-over",2),this.showSelectedCellDom(this.clickCell.x+r-t,this.clickCell.y-o+r,this.clickCell.width,this.clickCell.height);this.drawMulPersonSelected(t,o),this.moreSelectedCell=[],this.mergeSelectedCell=[];for(var X=0;X<H.length;X++){var F=H[X],V=F.row,J=F.col,O=F.text,_=F.x,U=F.y,Q=F.width,q=F.height,K=F.img;if(J>=R&&J<=N&&V>=Z&&V<=W)if(F.isMerge)if(F.label===F.mergeStartLabel){var $=F.mergeWidth,ee=F.mergeHeight;this.layer.drawStrokeRect(_-t+r,U-o+r,$,ee,h,"destination-over",1),this.layer.drawText(_-t+r,U-o+r,O,$,ee,"destination-over",F.fontColor,F.textAlign,{fontSize:F.fontsize,fontFamily:F.fontFamily,fontWeight:F.fontWeight,fontItalic:F.fontItalic},F.textBaseline,F.strikethrough,F.underline,g),K.length>0&&0===O.length&&this.layer.drawImage(_-t+r,U-o+r,K,V,J,F.isMerge),this.layer.drawFillRect(_-t+r,U-o+r,$,ee,F.bgColor?F.bgColor:a,"destination-over",1)}else{var te=this.searchRectByLabel(F.mergeStartLabel);te.col>=R&&te.col<=N&&te.row>=Z&&te.row<=W||(this.layer.drawStrokeRect(te.x-t+r,te.y-o+r,te.mergeWidth,te.mergeHeight,h,"destination-over",1),this.layer.drawText(te.x-t+r,te.y-o+r,te.text,te.mergeWidth,te.mergeHeight,"destination-over",te.fontColor,te.textAlign,{fontsize:te.fontSize,fontFamily:te.fontFamily,fontWeight:te.fontWeight,fontItalic:te.fontItalic},te.textBaseline,F.strikethrough,F.underline,g),K.length>0&&0===O.length&&this.layer.drawImage(te.x-t+r,te.y-o+r,K,V,J,F.isMerge),this.layer.drawFillRect(te.x-t+r,te.y-o+r,te.mergeWidth,te.mergeHeight,te.bgColor?te.bgColor:a,"destination-over",1))}else F.isMerge||(this.layer.drawStrokeRect(_-t+r,U-o+r,Q,q,h,"destination-over",1),this.layer.drawText(_-t+r,U-o+r,O,Q,q,"destination-over",F.fontColor,F.textAlign,{fontSize:F.fontSize,fontFamily:F.fontFamily,fontWeight:F.fontWeight,fontItalic:F.fontItalic},F.textBaseline,F.strikethrough,F.underline,g),K.length>0&&0===O.length&&this.layer.drawImage(_-t+r,U-o+r,K,V,J,F.isMerge),this.layer.drawFillRect(_-t+r,U-o+r,Q,q,F.bgColor?F.bgColor:a,"destination-over",1));if(this.secondClickCell){var oe=S?b.col>w.col?w.col:b.col:this.secondClickCell.col>this.clickCell.col?this.clickCell.col:this.secondClickCell.col,ne=S?b.row>w.row?w.row:b.row:this.secondClickCell.row>this.clickCell.row?this.clickCell.row:this.secondClickCell.row,ie=S?b.col>w.col?b.col:w.col:this.secondClickCell.col>this.clickCell.col?this.secondClickCell.col:this.clickCell.col,le=S?b.row>w.row?b.row:w.row:this.secondClickCell.row>this.clickCell.row?this.secondClickCell.row:this.clickCell.row;J>=oe&&J<=ie&&V>=ne&&V<=le&&(this.layer.drawFillRect(_+r-t,U-o+r,Q,q,d,"destination-over"),F.col===this.clickCell.col&&F.row===this.clickCell.row||this.mergeSelectedCell.push(F),this.moreSelectedCell.push(F))}this.isRowSelect&&this.isColSelect&&this.layer.drawFillRect(_-t+r,U-o+r,Q,q,d,"destination-over")}}},{key:"searchScreenAddr",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=this.contentGroup,n=0,i=0,l=0,r=0,s=0;s<o.length;s++){var a=o[s];if(i=(n=a.x)+a.width,r=(l=a.y)+a.height,n<=e&&e<=i&&l<=t&&t<=r)return a}return o[o.length-1]}},{key:"countMergeWidthAndHeight",value:function(e){var t=e.width,o=e.height;return e.mergeLabelGroup.forEach((function(n){e.row===n.row&&(t+=n.width),e.col===n.col&&(o+=n.height)})),{mergeWidth:t,mergeHeight:o}}},{key:"searchRectIsMerge",value:function(e,t,o,n,i,l){var r=this.contentGroup.filter((function(r){return r.x>=e&&r.x<=o&&r.y>=t&&r.y<=n&&r.isMerge&&([i.row,l.row].includes(r.row)||[i.col,l.col].includes(r.col))}));return r.length>0?r:null}},{key:"searchRectByLabel",value:function(e){var t=this.contentGroup,o=t.findIndex((function(t){return t.label===e}));return-1!==o?t[o]:null}},{key:"searchRectByColAndRow",value:function(e,t){var o=this.contentGroup,n=o.findIndex((function(o){return o.col===e&&o.row===t}));return-1!==n?o[n]:null}},{key:"searchRectIndexByColAndRow",value:function(e,t){return this.contentGroup.findIndex((function(o){return o.col===e&&o.row===t}))}},{key:"changeRectTextByLabel",value:function(e){var t=this.searchRectByLabel(e.label);t&&(t.text=e.text)}},{key:"changeRectAttrByLabel",value:function(e,t){var o=this.searchRectByLabel(e.label);o&&(o[t]=e[t])}},{key:"searchRectArrByCol",value:function(e){return this.contentGroup.filter((function(t){return t.col===e}))}},{key:"searchRectArrByRow",value:function(e){return this.contentGroup.filter((function(t){return t.row===e}))}},{key:"isHasMergerInRectArrByCol",value:function(e){return this.searchRectArrByCol(e).some((function(e){return e.isMerge}))}},{key:"isHasMergerInRectArrByRow",value:function(e){return this.searchRectArrByRow(e).some((function(e){return e.isMerge}))}},{key:"initContentGroupRowAndColByCol",value:function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.contentGroup,i=this.options.cellHeight;o?this.core.col+=t:this.core.col-=t;for(var l=this.core.col,r=1,s=0,a=0,c=n.length;a<c;a++){var h=n[a];if((a+1)%l==1&&(r=1,s=0),h.col>=e&&(h.col=r,h.x=s,h.ltX=s+i,h.col>=27?h.label=String.fromCharCode(65+h.col-27)+String.fromCharCode(65+h.col-27)+h.row:h.label=String.fromCharCode(65+h.col-1)+h.row,h.isMerge)){for(var d=0,u=0,g=h.mergeStartLabel.replace(/[0-9]/,""),p=h.mergeEndLabel.replace(/[0-9]/,""),m=h.mergeStartLabel.replace(/[A-Z]/,""),f=h.mergeEndLabel.replace(/[A-Z]/,""),v=0;v<g.length;v++)d+=h.mergeStartLabel.charCodeAt(v)-65+t;for(var C=0;C<p.length;C++)u+=h.mergeEndLabel.charCodeAt(C)-65+t;d>=27?(h.mergeStartLabel=String.fromCharCode(65+d-26)+String.fromCharCode(65+d-26)+m,h.mergeEndLabel=String.fromCharCode(65+u-26)+String.fromCharCode(65+u-26)+f):(h.mergeStartLabel=String.fromCharCode(65+d)+m,h.mergeEndLabel=String.fromCharCode(65+u)+f)}r+=1,s+=h.width}}},{key:"initContentGroupRowAndColByRow",value:function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.contentGroup,i=this.options.cellHeight;o?this.core.row+=t:this.core.row-=t;for(var l=this.core.col,r=0,s=0,a=0,c=0,h=n.length;c<h;c++){var d=n[c];if((c+1)%l==1&&((r+=1)>1&&(s+=d.height),a=0),d.row>=e&&(d.row=r,d.y=s,d.ltY=s+i,d.x=a,d.ltX=a+i,"insert"===d.label?d.col>=27?d.label=String.fromCharCode(65+d.col-27)+String.fromCharCode(65+d.col-27)+d.row:d.label=String.fromCharCode(65+d.col-1)+d.row:d.label=d.label.replace(/[0-9]/,r),d.isMerge)){var u=d.mergeStartLabel.replace(/[0-9]/,""),g=d.mergeEndLabel.replace(/[0-9]/,""),p=parseInt(d.mergeStartLabel.replace(/[A-Z]/,"")),m=parseInt(d.mergeEndLabel.replace(/[A-Z]/,""));d.mergeStartLabel=u+(p+t),d.mergeEndLabel=g+(m+t)}a+=d.width}}}]),e}(),B=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;o(this,e),l(this,"clientHorX",0),l(this,"clientVerY",0),l(this,"recordDeltaY",0),l(this,"barTopDis",0),l(this,"barLeftDis",0),l(this,"wheelStep",10),l(this,"selectorDom",null),l(this,"barVerContainerDom",null),l(this,"barHorContainerDom",null),l(this,"layer",null),l(this,"options",{}),l(this,"components",[]),l(this,"barHeight",10),l(this,"contentComponent",null),l(this,"headerComponent",null),l(this,"sideComponent",null),l(this,"horBarDom",null),l(this,"verBarDom",null),l(this,"core",null),l(this,"leftDis",0),l(this,"topDis",0),l(this,"offsetX",0),l(this,"offsetY",0),this.selectorDom=t,this.canvasWrapperDom=a.canvasWrapperDom,this.layer=n,this.core=a,this.options=r,this.components=s,this.contentComponent=s.ContentComponent,this.headerComponent=s.HeaderComponent,this.sideComponent=s.SideComponent,this.wholeComponent=s.WholeComponent,this.registryHorScroll(),this.registryVerScroll(),document.onmouseup=function(){document.onmousemove=null,i.horBarDom.style.backgroundColor="rgb(201, 201, 201)",i.verBarDom.style.backgroundColor="rgb(201, 201, 201)",i.core.canvasDom.onmousemove=null,i.core.dragSign=!1,i.core.lockDrag=!1}}return i(e,[{key:"contentMoveX",value:function(){this.headerComponent.trendsDraw(this.offsetX),this.contentComponent.trendsDraw(this.offsetX,this.offsetY)}},{key:"contentMoveY",value:function(){this.sideComponent.trendsDraw(this.offsetY),this.contentComponent.trendsDraw(this.offsetX,this.offsetY)}},{key:"registryWheel",value:function(e){var t=this;this.canvasWrapperDom.onmouseover=function(){t.canvasWrapperDom.onwheel=function(e){e.preventDefault(),t.recordDeltaY=Math.abs(t.barTopDis),t.recordDeltaY+=e.deltaY>0?t.wheelStep:-t.wheelStep,requestAnimationFrame((function(){var e=t.recordDeltaY;t.verMoveFunc(e)}))}}}},{key:"unRegistryHorScroll",value:function(){this.barHorContainerDom.remove(),this.horBarDom.remove()}},{key:"changeHorBarWidth",value:function(){var e=(this.options.width-this.options.cellHeight-10)/this.core.sheetWidth;this.horBarDom.style.width=(this.options.width-this.options.cellHeight-10)*e+"px"}},{key:"changeVerBarHeight",value:function(){var e=(this.options.height-this.options.cellHeight-10)/this.core.sheetHeight;this.verBarDom.style.height=(this.options.height-this.options.cellHeight-10)*e+"px"}},{key:"registryHorScroll",value:function(){var e=this,t=document.createElement("div");t.style.height=this.barHeight+"px",t.style.width=this.options.width-this.options.cellHeight-10+"px",t.style.left=this.options.cellHeight+"px",t.style.bottom=0,t.style.position="absolute",this.canvasWrapperDom.appendChild(t),this.barHorContainerDom=t;var o=document.createElement("div");this.horBarDom=o;var n=this.core.sheetWidth>this.options.width?(this.options.width-this.options.cellHeight-10)/this.core.sheetWidth:1;o.style.width=(this.options.width-this.options.cellHeight-10)*n+"px",o.style.height=this.barHeight+"px",o.style.transformOrigin="left",o.style.userSelect="none",o.style.borderRadius=this.barHeight+"px",o.style.backgroundColor="rgb(201, 201, 201)",o.style.transform="translateX(".concat(this.barLeftDis+"px",")"),t.appendChild(o),o.onmouseover=function(e){o.style.backgroundColor="rgb(150, 150, 150)"},o.onmouseleave=function(e){o.style.backgroundColor="rgb(201, 201, 201)"},o.onmousedown=function(t){t.preventDefault(),document.onmousemove=function(n){o.style.backgroundColor="rgb(150, 150, 150)",e.layer.setCursorDefault(),requestAnimationFrame((function(){var o=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,i=n.pageX-o-(e.canvasWrapperDom.getBoundingClientRect().x+e.options.cellHeight)-t.offsetX;e.horMoveFunc(i)}))}}}},{key:"registryVerScroll",value:function(){var e=this,t=document.createElement("div");t.style.height=this.options.height-this.options.cellHeight-10+"px",t.style.width=this.barHeight+"px",t.style.right=0,t.style.top=this.options.cellHeight+"px",t.style.position="absolute",this.canvasWrapperDom.appendChild(t),this.barVerContainerDom=t;var o=document.createElement("div");this.verBarDom=o;var n=this.core.sheetHeight>this.options.height?(this.options.height-this.options.cellHeight-10)/this.core.sheetHeight:1;o.style.width=this.barHeight+"px",o.style.height=(this.options.height-this.options.cellHeight-10)*n+"px",o.style.transformOrigin="top",o.style.userSelect="none",o.style.backgroundColor="rgb(201, 201, 201)",o.style.borderRadius=this.barHeight+"px",o.onmouseover=function(e){o.style.backgroundColor="rgb(150, 150, 150)"},o.onmouseleave=function(e){o.style.backgroundColor="rgb(201, 201, 201)"},t.appendChild(o),this.registryWheel(o),o.onmousedown=function(t){t.preventDefault(),document.onmousemove=function(n){o.style.backgroundColor="rgb(150, 150, 150)",e.layer.setCursorDefault(),requestAnimationFrame((function(){var o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,i=n.pageY-o-(e.canvasWrapperDom.getBoundingClientRect().y+e.options.cellHeight)-t.offsetY;e.verMoveFunc(i)}))}}}},{key:"horMoveFunc",value:function(e){this.core.plugins.InputPlugin.hideInput();var t=this.core.sheetWidth>this.options.width?(this.options.width-this.options.cellHeight-10)/this.core.sheetWidth:1,o=1===t?0:this.options.width-this.options.cellHeight-10-(this.options.width-this.options.cellHeight)*t;e<=0?(this.horBarDom.style.transform="translateX(0px)",this.barLeftDis=0,this.leftDis=0,this.core.isScrollRightBound=!1):e>=o?(this.horBarDom.style.transform="translateX(".concat(o+"px",")"),this.barLeftDis=o,this.leftDis=-(this.core.sheetWidth-(this.options.width-this.options.cellHeight)),this.core.isScrollRightBound=!0):(this.horBarDom.style.transform="translateX(".concat(e+"px",")"),this.barLeftDis=Math.abs(e),this.leftDis=-e/t,this.core.offsetXLock=!1,this.core.isScrollRightBound=!1),this.core.offsetXLock||(1!==t&&(this.offsetX=Math.abs(this.leftDis),this.contentMoveX()),(e<=0||e>=o)&&(this.core.offsetXLock=!0))}},{key:"verMoveFunc",value:function(e){this.core.plugins.InputPlugin.hideInput();var t=this.core.sheetHeight>this.options.height?(this.options.height-this.options.cellHeight-10)/this.core.sheetHeight:1,o=1===t?0:this.options.height-this.options.cellHeight-10-(this.options.height-this.options.cellHeight)*t;e<=0?(this.verBarDom.style.transform="translateY(0px)",this.barTopDis=0,this.topDis=0,this.core.isScrollBottomBound=!1):e>=o?(this.verBarDom.style.transform="translateY(".concat(o+"px",")"),this.barTopDis=o,this.topDis=-(this.core.sheetHeight-(this.options.height-this.options.cellHeight)),this.core.isScrollBottomBound=!0):(this.verBarDom.style.transform="translateY(".concat(e+"px",")"),this.barTopDis=e,this.topDis=-e/t,this.core.offsetYLock=!1,this.core.isScrollBottomBound=!1),this.core.offsetYLock||(1!==t&&(this.offsetY=Math.abs(this.topDis),this.contentMoveY()),(e<=0||e>=o)&&(this.core.offsetYLock=!0))}}]),e}(),L=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;o(this,e),l(this,"options",{}),l(this,"core",null),l(this,"selectorDom",null),l(this,"contentComponent",null),l(this,"headerComponent",null),l(this,"sideBorderLine",null),l(this,"dblClickContext",null),l(this,"clickContext",null),l(this,"inputDom",null),l(this,"rectContext",null),l(this,"headerBorderLine",null),this.contentComponent=s.ContentComponent,this.headerComponent=s.HeaderComponent,this.sideComponent=s.SideComponent,this.wholeComponent=s.WholeComponent,this.selectorDom=t,this.canvasDom=a.canvasDom,this.canvasWrapperDom=a.canvasWrapperDom,this.options=r,this.layer=n,this.core=a,this.appendInput(),a.plugins.ScrollPlugin.horBarDom.addEventListener("mousedown",(function(){i.inputDom.style.display="none"})),a.plugins.ScrollPlugin.verBarDom.addEventListener("mousedown",(function(){i.inputDom.style.display="none"}))}return i(e,[{key:"hideInput",value:function(){this.inputDom.style.display="none",this.inputDom.value="",this.inputDom.oninput=null}},{key:"setCellText",value:function(){this.contentComponent.clickCell.text=this.inputDom.value}},{key:"showInput",value:function(e){var t=this,o=this.inputDom,n=this.core.plugins.ScrollPlugin,i=n.offsetX,l=n.offsetY,r=this.options.cellHeight,s=e.x,a=e.y,c=e.width,h=e.height,d=e.text,u=e.isMerge,g=e.mergeWidth,p=e.mergeHeight,m=e.bgColor,f=e.fontColor,v=d.length*this.core.fontSize,C=u?g:c;o.style.opacity=1,o.style.top=a+r-l+"px",o.style.left=s+r-i+"px",o.style.display="inline-block",o.style.textAlign="center",o.style.width=(C>v?C:v)+"px",o.style.height=(u?p:h)+"px",o.style.borderRadius="6px",o.style.backgroundColor=null!=m?m:"",o.style.color=null!=f?f:"",o.value=d,o.oninput=function(e){t.core.plugins.SettingPlugin.setCellCon(e.target.value)},this.contentComponent.hideCellPainterDom()}},{key:"appendInput",value:function(){var e=this,o=document.createElement("textarea");this.inputDom=o,o.style.display="none",o.style.position="absolute",o.style.outline="none",o.style.border="2px solid "+this.core.selectedBorderBgColor,o.style.boxSizing="border-box",this.canvasWrapperDom.appendChild(o),this.canvasDom.addEventListener("dblclick",(function(n){e.contentComponent.hideSelectedCellDom();var i=e.options.cellHeight;if(!(n.offsetX<=i||n.offsetY<=i)){e.core.plugins.SelectPlugin.clearCopyDash();var l=e.core.plugins.ScrollPlugin,r=l.offsetX,s=l.offsetY,a=e.contentComponent.clickCell,c=a.x,h=a.y,d=a.width,u=a.height,g=a.text,m=a.isMerge,f=a.mergeWidth,v=a.mergeHeight,C=a.bgColor,y=a.fontColor;e.core.fresh();var w=m?f:d,b=g.length*e.core.fontSize;o.style.opacity=1,o.style.top=h+i-s+"px",o.style.left=c+i-r+"px",o.style.display="inline-block",o.style.textAlign="center",o.style.width=(w>b?w:b)+"px",o.style.height=(m?v:u)+"px",o.style.borderRadius="6px",o.style.backgroundColor=null!=C?C:"",o.style.color=null!=y?y:"",o.value=g,o.focus(),o.onblur=function(n){if(void 0!==o.value&&null!==o.value){var i=0,l=0;if(!n.relatedTarget||!e.selectorDom.contains(n.relatedTarget)){var r=e.core.getCurrentSheet(),s=o.value;if(s.includes("\n")&&"wrap"===r.config.textWrapType){var c=s.split("\n"),h=c.length*a.fontSize;h>a.height&&(l=h-a.height,e.core.plugins.DragPlugin.expandHeightNoDrag(a.row,l,!1));var d=Math.max.apply(Math,p(c.map((function(e){return e.length}))))*a.fontSize;d>a.width&&(i=d-a.width,e.core.plugins.DragPlugin.expandWidthNoDrag(a.col,i,!1))}e.core.plugins.SettingPlugin.changeStepArr({type:1,label:a.label,pre:a.text,next:o.value,widthDis:i,heightDis:l})}a.text=o.value,e.core.fresh(),e.core.ws.wsSend(1,t(t({},a),{},{widthDis:i,heightDis:l})),e.inputDom.value="",e.hideInput()}else e.hideInput()},o.oninput=function(t){e.core.plugins.SettingPlugin.setCellCon(t.target.value)},e.contentComponent.hideCellPainterDom()}}))}}]),e}(),T=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;o(this,e),l(this,"options",{}),l(this,"core",null),l(this,"selectorDom",null),l(this,"contentComponent",null),l(this,"headerComponent",null),l(this,"sideBorderLine",null),l(this,"clickContext",null),l(this,"inputDom",null),l(this,"copyKey",["text","mergeWidth","mergeHeight","mergeRow","mergeCol","isMerge","bgColor","fontColor"]),l(this,"moreShiftSelectClick",(function(e){if(i.core.shiftKey){var t=i.options.cellHeight,o=i.core.plugins.ScrollPlugin,n=o.offsetX,l=o.offsetY,r=i.contentComponent.clickCell,s=i.searchRectAddr(e.offsetX+n-t,e.offsetY+l-t);if(s.isMerge){var a=s.x>r.x,c=s.y>r.y;a&&!c?s=i.searchRectByColAndRow(s.col+s.mergeCol-1,s.row):a&&c?s=i.searchRectByColAndRow(s.col+s.mergeCol-1,s.row+s.mergeRow-1):!a&&c&&(s=i.searchRectByColAndRow(s.col,s.row+s.mergeRow-1))}i.contentComponent.setSecondClickCell(s),i.core.fresh()}})),l(this,"moreCtrlSelectClick",(function(e){if(i.core.shiftKey){var t=i.options.cellHeight,o=i.core.plugins.ScrollPlugin,n=o.offsetX,l=o.offsetY,r=i.searchRectAddr(e.offsetX+n-t,e.offsetY+l-t);i.contentComponent.setSecondClickCell(r),i.core.fresh()}})),this.contentComponent=s.ContentComponent,this.headerComponent=s.HeaderComponent,this.sideComponent=s.SideComponent,this.selectorDom=t,this.canvasDom=a.canvasDom,this.settingPlugin=a.plugins.SettingPlugin,this.options=r,this.layer=n,this.core=a,this.showClickHandler(),this.moreSelect(),this.displayColTextRegister()}return i(e,[{key:"searchRectIsMergeInTwoCell",value:function(e,t){var o=this.contentComponent.contentGroup;return null===t?e.isMerge:o.filter((function(o){return o.col>=e.col&&o.row>=e.row&&o.col<=t.col&&o.row<=t.row})).some((function(e){return e.isMerge}))}},{key:"displayAllTextByCol",value:function(e,t){var o=this,n=this.options.cellHeight,i=this.contentComponent.contentGroup.filter((function(t){return t.col===e})).map((function(e){return o.layer.ctx.measureText(e.text).width+n}));i.push(t);var l=i.sort((function(e,t){return e-t}))[i.length-1];this.core.plugins.DragPlugin.expandWidthNoDrag(e,l-t)}},{key:"displayColTextRegister",value:function(){var e=this;this.canvasDom.addEventListener("dblclick",(function(t){var o=e.options.cellHeight,n=e.core.plugins.ScrollPlugin,i=n.offsetX;n.offsetY;var l=t.offsetX+i;if(t.offsetY<=o){for(var r=null,s=e.headerComponent.headerRectGroup,a=0;a<s.length;a++){var c=s[a];if(l>c.ltX&&l<c.ltX+c.width){r=c;break}}e.displayAllTextByCol(r.col,r.width)}}))}},{key:"copyText",value:function(e){navigator.clipboard&&navigator.clipboard.writeText(e)}},{key:"searchMergeArr",value:function(e,t,o,n){var i=[];return this.contentComponent.contentGroup.forEach((function(l){l.col>=e&&l.col<=o&&l.row>=t&&l.row<=n&&i.push(l)})),i.splice(1,i.length)}},{key:"copyRect",value:function(e,t){var o=e.width,n=e.height,i=this.searchMergeArr(e.col,e.row,e.col+t.mergeCol-1,e.row+t.mergeRow-1);e.mergeEndLabel=i[i.length-1].label,e.mergeStartLabel=e.label,e.isMerge=!0,i.forEach((function(t){t.isMerge=!0,t.mergeStartLabel=e.label,t.mergeEndLabel=i[i.length-1].label,e.row===t.row&&e.label!==t.label&&(o+=t.width),e.col===t.col&&e.label!==t.label&&(n+=t.height)})),e.mergeWidth=o,e.mergeHeight=n}},{key:"setCellAttr",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["row","col","x","y","ltX","ltY","mergeStartLabel","mergeEndLabel","label","isFromExcel","width","height"];for(var n in t)o.includes(n)||(e[n]=t[n]);t.isMerge&&(e.mergeStartLabel=String.fromCharCode(65+e.col-1)+e.row,e.mergeEndLabel=String.fromCharCode(65+e.col+e.mergeCol-2)+(e.row+e.mergeRow-1))}},{key:"copyCellAttr",value:function(e,t){for(var o in t)e[o]=t[o]}},{key:"tableDomToArr",value:function(e){for(var t=[],o=e.querySelectorAll("tr"),n=0;n<o.length;n++){t[n]=[];for(var i=o[n].querySelectorAll("td"),l=0;l<i.length;l++)t[n].push(i[l])}return t}},{key:"transformTableDomStrToDom",value:function(e){var t=this.core.h,o=(new DOMParser).parseFromString(e,"text/html");!o.querySelector("style")||o.querySelector("style").sheet.cssRules;var n=o.querySelector("table");if(!n)return null;for(var i=this.tableDomToArr(n),l=t("td"),r=function(e){for(var t=i[e],o=function(o){var n=t[o];if(n||i[e].push(l.cloneNode()),n.rowSpan>1)for(var r=1,s=n.rowSpan;r<s;r++)i[e+r].splice(o,0,l.cloneNode());n.colSpan>1&&new Array(n.colSpan-1).fill(0).forEach((function(t){i[e].splice(o+1,0,l.cloneNode())}))},n=0;n<t.length;n++)o(n)},s=0;s<i.length;s++)r(s);return i}},{key:"transformTableDomStrToCanvasCell",value:function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.core.h,i=(new DOMParser).parseFromString(e,"text/html"),l=i.querySelector("style")?i.querySelector("style").sheet.cssRules:[],r=i.querySelector("table");if(r){for(var s=r.querySelectorAll("tr"),a=this.tableDomToArr(r),c=n("td"),h=function(e){for(var t=a[e],o=function(o){var n=t[o];if(n||a[e].push(c.cloneNode()),n.rowSpan>1)for(var i=1,l=n.rowSpan;i<l;i++)a[e+i].splice(o,0,c.cloneNode());n.colSpan>1&&new Array(n.colSpan-1).fill(0).forEach((function(t){a[e].splice(o+1,0,c.cloneNode())}))},n=0;n<t.length;n++)o(n)},d=0;d<a.length;d++)h(d);a.length;for(var u=0;u<a.length;u++)for(var g=a[u],p=0;p<g.length;p++){var m=g[p],f={};if(g[p].getAttribute("data-json"))f=JSON.parse(g[p].getAttribute("data-json"));else{for(var v,C,y="",w="",b=null,S="",x=0,k=l.length;x<k;x++)m.className===l[x].selectorText.replace(".","")&&(y=""!==l[x].style.backgroundColor?l[x].style.backgroundColor:null,w=""!==l[x].style.color?l[x].style.color:null,""===l[x].style.textAlign||l[x].style.textAlign,b=""!==l[x].style.fontSize?l[x].style.fontSize.replace("pt",""):12,S=""!==l[x].style.fontFamily?l[x].style.fontFamily:null);C=b+" "+S,f={mergeRow:m.rowSpan>1?m.rowSpan:m.colSpan>1?1:0,mergeCol:m.colSpan>1?m.colSpan:m.rowSpan>1?1:0,isMerge:m.colSpan&&m.colSpan>1||m.rowSpan&&m.rowSpan>1,text:m.innerText,isFromExcel:!0,bgColor:y,fontColor:w,font:C,fontSize:null!==(v=b)&&void 0!==v?v:12,fontFamily:S}}var D=this.searchRectByColAndRow(t.col+p,t.row+u);if(u===s.length-1&&g.length,f.isMerge)for(var M=D.row+f.mergeRow,I=D.col+f.mergeCol,A=D.row;A<M;A++)for(var B=D.col;B<I;B++)if(A===D.row&&B===D.col)this.setCellAttr(D,f),f.isFromExcel&&(D.mergeWidth=D.width,D.mergeHeight=D.height);else{var L=this.searchRectByColAndRow(B,A);L.isMerge=!0,L.mergeStartLabel=D.mergeStartLabel,L.mergeEndLabel=D.mergeEndLabel,f.isFromExcel&&(L.col===D.col&&(D.mergeHeight+=L.height),L.row===D.row&&(D.mergeWidth+=L.width))}else D.isMerge||this.setCellAttr(D,f)}o&&this.contentComponent.showClickRect(t),this.core.fresh()}}},{key:"transformCanvasCellToTableDomStr",value:function(){var e=this.contentComponent,t=e.clickCell,o=e.secondClickCell,n=e.clickRectShow,i=e.moreSelectedCell,l=this.core.h;if(n){var r=l("table"),s=l("tr"),a=l("td");if(t&&!o)if(t.isMerge)for(var c=t.row+t.mergeRow,h=t.row;h<c;h++){var d=s.cloneNode();if(h===t.row){var u=a.cloneNode();this.setTdAttrs(u,t),d.appendChild(u)}r.appendChild(d)}else{var g=s.cloneNode(),p=a.cloneNode();this.setTdAttrs(p,t),g.appendChild(p),r.appendChild(g)}else if(o)for(var m=0,f=null,v=0;v<i.length;v++){var C=i[v];if(m!==C.row&&(m=C.row,f=s.cloneNode(),r.appendChild(f)),C.isMerge&&C.label===C.mergeStartLabel||!C.isMerge){var y=a.cloneNode();this.setTdAttrs(y,C),f.appendChild(y)}}var w=r.outerHTML;return s.remove(),a.remove(),w}}},{key:"transformCanvasCellToTableDomStrByParams",value:function(e,t,o,n){var i=this.core.h;if(o){var l=i("table"),r=i("tr"),s=i("td");if(e&&!t)if(e.isMerge)for(var a=e.row+e.mergeRow,c=e.row;c<a;c++){var h=r.cloneNode();if(c===e.row){var d=s.cloneNode();this.setTdAttrs(d,e),h.appendChild(d)}l.appendChild(h)}else{var u=r.cloneNode(),g=s.cloneNode();this.setTdAttrs(g,e),u.appendChild(g),l.appendChild(u)}else if(t)for(var p=0,m=null,f=0;f<n.length;f++){var v=n[f];if(p!==v.row&&(p=v.row,m=r.cloneNode(),l.appendChild(m)),v.isMerge&&v.label===v.mergeStartLabel||!v.isMerge){var C=s.cloneNode();this.setTdAttrs(C,v),m.appendChild(C)}}var y=l.outerHTML;return r.remove(),s.remove(),y}}},{key:"searchPastePositionCells",value:function(e,t,o){for(var n=[],i=e+o.col,l=t+o.row,r=o.row;r<=l;r++)for(var s=o.col;s<=i;s++)n.push(this.contentComponent.searchRectByColAndRow(s,r));return n}},{key:"forcePasteCellToNewCell",value:function(e){var t=this;e.forEach((function(e){var o=t.contentComponent.searchRectByLabel(e.label);t.copyCellAttr(o,e)}))}},{key:"forcePasteCellToNewCellByTargetCell",value:function(e,t){var o=this,n=e[0];e.forEach((function(e){var i=o.contentComponent.searchRectByColAndRow(e.col-n.col+t.col,e.row-n.row+t.row);o.copyCellAttr(i,e)}))}},{key:"clearCopyDash",value:function(){this.copyText(""),this.core.copyKey=!1,this.core.copyCellDash=[],this.core.freshContent()}},{key:"moreSelect",value:function(){var e=this;document.addEventListener("paste",(function(t){var o=e.contentComponent,n=o.clickRectShow,i=o.clickCell,l=t.clipboardData.getData("text/html"),r=e.transformTableDomStrToDom(l);if(Array.isArray(r)&&!r[0][0].getAttribute("data-json")){var s,a=r.length,c=r[0].length;return s=JSON.stringify(e.searchPastePositionCells(c-1,a-1,i)),e.core.plugins.SettingPlugin.changeStepArr({type:15,pre:{label:i.label,pasteStr:s},next:{label:i.label,pasteStr:l}}),e.core.ws.wsSend(15,{pasteStr:l,label:i.label}),e.transformTableDomStrToCanvasCell(l,i),void e.contentComponent.setSecondClickCell(null)}if(1===e.core.copyCellDash.length){if(e.searchRectIsMergeInTwoCell(i,null))return void e.settingPlugin.showDialog("提示","合并的单元格无法粘贴内容");var h=e.core.copyCellDash[0];if(h.isMerge){var d=e.contentComponent.searchRectByColAndRow(i.col+h.mergeCol-1,i.row+h.mergeRow-1);if(e.searchRectIsMergeInTwoCell(i,d))return void e.settingPlugin.showDialog("提示","合并的单元格无法粘贴内容")}}else if(e.core.copyCellDash.length>1){var u=e.core.copyCellDash[0],g=e.core.copyCellDash[e.core.copyCellDash.length-1],p=e.contentComponent.searchRectByColAndRow(i.col+g.col-u.col,i.row+g.row-u.row);if(e.searchRectIsMergeInTwoCell(i,p))return void e.settingPlugin.showDialog("提示","合并的单元格无法粘贴内容")}if(n&&e.core.copyCellDash.length>0){var m="",f=e.core.copyCellDash[0],v=e.core.copyCellDash[e.core.copyCellDash.length-1];m=1===e.core.copyCellDash.length?JSON.stringify(e.searchPastePositionCells(f.mergeCol-1,f.mergeRow-1,i)):JSON.stringify(e.searchPastePositionCells(v.col-f.col,v.row-f.row,i)),e.core.plugins.SettingPlugin.changeStepArr({type:15,pre:{label:i.label,pasteStr:m},next:{label:i.label,pasteStr:l}}),e.core.ws.wsSend(15,{pasteStr:l,label:i.label}),e.transformTableDomStrToCanvasCell(l,i),e.contentComponent.setSecondClickCell(null)}})),document.addEventListener("copy",(function(t){t.preventDefault(),e.core.copyCellDash=[];var o=e.transformCanvasCellToTableDomStr();t.clipboardData.setData("text/html",o);var n=e.contentComponent,i=n.clickCell,l=n.moreSelectedCell;if(e.core.copyKey=!0,l.length>0)e.core.copyCellDash=l;else{if(!i)return;e.core.copyCellDash=[i]}e.core.freshContent()})),document.addEventListener("keydown",(function(t){if(e.core.shiftKey=t.shiftKey,e.core.ctrlKey=t.ctrlKey,"Escape"===t.code)e.clearCopyDash();else if("Delete"===t.code){var o=[];e.contentComponent.secondClickCell?(o=e.contentComponent.moreSelectedCell.map((function(e){return{row:e.row,col:e.col,text:e.text,label:e.label}})),e.contentComponent.moreSelectedCell.forEach((function(e){e.text=""})),e.core.freshContent()):e.contentComponent.clickCell&&(o.push({row:e.contentComponent.clickCell.row,col:e.contentComponent.clickCell.col,text:e.contentComponent.clickCell.text,label:e.contentComponent.clickCell.label}),e.contentComponent.clickCell.text="",e.core.freshContent()),e.core.plugins.SettingPlugin.changeStepArr({type:20,cells:o}),e.core.ws.wsSend(20,{cells:o})}})),document.addEventListener("keyup",(function(t){e.core.shiftKey=t.shiftKey,e.core.ctrlKey=t.ctrlKey})),this.canvasDom.addEventListener("mousedown",this.moreShiftSelectClick)}},{key:"setTdAttrs",value:function(e,t){t.isMerge&&(e.rowSpan=t.mergeRow,e.colSpan=t.mergeCol),e.innerText=t.text,e.style.backgroundColor=t.bgColor,e.style.color=t.fontColor,e.style.width=t.width+"px",e.style.height=t.height+"px",e.style.textAlign=t.textAlign,e.setAttribute("data-json",JSON.stringify(t))}},{key:"showClickHandler",value:function(){var e=this;this.canvasDom.addEventListener("mousedown",(function(t){if(!(2===t.button&&e.contentComponent.secondClickCell||(e.core.plugins.ContextmenuPlugin.hideContextMenu(),e.core.plugins.BookPlugin.hideContextMenu(),e.core.shiftKey||e.core.ctrlKey||e.core.dragSign))){var o=e.options,n=o.cellHeight;o.cellWidth;var i=e.core.plugins.ScrollPlugin,l=i.offsetX,r=i.offsetY;if(i.topDis,i.barVerContainerDom,i.barHorContainerDom,t.offsetY<=n&&t.offsetX<=n)e.contentComponent.setSecondClickCell(null),e.contentComponent.showClickRect({},!0,!0),e.contentComponent.hideSelectedCellDom();else if(t.offsetY<=n&&t.offsetX>n){var s=e.searchHeaderRectAddr(t.offsetX+l-n);s&&(e.contentComponent.setSecondClickCell(null),e.contentComponent.showClickRect(s,!0)),e.contentComponent.hideSelectedCellDom()}else if(t.offsetY>n&&t.offsetX<=n){var a=e.searchSideRectAddr(t.offsetY+r-n);a&&(e.contentComponent.setSecondClickCell(null),e.contentComponent.showClickRect(a,!1,!0)),e.contentComponent.hideSelectedCellDom()}else{var c=e.searchRectAddr(t.offsetX+l-n,t.offsetY+r-n);c&&(e.contentComponent.showClickRect(c),e.core.plugins.SettingPlugin.setCellAttrInHeader(c),e.contentComponent.setSecondClickCell(null),e.canvasDom.onmousemove=function(t){var o,i=e.core.plugins.ScrollPlugin,l=i.offsetX,r=i.offsetY,s=e.searchRectAddr(t.offsetX+l-n,t.offsetY+r-n);if(s&&c.label===s.label)e.contentComponent.setSecondClickCell(null);else if(s&&s.label!==(null===(o=e.contentComponent.secondClickCell)||void 0===o?void 0:o.label)){var a=s.x>c.x,h=s.y>c.y;s.isMerge&&(a&&!h?s=e.searchRectByColAndRow(s.col+s.mergeCol-1,s.row):a&&h?s=e.searchRectByColAndRow(s.col+s.mergeCol-1,s.row+s.mergeRow-1):!a&&h&&(s=e.searchRectByColAndRow(s.col,s.row+s.mergeRow-1))),e.contentComponent.setSecondClickCell(s),e.core.fresh()}})}e.core.fresh()}}))}},{key:"searchRectIsMerge",value:function(e,t,o,n){var i=this.contentComponent.contentGroup.find((function(i){return i.x>=e&&i.x<=o&&i.y>=t&&i.y<=n&&i.isMerge}));return i?{startRect:this.searchRectByLabel(i.mergeStartLabel),endRect:this.searchRectByLabel(i.mergeEndLabel)}:null}},{key:"searchRectByLabel",value:function(e){var t=this.contentComponent.contentGroup,o=t.findIndex((function(t){return t.label===e}));return-1!==o?t[o]:null}},{key:"searchRectByColAndRow",value:function(e,t){var o=this.contentComponent.contentGroup,n=o.findIndex((function(o){return o.col===e&&o.row===t}));return-1!==n?o[n]:null}},{key:"searchRectAddr",value:function(e,t){for(var o,n=this.contentComponent.contentGroup,i=function(){var o=n[l];if(e>=o.x&&e<=o.x+o.width&&t>=o.y&&t<=o.y+o.height){if(o.isMerge){if(o.label===o.mergeStartLabel)return{v:o};var i=n.findIndex((function(e){return e.label===o.mergeStartLabel}));return{v:n[i]}}return{v:o}}},l=0;l<n.length;l++)if(o=i())return o.v}},{key:"searchHeaderRectAddr",value:function(e){for(var t=this.headerComponent.headerRectGroup,o=0;o<t.length;o++){var n=t[o];if(e>=n.x&&e<=n.x+n.width)return n}}},{key:"searchSideRectAddr",value:function(e){for(var t=this.sideComponent.sideRectGroup,o=0;o<t.length;o++){var n=t[o];if(e>=n.y&&e<=n.y+n.height)return n}}}]),e}(),P=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0;o(this,e),l(this,"dragShowDis",6),l(this,"dragCell",null),l(this,"stepObj",{}),this.contentComponent=r.ContentComponent,this.headerComponent=r.HeaderComponent,this.sideComponent=r.SideComponent,this.selectorDom=t,this.canvasDom=s.canvasDom,this.options=i,this.layer=n,this.core=s,this.registerDragEvent()}return i(e,[{key:"expandWidthNoDrag",value:function(e,t){for(var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.contentComponent.contentGroup,i=0;i<n.length;i++){var l=n[i];if(!(l.col<e)&&(l.col===e?l.width+=t:l.col>e&&(l.x+=t,l.ltX+=t),l.col===e&&1===l.row&&(this.core.sheetWidth+=t),l.isMerge&&l.mergeStartLabel===l.label&&l.col===e&&(l.mergeWidth+=t),l.isMerge&&l.mergeStartLabel!==l.label&&l.col===e)){var r=this.contentComponent.searchRectByLabel(l.mergeStartLabel);r.row===l.row&&(r.mergeWidth+=t)}}this.core.freshScrollBar(),o&&this.core.fresh()}},{key:"expandHeightNoDrag",value:function(e,t){for(var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.contentComponent.contentGroup,i=0;i<n.length;i++){var l=n[i];if(l.row===e?l.height+=t:l.row>e&&(l.y+=t,l.ltY+=t),l.row===e&&1===l.col&&(this.core.sheetHeight+=t),l.isMerge&&l.mergeStartLabel===l.label&&l.row===e&&(l.mergeHeight+=t),l.isMerge&&l.mergeStartLabel!==l.label&&l.row===e){var r=this.contentComponent.searchRectByLabel(l.mergeStartLabel);r.col===l.col&&(r.mergeHeight+=t)}}this.core.freshScrollBar(),o&&this.core.fresh()}},{key:"expandWidth",value:function(e,t){var o=this.contentComponent.contentGroup,n=this.options.cellHeight;if(this.layer.setCursor("col-resize"),!this.dragCell||this.dragCell.width+t<n&&t<0)return this.stepObj.next={width:n},void(this.dragCell=null);for(var i=0;i<o.length;i++){var l=o[i];if(!(l.col<e)&&(l.col===e?l.width+=t:l.col>e&&(l.x+=t,l.ltX+=t),l.col===e&&1===l.row&&(this.core.sheetWidth+=t),l.isMerge&&l.mergeStartLabel===l.label&&l.col===e&&(l.mergeWidth+=t),l.isMerge&&l.mergeStartLabel!==l.label&&l.col===e)){var r=this.contentComponent.searchRectByLabel(l.mergeStartLabel);r.row===l.row&&(r.mergeWidth+=t)}}this.core.freshScrollBar(),this.core.fresh()}},{key:"expandHeight",value:function(e,t){var o=this.contentComponent.contentGroup,n=this.options.cellHeight;if(this.layer.setCursor("col-resize"),!this.dragCell||this.dragCell.height+t<n&&t<0)return this.stepObj.next={height:n},void(this.dragCell=null);for(var i=0;i<o.length;i++){var l=o[i];if(l.row===e?l.height+=t:l.row>e&&(l.y+=t,l.ltY+=t),l.row===e&&1===l.col&&(this.core.sheetHeight+=t),l.isMerge&&l.mergeStartLabel===l.label&&l.row===e&&(l.mergeHeight+=t),l.isMerge&&l.mergeStartLabel!==l.label&&l.row===e){var r=this.contentComponent.searchRectByLabel(l.mergeStartLabel);r.col===l.col&&(r.mergeHeight+=t)}}this.core.freshScrollBar(),this.core.fresh()}},{key:"registerDragEvent",value:function(){var e=this;this.canvasDom.addEventListener("mouseup",(function(o){if(e.core.lockDrag=!1,e.dragCell){e.stepObj.next={width:e.dragCell.width,height:e.dragCell.height};var n=0;11===e.stepObj.type&&(n=e.stepObj.next.width-e.stepObj.pre.width),12===e.stepObj.type&&(n=e.stepObj.next.height-e.stepObj.pre.height),e.core.plugins.SettingPlugin.changeStepArr(JSON.parse(JSON.stringify(e.stepObj))),e.core.ws.wsSend(e.stepObj.type,t({dis:n},e.stepObj))}})),this.canvasDom.addEventListener("mousedown",(function(t){if(e.core.lockDrag=!0,e.dragCell&&e.core.dragSign){e.stepObj.pre={},e.stepObj.label=e.dragCell.label,e.stepObj.pre.width=e.dragCell.width,e.stepObj.pre.height=e.dragCell.height;var o=0,n=t.pageX,i=0,l=t.pageY;e.canvasDom.onmousemove=function(t){if(!e.dragCell)return!1;e.core.dragSignDirectionIsHor?(o=t.pageX,e.stepObj.type=11,e.expandWidth(e.dragCell.col,o-n),n=o):(i=t.pageY,e.stepObj.type=12,e.expandHeight(e.dragCell.row,i-l),l=i)}}})),this.canvasDom.addEventListener("mousemove",(function(t){if(e.core.lockDrag)return!1;var o=e.headerComponent.headerRectGroup,n=e.sideComponent.sideRectGroup,i=e.core.plugins.ScrollPlugin,l=i.offsetX,r=i.offsetY,s=e.options.cellHeight,a=e.dragShowDis,c=t.offsetX+l,h=t.offsetY+r;if(e.dragCell&&(c<e.dragCell.ltX+e.dragCell.width-a||c>e.dragCell.ltX+e.dragCell.width+a+1)&&(e.core.dragSign=!1,e.dragCell=null),e.dragCell&&(h<e.dragCell.ltY+e.dragCell.height-a||c>e.dragCell.ltY+e.dragCell.height+a+1)&&(e.core.dragSign=!1,e.dragCell=null),!e.core.lockDrag){if(t.offsetY<=s){t.offsetX>s&&e.layer.setCursor("s-resize");for(var d=0;d<o.length;d++){var u=o[d];c>u.ltX+u.width-a&&c<u.ltX+u.width+a+1&&(e.core.dragSign||(e.dragCell=u),e.layer.setCursor("col-resize"),e.core.dragSign=!0,e.core.dragSignDirectionIsHor=!0)}}if(t.offsetX<=s){t.offsetY>s&&e.layer.setCursor("e-resize");for(var g=0;g<n.length;g++){var p=n[g];h>p.ltY+p.height-a&&h<p.ltY+p.height+a+1&&(e.core.dragSign||(e.dragCell=p),e.layer.setCursor("row-resize"),e.core.dragSign=!0,e.core.dragSignDirectionIsHor=!1)}}}}))}}]),e}(),R=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;o(this,e),l(this,"containerDom",null),l(this,"hideContextMenu",(function(){i.containerDom.style.display="none"})),l(this,"insertRow",(function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t){var n=i.core.col,l=i.options,r=l.cellWidth,s=l.cellHeight,a=i.contentComponent.contentGroup;i.core.sheetHeight+=t*s;for(var c=i.contentComponent.searchRectIndexByColAndRow(1,o?e:e+1),h=function(){var t=a[c];new Array(n).fill(void 0).forEach((function(o,i){a.splice(c,0,{row:e,col:n-i,text:"",width:r,height:s,x:t.x,y:t.y,ltX:t.ltX,ltY:t.ltY,mergeWidth:0,mergeHeight:0,mergeRow:1,mergeCol:1,mergeStartLabel:"",mergeEndLabel:"",mergeLabelGroup:[],isMerge:!1,bgColor:null,fontColor:"#000000",font:null,fontSize:12,fontWeight:"",fontItalic:"",fontFamily:"Calibre",textAlign:"center",textBaseline:"middle",label:"insert"})}))},d=1;d<=t;d++)h();i.contentComponent.initContentGroupRowAndColByRow(e,t),i.core.fresh(),i.core.plugins.ScrollPlugin.changeVerBarHeight()}})),l(this,"insertCol",(function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t){var n=i.core.row,l=i.options,r=l.cellWidth,s=l.cellHeight,a=i.contentComponent.contentGroup;i.core.sheetWidth+=t*r;for(var c=function(n){var l=i.contentComponent.searchRectIndexByColAndRow(e,n),c=a[l];new Array(t).fill(void 0).forEach((function(t){a.splice(o?l:l+1,0,{row:n,col:e,text:"",width:r,height:s,x:c.x,y:c.y,ltX:c.ltX,ltY:c.ltY,mergeWidth:0,mergeHeight:0,mergeRow:1,mergeCol:1,mergeStartLabel:"",mergeEndLabel:"",mergeLabelGroup:[],isMerge:!1,bgColor:null,fontColor:"#000000",font:null,fontSize:12,fontWeight:"",fontItalic:"",fontFamily:"Calibre",textAlign:"center",textBaseline:"middle",label:"insert"})}))},h=1;h<=n;h++)c(h);i.contentComponent.initContentGroupRowAndColByCol(e,t),i.core.fresh(),i.core.plugins.ScrollPlugin.changeHorBarWidth()}})),l(this,"removeCol",(function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t){var n=i.core.row,l=i.options,r=l.cellWidth;l.cellHeight;var s=i.contentComponent.contentGroup;i.core.sheetWidth-=t*r;for(var a=1;a<=n;a++)for(var c=0;c<t;c++){var h=i.contentComponent.searchRectIndexByColAndRow(o?e+c:e+1+c,a);s.splice(h,1)}i.contentComponent.initContentGroupRowAndColByCol(e,t,!1),i.core.fresh(),i.core.plugins.ScrollPlugin.changeHorBarWidth()}})),l(this,"removeRow",(function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t){var n=i.core.col,l=i.options;l.cellWidth;var r=l.cellHeight,s=i.contentComponent.contentGroup;i.core.sheetHeight-=t*r;for(var a=i.contentComponent.searchRectIndexByColAndRow(1,o?e:e+1),c=1;c<=t;c++)s.splice(a,n);i.contentComponent.initContentGroupRowAndColByRow(e,t,!1),i.core.fresh(),i.core.plugins.ScrollPlugin.changeVerBarHeight()}})),l(this,"splitCell",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e.isMerge)return i.settingPlugin.showDialog("提示","当前选中的单元格不是合并的单元格无法拆解"),!1;e.mergeEndLabel="",e.mergeStartLabel="",e.isMerge=!1;for(var o=e.row,n=e.row+e.mergeRow;o<n;o++)for(var l=e.col,r=e.col+e.mergeCol;l<r;l++)if(o===e.row&&l===e.col);else{var s=i.contentComponent.searchRectByColAndRow(l,o);s.mergeEndLabel="",s.mergeStartLabel="",s.isMerge=!1}return e.mergeRow=1,e.mergeCol=1,t&&i.contentComponent.showClickRect(e),i.core.fresh(),i.hideContextMenu(),!0})),l(this,"mergeCell",(function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(1===t.length&&t[0].label===e.label)return i.settingPlugin.showDialog("提示","单个单元格无法合并"),!1;if(t.some((function(e){return e.isMerge}))||0===t.length)return i.settingPlugin.showDialog("提示","当前选中的单元格中有合并的单元格，无法合并"),!1;var n=e.width,l=e.height;return e.mergeEndLabel=t[t.length-1].label,e.mergeStartLabel=e.label,e.isMerge=!0,e.mergeRow=1,e.mergeCol=1,t.forEach((function(o){o.isMerge=!0,o.mergeStartLabel=e.label,o.mergeEndLabel=t[t.length-1].label,e.row===o.row&&e.label!==o.label&&(n+=o.width,e.mergeCol+=1),e.col===o.col&&e.label!==o.label&&(l+=o.height,e.mergeRow+=1)})),e.mergeWidth=n,e.mergeHeight=l,i.contentComponent.setSecondClickCell(null),o&&i.contentComponent.showClickRect(e),i.core.freshContent(),i.hideContextMenu(),!0})),l(this,"eventInsertCol",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=i.contentComponent.clickCell;i.contentComponent.isHasMergerInRectArrByCol(o.col)||(i.core.plugins.SettingPlugin.changeStepArr({type:13,pre:{col:o.col,num:e,isLeft:t},next:{col:o.col,num:e,isLeft:t}}),i.core.ws.wsSend(13,{col:o.col,num:e,isLeft:t}),i.insertCol(o.col,e,t)),i.hideContextMenu()})),l(this,"eventInsertRow",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=i.contentComponent.clickCell;i.contentComponent.isHasMergerInRectArrByRow(o.row)||(i.core.plugins.SettingPlugin.changeStepArr({type:14,pre:{row:o.row,num:e,isTop:t},next:{row:o.row,num:e,isTop:t}}),i.core.ws.wsSend(14,{row:o.row,num:e,isTop:t}),i.insertRow(o.row,e,t)),i.hideContextMenu()})),this.contentComponent=s.ContentComponent,this.headerComponent=s.HeaderComponent,this.sideComponent=s.SideComponent,this.selectorDom=t,this.canvasDom=a.canvasDom,this.canvasWrapperDom=a.canvasWrapperDom,this.settingPlugin=a.plugins.SettingPlugin,this.options=r,this.layer=n,this.core=a,this.registryContextMenu()}return i(e,[{key:"registryContextMenu",value:function(){var e=this,t=this.core.h,o=t("div",{style:{display:"none"},attr:{className:"e-sheet-contextmenu-layout"}}),n=t("div",{style:{cursor:"pointer"},attr:{innerText:"合并单元格",className:"item-btn"}}),i=t("div",{style:{cursor:"pointer"},attr:{innerText:"拆分单元格",className:"item-btn"}}),l=t("div",{attr:{className:"item-input-btn item-top-border"}},[t("span",{attr:{innerText:"左侧插入",onclick:function(t){e.eventInsertCol(t.target.nextElementSibling.valueAsNumber)}}}),t("input",{attr:{type:"number",placeholder:"请输入列数",className:"input-con",value:1,onkeydown:function(t){"Enter"===t.key&&(e.eventInsertCol(t.target.valueAsNumber),t.target.value=1)}}}),t("span",{attr:{innerText:"列"}})]),r=t("div",{attr:{className:"item-input-btn item-top-border"}},[t("span",{attr:{innerText:"右侧插入",onclick:function(t){e.eventInsertCol(t.target.nextElementSibling.valueAsNumber,!1)}}}),t("input",{attr:{type:"number",placeholder:"请输入列数",className:"input-con",value:1,onkeydown:function(t){"Enter"===t.key&&(e.eventInsertCol(t.target.valueAsNumber,!1),t.target.value=1)}}}),t("span",{attr:{innerText:"列"}})]),s=t("div",{attr:{className:"item-input-btn item-top-border"}},[t("span",{attr:{innerText:"上侧插入",onclick:function(t){e.eventInsertRow(t.target.nextElementSibling.valueAsNumber)}}}),t("input",{attr:{type:"number",placeholder:"请输入行数",className:"input-con",value:1,onkeydown:function(t){"Enter"===t.key&&(e.eventInsertRow(t.target.valueAsNumber),t.target.value=1)}}}),t("span",{attr:{innerText:"行"}})]),a=t("div",{attr:{className:"item-input-btn item-top-border"}},[t("span",{attr:{innerText:"下侧插入",onclick:function(t){e.eventInsertRow(t.target.nextElementSibling.valueAsNumber,!1)}}}),t("input",{attr:{type:"number",placeholder:"请输入行数",className:"input-con",value:1,onkeydown:function(t){"Enter"===t.key&&(e.contentComponent.clickCell,e.eventInsertRow(t.target.valueAsNumber,!1),t.target.value=1)}}}),t("span",{attr:{innerText:"行"}})]);this.containerDom=o,this.canvasDom.addEventListener("contextmenu",(function(t){t.preventDefault();var l=e.contentComponent.clickCell,r=e.options.cellHeight,s=e.core.plugins.ScrollPlugin;s.offsetX,s.offsetY,t.offsetX<=r||t.offsetY<=r||l&&(o.style.display="block",o.style.left=t.offsetX+"px",o.style.top=t.offsetY+"px",l.isMerge?(n.style.display="none",i.style.display="flex"):(i.style.display="none",n.style.display="flex"))})),n.onclick=function(t){var o=e.contentComponent,n=o.clickCell,i=o.mergeSelectedCell,l={type:9,label:n.label},r=[n].concat(p(i)).sort((function(e,t){return e.row-t.row+(e.col-t.col)}));l.pre=r[0].label,l.next=r.map((function(e){return e.label})),e.core.plugins.SettingPlugin.changeStepArr(l),e.core.plugins.SettingPlugin.wsSendInfoByTypeAndData(9,l.next),e.mergeCell(r[0],r.slice(0))},i.onclick=function(t){var o=e.contentComponent.clickCell,n={row:o.row,col:o.col,mergeRow:o.mergeRow,mergeCol:o.mergeCol,mergeStartLabel:o.mergeStartLabel,mergeEndLabel:o.mergeEndLabel,isMerge:!1};e.core.plugins.SettingPlugin.changeStepArr({type:10,label:o.label,pre:{row:o.row,col:o.col,mergeRow:o.mergeRow,mergeCol:o.mergeCol,mergeStartLabel:o.mergeStartLabel,mergeEndLabel:o.mergeEndLabel,isMerge:!0},next:n}),e.core.plugins.SettingPlugin.wsSendInfoByTypeAndData(10,n),e.splitCell(o)},o.appendChild(n),o.appendChild(i),o.appendChild(l),o.appendChild(r),o.appendChild(s),o.appendChild(a),this.canvasWrapperDom.appendChild(o)}}]),e}(),N=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;o(this,e),l(this,"contextmenuDom",null),l(this,"hideContextMenu",(function(){i.contextmenuDom.style.display="none"})),l(this,"sheetArrLayoutDom",null),this.contentComponent=s.ContentComponent,this.headerComponent=s.HeaderComponent,this.sideComponent=s.SideComponent,this.selectorDom=t,this.canvasDom=a.canvasDom,this.canvasWrapperDom=a.canvasWrapperDom,this.options=r,this.layer=n,this.core=a,this.registryDom(),this.registryContextmenuDom()}return i(e,[{key:"registryContextmenuDom",value:function(){var e=this,t=this.core.h;this.contextmenuDom=t("div",{style:{display:"none"},attr:{className:"e-sheet-contextmenu-layout"}},[t("div",{style:{cursor:"pointer"},attr:{innerText:"删除",className:"item-btn",onclick:function(t){if(1!==e.core.eSheetWorkBook.length){var o=parseInt(t.target.parentNode.dataset.select);e.core.eSheetWorkBook.splice(o,1),e.core.currentSheetIndex=e.core.eSheetWorkBook.length-1,e.core.switchSheet(e.core.currentSheetIndex),e.sheetArrLayoutDom.removeChild(e.sheetArrLayoutDom.childNodes[o]),e.sheetArrLayoutDom.childNodes.forEach((function(e,t){e.className="item-span",e.setAttribute("index",t)})),e.sheetArrLayoutDom.childNodes[o-1].className="item-span active-item-span",e.hideContextMenu()}else e.hideContextMenu()}}})]),this.selectorDom.appendChild(this.contextmenuDom)}},{key:"createNewSheet",value:function(){this.core.createNewSheet(),this.core.currentSheetIndex=this.core.eSheetWorkBook.length-1;var e=this.core.eSheetWorkBook[this.core.currentSheetIndex];this.core.ws.wsSend(998,e),this.core.switchSheet(this.core.currentSheetIndex),this.sheetArrLayoutDom.childNodes.forEach((function(e){e.className="item-span"})),this.sheetArrLayoutDom.appendChild(this.core.h("span",{attr:{innerText:e.label,className:"item-span active-item-span"},attribute:{index:this.core.currentSheetIndex}}))}},{key:"clearBookSheet",value:function(){for(var e=this.sheetArrLayoutDom.childNodes.length-1;e>=0;e--)this.sheetArrLayoutDom.childNodes[e].remove()}},{key:"freshBookSheet",value:function(){var e=this;this.clearBookSheet(),this.core.eSheetWorkBook.forEach((function(t,o){e.sheetArrLayoutDom.appendChild(e.core.h("span",{attr:{innerText:t.label,className:"item-span"+(e.core.currentSheetIndex===o?" active-item-span":"")},attribute:{index:o}}))}))}},{key:"addSheetThenFresh",value:function(e){this.core.eSheetWorkBook.push(e),this.freshBookSheet()}},{key:"switchSheet",value:function(e){this.core.switchSheet(e);var t=this.core.currentSheetIndex;this.sheetArrLayoutDom.childNodes.forEach((function(e,o){e.className=t===o?"item-span active-item-span":"item-span"})),this.core.freshScrollBar()}},{key:"setSheetName",value:function(e,t){return!(this.core.eSheetWorkBook.map((function(e){return e.label})).includes(t)||!t)&&(this.core.eSheetWorkBook[e].label=t,!0)}},{key:"setCanvasScale",value:function(e){var t=this,o=this.options,n=o.width,i=o.height,l=o.cellHeight;this.contentComponent.contentGroup.forEach((function(o){o.width/=t.core.scale,o.height/=t.core.scale,o.x/=t.core.scale,o.y/=t.core.scale,o.ltX=l+o.x,o.ltY=l+o.y,o.mergeWidth/=t.core.scale,o.mergeHeight/=t.core.scale,o.width*=e,o.height*=e,o.x*=e,o.y*=e,o.ltX=e*l+o.x,o.ltY=e*l+o.y,o.mergeWidth*=e,o.mergeHeight*=e})),this.core.scale=e;var r=this.contentComponent.contentGroup[this.contentComponent.contentGroup.length-1];this.core.sheetWidth=r.ltX+r.width,this.core.sheetHeight=r.ltY+r.height,this.layer.clearRect(0,0,n,i),this.core.fresh(),this.core.freshScrollBar()}},{key:"registryDom",value:function(){var e=this,t=this.core,o=t.h;t.eSheetWorkBook,t.currentSheetIndex;var n=o("div",{attr:{className:"sheet-arr-layout",onclick:function(t){e.hideContextMenu();var o=t.target.getAttribute("index");o&&e.switchSheet(parseInt(o))},ondblclick:function(t){var n=t.target,i=parseInt(t.target.getAttribute("index")),l=n.innerText,r=o("input",{attr:{className:"item-input",onblur:function(t){n.contains(r)&&(e.setSheetName(i,n.innerText)?n.innerText=r.value:n.innerText=l,r.remove())},onkeydown:function(t){"Enter"===t.key&&(e.setSheetName(i,n.innerText)?n.innerText=r.value:n.innerText=l,r.remove())}}});r.value=n.innerText,r.style.width=n.getBoundingClientRect().width-24+"px",n.innerText="",n.appendChild(r),r.focus()},oncontextmenu:function(t){t.preventDefault();var o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,n=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft;e.contextmenuDom.dataset.select=t.target.getAttribute("index"),e.contextmenuDom.style.display="block",e.contextmenuDom.style.left=n+t.x+"px",e.contextmenuDom.style.top=o+t.y-34+"px"}}});this.sheetArrLayoutDom=n;var i=o("div",{attr:{className:"e-sheet-book-layout"}},[o("div",{attr:{className:"e-sheet-book-con"}},[o("div",{attr:{className:"menu-layout"}},[o("div",{attr:{className:"e-sheet-cell-hover"}},[o("e-sheet-tip",{attribute:{"tip-label":"全部",left:-6,top:-36}},[o("e-sheet-icon-svg",{attribute:{category:"book",position:"menu"}})])]),o("div",{attr:{className:"e-sheet-cell-hover"}},[o("e-sheet-tip",{attribute:{"tip-label":"新增",left:-6,top:-36},attr:{onclick:function(t){e.createNewSheet()}}},[o("e-sheet-icon-svg",{attribute:{category:"book",position:"plus"}})])])]),n,o("div",{attr:{className:"scroll-handle-layout"}},[o("e-sheet-tip",{attribute:{"tip-label":"向左滚动",left:-20,top:-36},style:{height:"100%"},attr:{onclick:function(e){n.scrollLeft-=300}}},[o("div",{attr:{className:"arrow"}},[o("e-sheet-icon-svg",{attribute:{category:"book",position:"arrow-left"}})])]),o("e-sheet-tip",{attribute:{"tip-label":"向右滚动",left:-20,top:-36},style:{height:"100%"},attr:{onclick:function(e){n.scrollLeft+=300}}},[o("div",{attr:{className:"arrow"}},[o("e-sheet-icon-svg",{attribute:{category:"book",position:"arrow-right"}})])])])])]);this.selectorDom.appendChild(i)}}]),e}(),Z=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0;o(this,e),l(this,"ws",void 0),this.contentComponent=r.ContentComponent,this.headerComponent=r.HeaderComponent,this.sideComponent=r.SideComponent,this.selectorDom=t,this.canvasDom=s.canvasDom,this.canvasWrapperDom=s.canvasWrapperDom,this.mulPersonSelected=s.mulPersonSelected,this.options=i,this.layer=n,this.core=s}return i(e,[{key:"connect",value:function(e){this.ws=new WebSocket(e),this.wsOpenCallback(),this.wsCloseCallback(),this.wsMsgCallback()}},{key:"wsOpenCallback",value:function(){this.ws.onopen=function(e){}}},{key:"wsCloseCallback",value:function(){var e=this;this.ws.onclose=function(t){e.ws=null}}},{key:"wsMsgCallbackType1",value:function(e){this.contentComponent.changeRectTextByLabel(e.command);var t=e.command,o=this.contentComponent.searchRectByLabel(e.command.label);void 0!==t.widthDis&&0!==t.widthDis&&this.core.plugins.DragPlugin.expandWidthNoDrag(o.col,t.undo?-t.widthDis:t.widthDis,!1),void 0!==t.heightDis&&0!==t.heightDis&&this.core.plugins.DragPlugin.expandHeightNoDrag(o.row,t.undo?-t.heightDis:t.heightDis,!1)}},{key:"wsMsgCallbackType2",value:function(e){this.contentComponent.changeRectAttrByLabel(e.command,"fontSize")}},{key:"wsMsgCallbackType3",value:function(e){this.contentComponent.changeRectAttrByLabel(e.command,"textBaseline")}},{key:"wsMsgCallbackType4",value:function(e){this.contentComponent.changeRectAttrByLabel(e.command,"textAlign")}},{key:"wsMsgCallbackType5",value:function(e){this.contentComponent.changeRectAttrByLabel(e.command,"fontWeight")}},{key:"wsMsgCallbackType6",value:function(e){this.contentComponent.changeRectAttrByLabel(e.command,"fontItalic")}},{key:"wsMsgCallbackType7",value:function(e){this.contentComponent.changeRectAttrByLabel(e.command,"fontColor")}},{key:"wsMsgCallbackType8",value:function(e){this.contentComponent.changeRectAttrByLabel(e.command,"bgColor")}},{key:"wsMsgCallbackType9",value:function(e){if(e.command.undo){var t=this.contentComponent.searchRectByLabel(e.command.label);this.core.plugins.ContextmenuPlugin.splitCell(t,!1)}else{for(var o=[],n=1;n<e.command.length;n++)o.push(this.contentComponent.searchRectByLabel(e.command[n]));var i=this.contentComponent.searchRectByLabel(e.command[0]);this.core.plugins.ContextmenuPlugin.mergeCell(i,o,!1)}}},{key:"wsMsgCallbackType10",value:function(e){if(e.command.undo){for(var t=[],o=0;o<e.command.mergeRow;o++)for(var n=0;n<e.command.mergeCol;n++)0===o&&0===n||t.push(this.contentComponent.searchRectByColAndRow(e.command.col+n,e.command.row+o));var i=this.contentComponent.searchRectByLabel(e.command.mergeStartLabel);this.core.plugins.ContextmenuPlugin.mergeCell(i,t,!1)}else{var l=this.contentComponent.searchRectByColAndRow(e.command.col,e.command.row);this.core.plugins.ContextmenuPlugin.splitCell(l,!1)}}},{key:"wsMsgCallbackType11",value:function(e){var t=this.contentComponent.searchRectByLabel(e.command.label);this.core.plugins.DragPlugin.expandWidthNoDrag(t.col,e.command.dis)}},{key:"wsMsgCallbackType12",value:function(e){var t=this.contentComponent.searchRectByLabel(e.command.label);this.core.plugins.DragPlugin.expandHeightNoDrag(t.row,e.command.dis)}},{key:"wsMsgCallbackType13",value:function(e){var t=e.command;t.undo?this.core.plugins.ContextmenuPlugin.removeCol(t.col,t.num,t.isLeft):this.core.plugins.ContextmenuPlugin.insertCol(t.col,t.num,t.isLeft)}},{key:"wsMsgCallbackType14",value:function(e){var t=e.command;t.undo?this.core.plugins.ContextmenuPlugin.removeRow(t.row,t.num,t.isTop):this.core.plugins.ContextmenuPlugin.insertRow(t.row,t.num,t.isTop)}},{key:"wsMsgCallbackType15",value:function(e){if(e.command.undo)this.core.plugins.SelectPlugin.forcePasteCellToNewCell(JSON.parse(e.command.pasteStr));else{var t=this.contentComponent.searchRectByLabel(e.command.label);this.core.plugins.SelectPlugin.transformTableDomStrToCanvasCell(e.command.pasteStr,t,!1)}}},{key:"wsMsgCallbackType16",value:function(e){var t=e.command;this.core.plugins.SelectPlugin.forcePasteCellToNewCell(JSON.parse(t.pre));var o=this.contentComponent.searchRectByLabel(t.label);t.undo?this.core.plugins.SelectPlugin.forcePasteCellToNewCellByTargetCell(JSON.parse(t.next),o):this.core.plugins.SelectPlugin.transformTableDomStrToCanvasCell(t.next,o,!1),this.contentComponent.setSecondClickCell(null)}},{key:"wsMsgCallbackType17",value:function(e){var t=this,o=e.command;o.undo?o.pre.forEach((function(e){t.core.plugins.SelectPlugin.forcePasteCellToNewCell(JSON.parse(e))})):o.next.forEach((function(e){var o=t.contentComponent.searchRectByLabel(e.label);t.core.plugins.SelectPlugin.transformTableDomStrToCanvasCell(e.tableDomStr,o,!1)}))}},{key:"wsMsgCallbackType18",value:function(e){this.contentComponent.changeRectAttrByLabel(e.command,"strikethrough")}},{key:"wsMsgCallbackType19",value:function(e){this.contentComponent.changeRectAttrByLabel(e.command,"underline")}},{key:"wsMsgCallbackType20",value:function(e){var t=this,o=e.command;o.undo?o.cells.forEach((function(e){t.contentComponent.searchRectByLabel(e.label).text=e.text})):o.cells.forEach((function(e){t.contentComponent.searchRectByLabel(e.label).text=""}))}},{key:"wsMsgCallbackType21",value:function(e){this.core.plugins.SettingPlugin.setTextWrapChange(e.command.textWrapType),this.core.plugins.SettingPlugin.setTextWrapInHeader(e.command.textWrapType)}},{key:"wsMsgCallbackType998",value:function(e){this.core.plugins.BookPlugin.addSheetThenFresh(e.command)}},{key:"changeUserShow",value:function(e){var t=this.mulPersonSelected.findIndex((function(t){return t.userId===e.userId}));-1===t?this.mulPersonSelected.push(e):this.mulPersonSelected[t]=e}},{key:"wsMsgCallback",value:function(){var e=this;this.ws.onmessage=function(t){var o=e.core.components.ContentComponent,n=JSON.parse(t.data),i=e.core.getCurrentSheet();if(0===n.type&&e.changeUserShow(n),998!==n.type)if(i.id===n.sheetId){switch(n.type){case 999:o.contentGroup=n.command,e.mulPersonSelected.forEach((function(e){e.command=o.searchRectByLabel(e.command.label)}));break;case 1:e.wsMsgCallbackType1(n);break;case 2:e.wsMsgCallbackType2(n);break;case 3:e.wsMsgCallbackType3(n);break;case 4:e.wsMsgCallbackType4(n);break;case 5:e.wsMsgCallbackType5(n);break;case 6:e.wsMsgCallbackType6(n);break;case 7:e.wsMsgCallbackType7(n);break;case 8:e.wsMsgCallbackType8(n);break;case 9:e.wsMsgCallbackType9(n);break;case 10:e.wsMsgCallbackType10(n);break;case 11:e.wsMsgCallbackType11(n);break;case 12:e.wsMsgCallbackType12(n);break;case 13:e.wsMsgCallbackType13(n);break;case 14:e.wsMsgCallbackType14(n);break;case 15:e.wsMsgCallbackType15(n);break;case 16:e.wsMsgCallbackType16(n);break;case 17:e.wsMsgCallbackType17(n);break;case 18:e.wsMsgCallbackType18(n);break;case 19:e.wsMsgCallbackType19(n);break;case 20:e.wsMsgCallbackType20(n);break;case 21:e.wsMsgCallbackType21(n)}[19].includes(n.type)||e.core.fresh()}else{var l=e.core.getSheetById(n.sheetId);l&&(l.sheet=n.wholeSheet.sheet,n.wholeSheet.config&&(l.config=n.wholeSheet.config))}else e.wsMsgCallbackType998(n)}}},{key:"wsSend",value:function(e,t){if(this.ws){var o=this.core.getCurrentSheet();this.ws.send(JSON.stringify({type:e,command:t,sheetId:o.id,userId:this.core.userId,userName:this.core.userName,userColor:this.core.userColor,wholeSheet:o}))}}},{key:"syncData",value:function(){this.wsSend(0,this.core.components.ContentComponent.contentGroup)}}]),e}(),W=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.attr,n=t.style,i=t.attribute,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=document.createElement(e);for(var s in o)r[s]=o[s];for(var a in i)r.setAttribute(a,i[a]);for(var c in n)r.style[c]=n[c];l&&("[object Array]"===H(l)?l.forEach((function(e){r.appendChild(e)})):r.appendChild(l));return r},H=function(e){return Object.prototype.toString.call(e)},E=function(e){r(n,e);var t=g(n);function n(){return o(this,n),t.apply(this,arguments)}return i(n,[{key:"connectedCallback",value:function(){this.className="e-sheet-loading-cup-layout";var e=W("div",{attr:{className:"cup"}},[W("div",{attr:{className:"handle"}})]);this.appendChild(e)}}]),n}(d(HTMLElement));customElements.define("e-sheet-loading-cup",E);var j=function(e){r(n,e);var t=g(n);function n(){return o(this,n),t.apply(this,arguments)}return i(n,[{key:"connectedCallback",value:function(){var e=this;this.tipLabel=this.getAttribute("tip-label"),this.left=parseInt(this.getAttribute("left")),this.top=parseInt(this.getAttribute("top"));var t=document.createElement("div");t.className="e-sheet-radio-button-tip",t.innerText=this.tipLabel,this.className="e-sheet-tip",this.addEventListener("mouseover",(function(o){if(!document.body.contains(t)){var n=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,i=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,l=e.getBoundingClientRect(),r=l.x,s=l.y;t.style.left=r+e.left+i+"px",t.style.top=s+e.top+n+"px",document.body.appendChild(t)}})),this.addEventListener("mouseleave",(function(e){t.remove()}))}}]),n}(d(HTMLElement));customElements.define("e-sheet-tip",j);var G=function(e){r(n,e);var t=g(n);function n(){var e;return o(this,n),l(u(e=t.call(this)),"optionLayoutDom",null),l(u(e),"isOpen",!1),l(u(e),"showTextDom",null),l(u(e),"arrowDom",null),e}return i(n,[{key:"close",value:function(){this.optionLayoutDom&&this.optionLayoutDom.remove(),this.optionLayoutDom=null,this.isOpen=!1,this.arrowDom.style.transform="rotate(0deg)"}},{key:"connectedCallback",value:function(){var e,t=this;this.value=null!==(e=this.getAttribute("value"))&&void 0!==e?e:12,this.label=this.getAttribute("label"),this.className="e-sheet-select";var o=document.createElement("div");o.className="e-sheet-radio-button-tip",o.innerText=this.label,this.addEventListener("mouseover",(function(e){o||((o=document.createElement("div")).className="e-sheet-radio-button-tip",o.innerText=t.label);var n=t.getBoundingClientRect(),i=n.x,l=n.y;o.style.left=i+12+"px",o.style.top=l+24+"px",document.body.appendChild(o)})),this.addEventListener("mouseleave",(function(e){o.remove()}));var n=document.createElement("div");n.innerText=this.value,n.className="select-text",this.showTextDom=n;var i=document.createElement("e-sheet-icon-svg");i.setAttribute("category","select"),i.setAttribute("position","down"),this.arrowDom=i,i.style.transition="transform .5s",this.appendChild(n),this.appendChild(i),document.addEventListener("click",(function(e){t.contains(e.target)||t.close()})),this.addEventListener("e-sheet-option-onchange",(function(e){n.innerText=t.value=e.detail,t.dispatchEvent(new CustomEvent("e-sheet-select-onchange",{bubbles:!1,composed:!0,detail:t.value})),o.remove(),t.close()})),this.addEventListener("click",(function(e){if(e.stopImmediatePropagation(),t.isOpen)t.close();else if(!t.optionLayoutDom||t.optionLayoutDom.contains(e.target)){t.isOpen=!0,i.style.transform="rotate(180deg)",t.optionLayoutDom=document.createElement("div"),t.optionLayoutDom.className="e-sheet-option-layout",new Array(10).fill(0).forEach((function(e,o){var n=document.createElement("e-sheet-option");n.setAttribute("label",(12+o).toString()),n.setAttribute("value",12+o),n.setAttribute("current",t.value),t.optionLayoutDom.appendChild(n)}));var o=t.getBoundingClientRect().height;t.optionLayoutDom.style.left="-1px",t.optionLayoutDom.style.top=o+"px",t.appendChild(t.optionLayoutDom)}}))}},{key:"attributeChangedCallback",value:function(e,t,o){this.value=o,this.showTextDom.innerText=this.value}}],[{key:"observedAttributes",get:function(){return["value"]}}]),n}(d(HTMLElement));customElements.define("e-sheet-select",G);var Y=function(e){r(n,e);var t=g(n);function n(){return o(this,n),t.call(this)}return i(n,[{key:"connectedCallback",value:function(){var e=this;this.label=this.getAttribute("label"),this.value=this.getAttribute("value"),this.current=this.getAttribute("current"),this.className="e-sheet-option";var t=document.createElement("div");t.className="option-font",t.innerText=this.label;var o=document.createElement("e-sheet-icon-svg");this.value!==this.current&&(o.style.display="none"),o.setAttribute("category","bool"),o.setAttribute("position","true"),this.appendChild(t),this.appendChild(o),this.addEventListener("click",(function(t){t.stopImmediatePropagation(),e.dispatchEvent(new CustomEvent("e-sheet-option-onchange",{bubbles:!0,composed:!0,detail:e.value}))}))}}]),n}(d(HTMLElement));customElements.define("e-sheet-option",Y);var z=function(e){r(n,e);var t=g(n);function n(){return o(this,n),t.call(this)}return i(n,[{key:"connectedCallback",value:function(){var e=this;this.value=this.getAttribute("value");var t=this.attachShadow({mode:"open"}),o=document.createElement("slot");this.className="e-sheet-radio-group",t.appendChild(o),t.addEventListener("e-sheet-radio-group-change",(function(o){e.value=o.detail,new Array(e.childElementCount).fill(void 0).forEach((function(t,o){e.children.item(o).setAttribute("current",e.value)})),t.dispatchEvent(new CustomEvent("e-sheet-radio-group-onchange",{bubbles:!1,composed:!0,detail:e.value}))}))}},{key:"attributeChangedCallback",value:function(e,t,o){var n=this;this.value=o,new Array(this.childElementCount).fill(void 0).forEach((function(e,t){n.children.item(t).setAttribute("current",n.value)}))}}],[{key:"observedAttributes",get:function(){return["value"]}}]),n}(d(HTMLElement));customElements.define("e-sheet-radio-group",z);var X=function(e){r(n,e);var t=g(n);function n(){return o(this,n),t.call(this)}return i(n,[{key:"connectedCallback",value:function(){var e=this;this.label=this.getAttribute("label"),this.value=this.getAttribute("value"),this.left=this.getAttribute("left"),this.top=this.getAttribute("top"),this.className="e-sheet-radio-button";var t=this.attachShadow({mode:"open"}),o=document.createElement("div");o.className="e-sheet-radio-button-tip",o.innerText=this.label;var n=document.createElement("slot");t.addEventListener("click",(function(o){t.dispatchEvent(new CustomEvent("e-sheet-radio-group-change",{bubbles:!0,composed:!0,detail:e.value}))})),this.addEventListener("mouseover",(function(t){if(!document.body.contains(o)){var n=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,i=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,l=e.getBoundingClientRect(),r=l.x,s=l.y,a=e.left?parseInt(e.left):12*-e.label.length/2+4,c=e.top?parseInt(e.top):24;o.style.left=r+a+i+"px",o.style.top=s+n+c+"px",document.body.appendChild(o)}})),this.addEventListener("mouseleave",(function(e){o.remove()})),t.appendChild(n)}},{key:"attributeChangedCallback",value:function(e,t,o){this.value===o?this.className="e-sheet-radio-button e-sheet-radio-button-selected":this.className="e-sheet-radio-button"}}],[{key:"observedAttributes",get:function(){return["current"]}}]),n}(d(HTMLElement));customElements.define("e-sheet-radio-button",X);var F=function(e){r(n,e);var t=g(n);function n(){return o(this,n),t.call(this)}return i(n,[{key:"connectedCallback",value:function(){if(this.category=this.getAttribute("category"),this.position=this.getAttribute("position"),"hor"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"left":case"start":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_6926_00059"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_6926_00059)"><path fill="currentColor" fill-opacity="0.94" d="M17 5H3V4h14v1Zm-7 4H3V8h7v1Zm0 8H3v-1h7v1Zm7-4v-1H3v1h14Z"></path></g></svg>');case"center":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_6926_00035"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_6926_00035)"><path fill="currentColor" fill-opacity="0.94" d="M17 5H3V4h14v1ZM7 9h6V8H7v1Zm10 4H3v-1h14v1Zm-4 4H7v-1h6v1Z"></path></g></svg>');case"right":case"end":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_6926_00066"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_6926_00066)"><path fill="currentColor" fill-opacity="0.94" d="M17 5H3V4h14v1Zm-7 4h7V8h-7v1Zm7 3v1H3v-1h14Zm0 5h-7v-1h7v1Z"></path></g></svg>')}if("ver"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"top":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_7600_00213"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_7600_00213)"><path fill="currentColor" d="M17 4H3V3h14v1Z"></path><path fill="#0089FF" d="m10.013 6 3.487 4h-7l3.513-4Z"></path><path fill="#0089FF" fill-rule="evenodd" d="M10.5 9v8h-1V9h1Z"></path></g></svg>');case"middle":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_7600_00207"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_7600_00207)"><path fill="currentColor" d="M17 10H3V9h14v1Z"></path><path fill="#0089FF" fill-rule="evenodd" d="M10.5 1v5h-1V1h1Z"></path><path fill="#0089FF" d="m10.01 8 2.49-3h-5l2.51 3ZM10.01 11l2.49 3h-5l2.51-3Z"></path><path fill="#0089FF" fill-rule="evenodd" d="M10.5 14v4h-1v-4h1Z"></path></g></svg>');case"bottom":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_7600_00217"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_7600_00217)"><path fill="currentColor" d="M17 17H3v-1h14v1Z"></path><path fill="#0089FF" fill-rule="evenodd" d="M10.5 3v8h-1V3h1Z"></path><path fill="#0089FF" d="m10.013 14 3.487-4h-7l3.513 4Z"></path></g></svg>')}if("bool"!==this.category||(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20","true"!==this.position))if("select"!==this.category||(this.className="e-sheet-cell-svg-layout e-sheet-svg-12-12","down"!==this.position)){if("font"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"weight":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="master_svg0_6926_00081"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_6926_00081)"><path fill="currentColor" d="M5.8 3.05a.75.75 0 0 0-.75.75v12.5c0 .414.336.75.75.75h5.5c2.297 0 3.75-1.862 3.75-4 0-1.415-.637-2.71-1.734-3.423.734-.635 1.234-1.588 1.234-2.827 0-2.424-1.91-3.75-3.75-3.75h-5Zm5 6H6.55v-4.5h4.25c1.16 0 2.25.796 2.25 2.25s-1.09 2.25-2.25 2.25Zm-4.25 1.5h4.75c1.314 0 2.25 1.027 2.25 2.5s-.936 2.5-2.25 2.5H6.55v-5Z" data-spm-anchor-id=""></path></g></svg>');case"italic":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20" data-spm-anchor-id=""><defs><clipPath id="master_svg0_7600_9375"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_7600_9375)"><path fill="currentColor" d="M12 4h3V3H8v1h2.769l-2.77 12H5v1h7v-1H9.231l2.77-12Z"></path></g></svg>');case"strikethrough":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="b33801_0"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#b33801_0)"><path fill="currentColor" d="M11.276 11h2.133c.222.192.42.419.584.694.672 1.125.684 2.469-.01 3.535-.697 1.07-2.04 1.771-3.91 1.771-1.935 0-3.102-.915-3.765-1.934-.642-.986-.808-2.058-.808-2.466h1c0 .242.125 1.12.646 1.921.501.77 1.37 1.479 2.927 1.479 1.621 0 2.604-.598 3.072-1.316.47-.722.481-1.653-.01-2.478-.244-.408-.62-.68-1.18-.934a10.414 10.414 0 0 0-.679-.272ZM3 10h14V9H3v1Zm4.115-6.016C7.87 3.329 8.92 3 10.073 3c2.058 0 3.631 1.518 3.984 3.669l-.987.162C12.783 5.082 11.564 4 10.073 4c-.972 0-1.77.278-2.304.74-.523.452-.832 1.113-.788 1.985.014.275.07.513.156.721.083.204.198.387.339.554H6.29a3.168 3.168 0 0 1-.307-1.225c-.06-1.163.364-2.127 1.132-2.791Z"></path></g></svg>');case"underline":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath id="9fa4b3_0"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#9fa4b3_0)"><path fill="currentColor" d="M3 17v1h13v-1H3Zm3-6.5V3H5v7.5a4.5 4.5 0 1 0 9 0V3h-1v7.5a3.5 3.5 0 1 1-7 0Z"></path></g></svg>')}if("cell"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"merge":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20"><defs><clipPath id="master_svg0_31608_94416"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_31608_94416)"><path fill="#0089FF" d="M15 10.5H5v-1h10v1Z"></path><path fill="currentColor" d="M6.5 3A1.5 1.5 0 0 1 8 4.5V6H7V4.5a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 0-.5.5v11a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5V14h1v1.5A1.5 1.5 0 0 1 6.5 17h-2A1.5 1.5 0 0 1 3 15.5v-11A1.5 1.5 0 0 1 4.5 3h2Zm7 0A1.5 1.5 0 0 0 12 4.5V6h1V4.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5V14h-1v1.5a1.5 1.5 0 0 0 1.5 1.5h2a1.5 1.5 0 0 0 1.5-1.5v-11A1.5 1.5 0 0 0 15.5 3h-2Z"></path></g></svg>');case"split":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20"><defs><clipPath id="master_svg0_31608_94446"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_31608_94446)"><path fill="currentColor" fill-rule="evenodd" d="M4 4.5A1.5 1.5 0 0 1 5.5 3h2A1.5 1.5 0 0 1 9 4.5v11A1.5 1.5 0 0 1 7.5 17h-2A1.5 1.5 0 0 1 4 15.5V14h1v1.5a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5v-11a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 0-.5.5V6H4V4.5ZM16 4.5A1.5 1.5 0 0 0 14.5 3h-2A1.5 1.5 0 0 0 11 4.5v11a1.5 1.5 0 0 0 1.5 1.5h2a1.5 1.5 0 0 0 1.5-1.5V14h-1v1.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5V6h1V4.5Z"></path><path fill="#0089FF" fill-rule="evenodd" d="M7 10.5H4v-1h3v1ZM16 10.5h-3v-1h3v1Z"></path><path fill="#0089FF" d="m18 10-3-2.5v5l3-2.5ZM2 10l3-2.5v5L2 10Z"></path></g></svg>')}if("book"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"menu":return void(this.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" data-spm-anchor-id=""><path d="M6 5H18V4H6V5ZM18 10H6V9H18V10ZM18 15H6V14H18V15ZM2 5H4V4H2V5ZM4 10H2V9H4V10ZM4 15H2V14H4V15Z" fill="rgba(40,50,72,1)"></path></svg>');case"plus":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20"><defs><clipPath id="master_svg0_30306_58308"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_30306_58308)"><path fill="currentColor" fill-opacity="0.94" d="M9.5 4.5v5h-5a.5.5 0 0 0 0 1h5v5a.5.5 0 0 0 1 0v-5h5a.5.5 0 0 0 0-1h-5v-5a.5.5 0 0 0-1 0Z"></path></g></svg>');case"arrow-left":return void(this.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="wdn-icon" data-spm-anchor-id=""><path d="m12.646 3.646.708.708L7.707 10l5.647 5.646-.707.708L6.292 10l6.353-6.354Z" fill="currentColor"></path></svg>');case"arrow-right":return void(this.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="wdn-icon"><path d="m7.353 3.646-.707.708L12.293 10l-5.647 5.646.707.708L13.707 10 7.353 3.646Z" fill="currentColor"></path></svg>')}if("step"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"forward":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20" data-spm-anchor-id=""><defs><clipPath><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#___SVG_ID__50__0___)"><path fill="currentColor" fill-opacity="0.94" d="M16.3 6H7.988C4.975 6 3 8.22 3 11s1.975 5 4.988 5h4.168v1H7.988C4.388 17 2 14.296 2 11s2.387-6 5.988-6h8.298l-2.14-2.147.708-.706 3.353 3.364-3.354 3.343-.706-.708L16.3 6Z"></path></g></svg>');case"fallback":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" size="20"><defs><clipPath><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#___SVG_ID__49__0___)"><path fill="currentColor" fill-opacity="0.94" d="M6.354 2.353 3.714 5h8.298C15.612 5 18 7.704 18 11s-2.387 6-5.988 6H8v-1h4.012C15.025 16 17 13.78 17 11s-1.975-5-4.988-5H3.7l2.653 2.646-.706.708-3.854-3.843 3.853-3.864.708.706Z"></path></g></svg>')}if("text"===this.category)switch(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20",this.position){case"cut":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20"><defs><clipPath><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#939411_0)"><path fill="#0089FF" d="M7 10h9v1H7v-1Z"></path><path fill="currentColor" d="M4 17V4H3v13h1ZM17 17V4h-1v13h1Z"></path></g></svg>');case"wrap":return void(this.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20"><defs><clipPath><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#a74a80_0)"><path fill="#0089FF" d="M6 7h4.5a2.5 2.5 0 0 1 0 5H9v-2l-3 2.49L9 15v-2h1.5a3.5 3.5 0 1 0 0-7H6v1Z"></path><path fill="currentColor" fill-opacity="0.94" d="M4 17V4H3v13h1ZM17 17V4h-1v13h1Z"></path></g></svg>')}"extra"!==this.category||(this.className="e-sheet-cell-svg-layout e-sheet-svg-20-20","cell-img"!==this.position)||(this.innerHTML='<svg width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-opacity="0.94" d="M2 18.5q0 1.035.732 1.768Q3.464 21 4.5 21h15q1.035 0 1.768-.732Q22 19.535 22 18.5v-13q0-1.036-.732-1.768Q20.535 3 19.5 3h-15q-1.036 0-1.768.732T2 5.5v13Zm1 0v-.993l3.705-3.705q.205-.205.495-.205.29 0 .495.205l2.398 2.398-3.8 3.8H4.5Q3 20 3 18.5Zm0-2.407V5.5Q3 4 4.5 4h15Q21 4 21 5.5v9.393l-3.598-3.598q-1.202-1.202-2.404 0L10.8 15.493l-2.398-2.398q-.498-.498-1.202-.498t-1.202.498L3 16.093Zm18 .214V18.5q0 1.5-1.5 1.5H7.707l7.998-7.998q.495-.495.99 0L21 16.307ZM8.914 9.914Q9.5 9.328 9.5 8.5t-.586-1.414Q8.328 6.5 7.5 6.5t-1.414.586Q5.5 7.672 5.5 8.5t.586 1.414q.586.586 1.414.586t1.414-.586Zm-.707-2.121q.293.293.293.707t-.293.707Q7.914 9.5 7.5 9.5t-.707-.293Q6.5 8.914 6.5 8.5t.293-.707Q7.086 7.5 7.5 7.5t.707.293Z"></path></svg>')}else this.innerHTML='<svg width="12" height="12" viewBox="0 0 12 12" stroke="none" data-spm-anchor-id="" style=""><path d="M6.00004 7.79293L1.85359 3.64648L1.14648 4.35359L6.00004 9.20714L10.8536 4.35359L10.1465 3.64648L6.00004 7.79293Z" fill="currentColor" data-spm-anchor-id=""></path></svg>';else this.innerHTML='<svg fill="none" width="20" height="20" viewBox="0 0 20 20" class="wdn-icon"><path d="M16.354 6.854a.5.5 0 0 0-.708-.708L8.5 13.293 4.854 9.647a.5.5 0 1 0-.708.707l4 4a.5.5 0 0 0 .708 0l7.5-7.5Z" fill="currentColor"></path></svg>'}}]),n}(d(HTMLElement));customElements.define("e-sheet-icon-svg",F);var V=function(e){r(n,e);var t=g(n);function n(){return o(this,n),t.call(this)}return i(n,[{key:"connectedCallback",value:function(){var e=this;this.category=this.getAttribute("category"),this.color=this.getAttribute("color"),this.className="e-sheet-icon-color-svg";var t=document.createElement("div");t.onclick=function(t){e.querySelector("svg").querySelectorAll("path").forEach((function(t){"currentColor"!==t.getAttribute("fill")&&e.dispatchEvent(new CustomEvent("e-sheet-icon-color-svg-onchange",{bubbles:!1,composed:!0,detail:t.getAttribute("fill")}))}))};var o=document.createElement("div"),n=document.createElement("e-sheet-icon-svg");n.setAttribute("category","select"),n.setAttribute("position","down"),n.style.transition="transform .5s",o.appendChild(n);var i=document.createElement("input");i.className="no-draw-input",i.type="color",i.oninput=function(t){e.setAttribute("color",t.target.value),e.dispatchEvent(new CustomEvent("e-sheet-icon-color-svg-onchange",{bubbles:!1,composed:!0,detail:t.target.value}))},o.appendChild(i),o.className="arrow-layout",o.onclick=function(e){n.style.transform="rotate(180deg)",i.click()},document.addEventListener("click",(function(t){e.contains(t.target)||(n.style.transform="rotate(0deg)")})),t.className="e-sheet-cell-svg-layout e-sheet-svg-20-20","font-color"===this.category?t.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20" data-spm-anchor-id=""><defs><clipPath id="master_svg0_23880_31533"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_23880_31533)"><path fill="#000000" d="M17 19H3a1 1 0 0 1 0-2h14a1 1 0 1 1 0 2Z"></path><path fill="currentColor" fill-opacity="0.14" d="M17 19.5q.621 0 1.06-.44.44-.439.44-1.06t-.44-1.06q-.439-.44-1.06-.44H3q-.621 0-1.06.44-.44.439-.44 1.06t.44 1.06q.439.44 1.06.44h14Zm0-.5H3a1 1 0 0 1 0-2h14a1 1 0 1 1 0 2Z"></path><path fill="currentColor" fill-opacity="0.94" d="m12.456 11 1.584 3.697a.5.5 0 0 0 .92-.394l-1.715-4-2.785-6.5a.5.5 0 0 0-.92 0l-2.785 6.5-1.714 4a.5.5 0 0 0 .919.394L7.544 11h4.912Zm-.429-1H7.973L10 5.27 12.027 10Z"></path></g></svg>':"bg-color"===this.category&&(t.innerHTML='<svg width="20" height="20" fill="none" viewBox="0 0 20 20"><defs><clipPath id="master_svg0_31391_75878"><rect width="20" height="20" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_31391_75878)"><path fill="currentColor" fill-opacity="0.94" fill-rule="evenodd" d="M9.718 1.843 5.857 5.704h-3.87v1h2.87L3.354 8.207q-.44.44-.44 1.061t.44 1.06l4.95 4.95q.439.44 1.06.44t1.06-.44l6.365-6.364q.44-.439.44-1.06 0-.622-.44-1.061l-4.95-4.95q-.44-.44-1.06-.44-.622 0-1.061.44ZM11.5 6.704H6.271l-2.21 2.21q-.147.147-.147.354t.147.354l.531.531 10.315-.771 1.175-1.175q.146-.146.146-.353t-.146-.354l-4.95-4.95q-.147-.146-.354-.146t-.353.146L7.27 5.704H11.5v1Zm5.088 8.442c.78 0 1.412-.632 1.412-1.411q0-.78-1.412-2.353-1.412 1.573-1.412 2.353c0 .78.633 1.411 1.412 1.411Z"></path><path fill="#F2C150" d="M17 19H3a1 1 0 0 1 0-2h14a1 1 0 1 1 0 2Z"></path><path fill="currentColor" fill-opacity="0.14" d="M17 19.5q.621 0 1.06-.44.44-.439.44-1.06t-.44-1.06q-.439-.44-1.06-.44H3q-.621 0-1.06.44-.44.439-.44 1.06t.44 1.06q.439.44 1.06.44h14Zm0-.5H3a1 1 0 0 1 0-2h14a1 1 0 1 1 0 2Z"></path></g></svg>'),this.appendChild(t),this.appendChild(o)}},{key:"attributeChangedCallback",value:function(e,t,o){this.color=o,this.querySelector("svg").querySelectorAll("path").forEach((function(e){"currentColor"!==e.getAttribute("fill")&&e.setAttribute("fill",o)}))}}],[{key:"observedAttributes",get:function(){return["color"]}}]),n}(d(HTMLElement));customElements.define("e-sheet-icon-color-svg",V);var J=function(e){r(n,e);var t=g(n);function n(){var e;o(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return l(u(e=t.call.apply(t,[this].concat(r))),"show",!1),l(u(e),"title",""),l(u(e),"content",""),l(u(e),"wrapperDom",void 0),l(u(e),"titleDom",void 0),l(u(e),"contentDom",void 0),l(u(e),"mounted",!1),e}return i(n,[{key:"connectedCallback",value:function(){var e=this;this.show=this.getAttribute("show"),this.title=this.getAttribute("t"),this.content=this.getAttribute("content"),this.className="e-sheet-warn-dialog-tip",this.wrapperDom=document.createElement("div"),this.wrapperDom.className="e-sheet-warn-dialog-wrapper",this.titleDom=document.createElement("div"),this.titleDom.className="e-sheet-warn-dialog-wrapper-title",this.contentDom=document.createElement("div"),this.contentDom.className="e-sheet-warn-dialog-wrapper-content";var t=document.createElement("div");t.className="e-sheet-warn-dialog-tip-close-btn",t.addEventListener("click",(function(t){e.setAttribute("show",!1)})),this.titleDom.innerText=this.title,this.contentDom.innerText=this.content,this.wrapperDom.append(this.titleDom),this.wrapperDom.append(this.contentDom),this.wrapperDom.append(t),this.append(this.wrapperDom),this.mounted=!0}},{key:"showDialog",value:function(){this.style.display="flex"}},{key:"closeDialog",value:function(){this.style.display="none"}},{key:"attributeChangedCallback",value:function(e,t,o){var n=JSON.parse(o);this.show=n,n&&this.mounted?(this.title=this.getAttribute("t"),this.content=this.getAttribute("content"),this.titleDom.innerText=this.title,this.contentDom.innerText=this.content,this.showDialog()):this.closeDialog()}}],[{key:"observedAttributes",get:function(){return["show"]}}]),n}(d(HTMLElement));customElements.define("e-sheet-warn-dialog-tip",J);var O=function(){function e(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(o(this,e),l(this,"excelDom",null),l(this,"AppExcel",null),"[object HTMLDivElement]"===Object.prototype.toString.call(n)?this.excelDom=n:this.excelDom=document.querySelector(n),!this.excelDom)throw new Error("the selector is error");return this.excelDom.style.position="relative",i=t({init:!0,width:1200,height:800},i),this.init(i,r)}return i(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.AppExcel=new k(this.excelDom,e,{ContentComponent:A,HeaderComponent:M,SideComponent:I,WholeComponent:D},t({SettingPlugin:b,ScrollPlugin:B,InputPlugin:L,DragPlugin:P,SelectPlugin:T,ContextmenuPlugin:R,BookPlugin:N,WebsocketPlugin:Z},o)),this.AppExcel}},{key:"installXlsxData",value:function(e){this.AppExcel.installXlsxData(e)}}]),e}();return O}));
